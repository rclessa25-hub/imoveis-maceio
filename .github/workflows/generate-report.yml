name: ğŸš€ Gerar RelatÃ³rio Completo

on:
  workflow_dispatch:
  push:
    branches: [main]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  generate-report:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: ğŸ“¥ Checkout cÃ³digo
      uses: actions/checkout@v4

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: ğŸ“¦ Instalar ferramentas
      run: |
        sudo apt-get update
        sudo apt-get install -y tree
        pip install markdown

    - name: ğŸ“ Criar pasta reports
      run: mkdir -p reports

    - name: ğŸ“ Gerar README.md
      run: |
        cat > reports/README.md << 'EOF'
        # ğŸ“‹ RelatÃ³rio do Projeto - ImÃ³veis MaceiÃ³
        
        ## ğŸ¯ VisÃ£o Geral
        Sistema completo para gestÃ£o de imÃ³veis em MaceiÃ³ com arquitetura modular.
        
        ## ğŸ“ Estrutura do Projeto
        ```
        $(tree -I '.git|node_modules' --charset=ascii)
        ```
        
        ## ğŸ”— Links
        - **Site:** https://rclessa25-hub.github.io/imoveis-maceio/
        - **RepositÃ³rio:** https://github.com/rclessa25-hub/imoveis-maceio
        - **Supabase:** https://syztbxvpdaplpetmixmt.supabase.co
        
        ## ğŸ“Š EstatÃ­sticas
        - **HTML:** $(find . -name "*.html" | wc -l) arquivos
        - **CSS:** $(find . -name "*.css" | wc -l) arquivos  
        - **JavaScript:** $(find . -name "*.js" | wc -l) arquivos
        
        ## âš™ï¸ Tecnologias
        - HTML5, CSS3, JavaScript
        - Supabase (Backend as a Service)
        - GitHub Pages (Hospedagem)
        
        Gerado automaticamente em: $(date)
        EOF

    - name: ğŸŒ Gerar index.html
      run: |
        cat > reports/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="pt-BR">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>RelatÃ³rio - ImÃ³veis MaceiÃ³</title>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
            <style>
                :root {
                    --primary: #2ea44f;
                    --dark: #0d1117;
                    --card: #161b22;
                }
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    background: var(--dark);
                    color: #c9d1d9;
                    line-height: 1.6;
                    max-width: 1000px;
                    margin: 0 auto;
                    padding: 20px;
                }
                h1 { color: var(--primary); }
                .card {
                    background: var(--card);
                    border: 1px solid #30363d;
                    border-radius: 10px;
                    padding: 20px;
                    margin: 20px 0;
                }
                .stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                    margin: 20px 0;
                }
                .stat-box {
                    text-align: center;
                    padding: 15px;
                    background: var(--card);
                    border-radius: 8px;
                }
                pre {
                    background: var(--card);
                    padding: 15px;
                    border-radius: 6px;
                    overflow-x: auto;
                }
            </style>
        </head>
        <body>
            <header>
                <h1><i class="fas fa-file-alt"></i> RelatÃ³rio do Projeto</h1>
                <p>ImÃ³veis MaceiÃ³ - Sistema Completo</p>
                <p><strong>Gerado em:</strong> $(date '+%d/%m/%Y Ã s %H:%M')</p>
            </header>
            
            <div class="stats">
                <div class="stat-box">
                    <h3><i class="fas fa-file-code"></i> HTML</h3>
                    <p>$(find . -name "*.html" | wc -l) arquivos</p>
                </div>
                <div class="stat-box">
                    <h3><i class="fas fa-palette"></i> CSS</h3>
                    <p>$(find . -name "*.css" | wc -l) arquivos</p>
                </div>
                <div class="stat-box">
                    <h3><i class="fas fa-code"></i> JavaScript</h3>
                    <p>$(find . -name "*.js" | wc -l) arquivos</p>
                </div>
                <div class="stat-box">
                    <h3><i class="fas fa-check-circle"></i> Status</h3>
                    <p style="color: var(--primary);">âœ… Ativo</p>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-link"></i> Links Importantes</h2>
                <ul>
                    <li><a href="https://rclessa25-hub.github.io/imoveis-maceio/" target="_blank">ğŸŒ Site Principal</a></li>
                    <li><a href="https://github.com/rclessa25-hub/imoveis-maceio" target="_blank">ğŸ’» RepositÃ³rio GitHub</a></li>
                    <li><a href="https://syztbxvpdaplpetmixmt.supabase.co" target="_blank">ğŸ—„ï¸ Painel Supabase</a></li>
                    <li><a href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/" target="_blank">ğŸ¨ Font Awesome</a></li>
                </ul>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-sitemap"></i> Estrutura Modular</h2>
                <pre><code>$(find . -type f -name "*.js" -o -name "*.css" -o -name "*.html" | sort | head -20)</code></pre>
                <p><small>Mostrando primeiros 20 arquivos</small></p>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-cogs"></i> MÃ³dulos JavaScript</h2>
                <ul>
                    <li><strong>admin.js</strong> - Painel administrativo</li>
                    <li><strong>gallery.js</strong> - Galeria de imagens</li>
                    <li><strong>properties.js</strong> - GestÃ£o de imÃ³veis</li>
                    <li><strong>supabase.js</strong> - IntegraÃ§Ã£o com banco</li>
                    <li><strong>utils.js</strong> - FunÃ§Ãµes utilitÃ¡rias</li>
                </ul>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-download"></i> Como Usar</h2>
                <pre><code>git clone https://github.com/rclessa25-hub/imoveis-maceio.git
cd imoveis-maceio
# Abra index.html no navegador</code></pre>
            </div>
            
            <footer style="margin-top: 40px; text-align: center; padding-top: 20px; border-top: 1px solid #30363d;">
                <p>ğŸ“Š <strong>RelatÃ³rio gerado automaticamente pelo GitHub Actions</strong></p>
                <p>Atualizado a cada push no repositÃ³rio | ExecuÃ§Ã£o manual disponÃ­vel</p>
                <p><a href="https://github.com/rclessa25-hub/imoveis-maceio/issues" style="color: var(--primary);">
                    <i class="fas fa-bug"></i> Reportar problema ou sugerir melhoria
                </a></p>
            </footer>
        </body>
        </html>
        EOF

    - name: ğŸ“Š Criar dashboard
      run: |
        cat > reports/dashboard.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <title>Dashboard - ImÃ³veis MaceiÃ³</title>
            <style>
                body { font-family: Arial; background: #0d1117; color: white; padding: 20px; }
                .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
                .card { background: #161b22; padding: 20px; border-radius: 10px; border: 1px solid #30363d; }
                h3 { color: #2ea44f; }
            </style>
        </head>
        <body>
            <h1>ğŸ“Š Dashboard do Projeto</h1>
            <div class="dashboard">
                <div class="card">
                    <h3>ğŸ“ˆ Status</h3>
                    <p>âœ… Sistema funcionando</p>
                    <p>ğŸ”„ AtualizaÃ§Ãµes automÃ¡ticas</p>
                </div>
                <div class="card">
                    <h3>ğŸ”— Acesso RÃ¡pido</h3>
                    <p><a href="index.html" style="color: #58a6ff;">ğŸ“‹ Ver relatÃ³rio completo</a></p>
                    <p><a href="https://rclessa25-hub.github.io/imoveis-maceio/" style="color: #58a6ff;">ğŸŒ Ir para o site</a></p>
                </div>
            </div>
        </body>
        </html>
        EOF

    - name: ğŸš€ Configurar Pages
      uses: actions/configure-pages@v3

    - name: ğŸ“¤ Upload artefatos
      uses: actions/upload-pages-artifact@v1
      with:
        path: './reports'

    - name: ğŸŒ Publicar
      id: deployment
      uses: actions/deploy-pages@v2
