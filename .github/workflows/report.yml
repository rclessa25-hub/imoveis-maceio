name: üìä Gerar e Publicar Relat√≥rio

on:
  workflow_dispatch:
  push:
    branches: [main]

permissions:
  contents: write

jobs:
  generate-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout com permiss√£o de escrita
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: üìÅ Criar relat√≥rio
      run: |
        echo "Criando relat√≥rio em docs/reports..."
        
        # Criar estrutura
        mkdir -p docs/reports
        
        # Coletar estat√≠sticas
        HTML_COUNT=$(find . -name "*.html" | wc -l)
        CSS_COUNT=$(find . -name "*.css" | wc -l)
        JS_COUNT=$(find . -name "*.js" | wc -l)
        TOTAL=$((HTML_COUNT + CSS_COUNT + JS_COUNT))
        
        # Criar relat√≥rio HTML
        cat > docs/reports/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="pt-BR">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>üìã Relat√≥rio - Im√≥veis Macei√≥</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    padding: 20px;
                    max-width: 800px;
                    margin: 0 auto;
                }
                h1 { color: #2ea44f; }
                .stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 15px;
                    margin: 30px 0;
                }
                .stat-box {
                    border: 2px solid #2ea44f;
                    border-radius: 10px;
                    padding: 15px;
                    text-align: center;
                }
                .stat-number {
                    font-size: 2em;
                    color: #2ea44f;
                    font-weight: bold;
                }
            </style>
        </head>
        <body>
            <h1>üìã Relat√≥rio T√©cnico</h1>
            <p><strong>Im√≥veis Macei√≥</strong></p>
            <p>Gerado em: $(date '+%d/%m/%Y %H:%M')</p>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number">${HTML_COUNT}</div>
                    <div>HTML</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${CSS_COUNT}</div>
                    <div>CSS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">${JS_COUNT}</div>
                    <div>JavaScript</div>
                </div>
            </div>
            
            <h2>‚úÖ Sistema funcionando!</h2>
            <p>Relat√≥rios autom√°ticos ativos.</p>
            
            <p><a href="/imoveis-maceio/">‚Üê Voltar ao site principal</a></p>
        </body>
        </html>
        EOF
        
        echo "‚úÖ Relat√≥rio criado em docs/reports/index.html"
        echo "üìä Estat√≠sticas: HTML=${HTML_COUNT}, CSS=${CSS_COUNT}, JS=${JS_COUNT}"
    
    - name: üì§ Commit autom√°tico
      run: |
        # Configurar git
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # Verificar mudan√ßas
        git status
        
        # Adicionar arquivos
        git add docs/
        
        # Commit se houver mudan√ßas
        if ! git diff --cached --quiet; then
          git commit -m "üìä Atualiza relat√≥rios [$(date '+%d/%m %H:%M')]"
          git push
          echo "‚úÖ Relat√≥rios commitados no reposit√≥rio"
        else
          echo "‚ÑπÔ∏è  Nenhuma mudan√ßa para commit"
        fi
    
    - name: ‚úÖ Verifica√ß√£o final
      run: |
        echo "üéâ RELAT√ìRIO GERADO E SALVO!"
        echo "üìÅ Local: docs/reports/index.html"
        echo "üåê URL: https://rclessa25-hub.github.io/imoveis-maceio/reports/"
        echo ""
        echo "Estrutura criada:"
        find docs -type f 2>/dev/null || echo "Pasta docs n√£o encontrada"
