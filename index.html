<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBER LESSA CORRETORA E INCORPORA√á√ïES - Im√≥veis Macei√≥</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* SEUS ESTILOS ATUAIS PERMANECEM EXATAMENTE IGUAIS */
        :root {
            --primary: #1a5276;
            --secondary: #2980b9;
            --accent: #3498db;
            --gold: #f39c12;
            --green: #27ae60;
            --text: #2c3e50;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%);
            min-height: 100vh;
        }
        
        /* [MANTENHA TODOS OS SEUS ESTILOS CSS ATUAIS] */
        /* ... todos os seus estilos anteriores ... */
        
    </style>
</head>
<body>
    <!-- SEU HTML ATUAL PERMANECE EXATAMENTE IGUAL -->
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo">WL</div>
                <div class="logo-text">
                    <h1>WEBER LESSA</h1>
                    <p>CORRETORA E INCORPORA√á√ïES</p>
                </div>
            </div>
            <div class="contact-info">
                <div class="phone">
                    <i class="fas fa-phone"></i> (82) 9.9604-4513
                </div>
                <div class="address">
                    <i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa - Pra√ßa S√£o Vicente, 09 - Centro, Macei√≥-AL
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Encontre seu im√≥vel dos sonhos em Macei√≥</h1>
        <p>Na orla mais bonita do Brasil, com a expertise de quem entende do mercado imobili√°rio alagoano</p>
        <a href="#properties" class="cta-button">
            <i class="fas fa-home"></i> Ver Im√≥veis
        </a>
    </section>

    <!-- Servi√ßos Section -->
    <section class="services">
        <div class="section-title">
            <h2>Nossos Servi√ßos Especializados</h2>
            <p>Oferecemos solu√ß√µes completas para suas necessidades imobili√°rias</p>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Equipe de Corretagem</h3>
                <p>Venda de lotes, im√≥veis residenciais, comerciais, s√≠tios, ch√°caras e fazendas com equipe qualificada.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>Incorporacao Imobili√°ria</h3>
                <p>Desenvolvemos empreendimentos de alto padr√£o com qualidade e inova√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Financiamento Facilitado</h3>
                <p>Linhas banc√°rias com boleto facilitado e condi√ß√µes especiais para sua aquisi√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-gavel"></i>
                </div>
                <h3>Regulariza√ß√£o de Im√≥veis</h3>
                <p>Usucapi√£o, heran√ßa, invent√°rio e toda documenta√ß√£o necess√°ria para regulariza√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>Minha Casa Minha Vida</h3>
                <p>Acesso facilitado ao programa governamental para realiza√ß√£o do sonho da casa pr√≥pria.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-tractor"></i>
                </div>
                <h3>Propriedades Rurais</h3>
                <p>Especialistas em s√≠tios, ch√°caras e fazendas com documenta√ß√£o completa e regularizada.</p>
            </div>
        </div>
    </section>

    <!-- Im√≥veis Section -->
    <section class="properties" id="properties">
        <div class="section-title">
            <h2>Im√≥veis em Destaque</h2>
            <p>Confira nossas melhores oportunidades em Macei√≥ e regi√£o</p>
        </div>
        
        <div class="filters">
            <h3>Filtrar por:</h3>
            <div class="filter-options">
                <button class="filter-btn active">Todos</button>
                <button class="filter-btn">Residencial</button>
                <button class="filter-btn">Comercial</button>
                <button class="filter-btn">Rural</button>
                <button class="filter-btn">Minha Casa Minha Vida</button>
            </div>
        </div>
        
        <div class="property-grid" id="properties-container">
            <!-- Os im√≥veis ser√£o carregados aqui via JavaScript -->
        </div>
    </section>

    <!-- Sobre Section -->
    <section class="about">
        <div class="about-content">
            <div class="about-text">
                <h2>Sobre a Weber Lessa</h2>
                <p>Com anos de experi√™ncia no mercado imobili√°rio de Macei√≥, a Weber Lessa Corretora e Incorpora√ß√µes se consolidou como refer√™ncia em solu√ß√µes imobili√°rias completas e personalizadas.</p>
                <p>Nossa equipe especializada atua em todas as fases do processo: desde a assessoria na compra e venda, passando pela regulariza√ß√£o documental, at√© o financiamento e incorpora√ß√£o de empreendimentos.</p>
                <p>Localizada no Empresarial Sizi & Neusa, no cora√ß√£o de Macei√≥, estamos prontos para ajudar voc√™ a realizar o sonho do im√≥vel pr√≥prio com seguran√ßa, transpar√™ncia e expertise.</p>
            </div>
            <div class="about-image">
                <div>
                    <i class="fas fa-building"></i>
                    <p>Empresarial Sizi & Neusa</p>
                    <p>Sede Weber Lessa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Weber Lessa</h3>
                <p>Corretora e Incorpora√ß√µes com tradi√ß√£o e qualidade no mercado imobili√°rio de Macei√≥.</p>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <p><i class="fas fa-phone"></i> (82) 9.9604-4513</p>
                <p><i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa</p>
                <p>Pra√ßa S√£o Vicente, 09 - Centro</p>
                <p>Macei√≥ - AL, 57020-420</p>
                <p><i class="fas fa-clock"></i> Segunda a Sexta: 8h √†s 18h</p>
            </div>
            <div class="footer-section">
                <h3>Links R√°pidos</h3>
                <a href="#properties">Im√≥veis</a>
                <a href="#services">Servi√ßos</a>
                <a href="#about">Sobre N√≥s</a>
                <a href="#contact">Contato</a>
            </div>
            <div class="footer-section">
                <h3>Especialidades</h3>
                <a href="#">Venda de Im√≥veis</a>
                <a href="#">Propriedades Rurais</a>
                <a href="#">Incorpora√ß√£o</a>
                <a href="#">Financiamento</a>
                <a href="#">Regulariza√ß√£o</a>
                <a href="#">Minha Casa Minha Vida</a>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Weber Lessa Corretora e Incorpora√ß√µes. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- ========== PAINEL DE ADMINISTRA√á√ÉO ========== -->
    <section class="admin-panel" id="adminPanel" style="display: none;">
        <h3 style="text-align: center; color: var(--primary); margin-bottom: 1.5rem;">
            <i class="fas fa-cog"></i> Painel do Corretor - Weber Lessa
        </h3>
        
        <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h4 id="formTitle">Adicionar Novo Im√≥vel</h4>
            <form id="propertyForm">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label><strong>T√≠tulo do Im√≥vel *</strong></label>
                        <input type="text" id="propTitle" placeholder="Ex: Apartamento Vista Mar" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                    </div>
                    <div>
                        <label><strong>Pre√ßo *</strong></label>
                        <input type="text" id="propPrice" placeholder="Ex: R$ 450.000" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                    </div>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label><strong>Localiza√ß√£o *</strong></label>
                    <input type="text" id="propLocation" placeholder="Ex: Ponta Verde, Macei√≥-AL" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label><strong>Descri√ß√£o</strong></label>
                    <textarea id="propDescription" placeholder="Descreva o im√≥vel..." style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%; height: 100px;"></textarea>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label><strong>Caracter√≠sticas (separadas por v√≠rgula)</strong></label>
                    <input type="text" id="propFeatures" placeholder="Ex: 2 Quartos, 1 Vaga, Piscina, Varanda" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                    <small style="color: #666;">Separe por v√≠rgulas</small>
                </div>

                <div style="margin-bottom: 1rem;">
                    <label><strong>Tipo do Im√≥vel</strong></label>
                    <select id="propType" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="residencial">Residencial</option>
                        <option value="comercial">Comercial</option>
                        <option value="rural">Rural</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label><strong>Destaque</strong></label>
                    <select id="propBadge" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="Novo">Novo</option>
                        <option value="Destaque">Destaque</option>
                        <option value="Luxo">Luxo</option>
                        <option value="MCMV">Minha Casa Minha Vida</option>
                        <option value="Fazenda">Fazenda</option>
                        <option value="Ch√°cara">Ch√°cara</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" id="propHasVideo"> 
                        <span><strong>Este im√≥vel tem v√≠deo?</strong></span>
                    </label>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" style="background: var(--success); color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; flex: 1; font-size: 1.1rem;">
                        <i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site
                    </button>
                    <button type="button" id="cancelEditBtn" onclick="cancelEdit()" style="background: #95a5a6; color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; display: none;">
                        <i class="fas fa-times"></i> Cancelar Edi√ß√£o
                    </button>
                </div>
            </form>
            
            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
                <h4>Gerenciar Im√≥veis Existentes</h4>
                <p><small>Total de im√≥veis: <span id="propertyCount">0</span></small></p>
                <div id="propertyList"></div>
            </div>
        </div>
    </section>

    <!-- ========== MODAL PARA DOCUMENTOS PDF ========== -->
    <div id="pdfModal" class="pdf-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div class="pdf-modal-content" style="background: white; padding: 2rem; border-radius: 10px; max-width: 400px; width: 90%; text-align: center;">
            <h3 id="pdfModalTitle"><i class="fas fa-file-pdf"></i> Documentos do Im√≥vel</h3>
            <div id="pdfPreview" class="pdf-preview" style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
                <p>Documentos t√©cnicos e legais dispon√≠veis</p>
            </div>
            <input type="password" id="pdfPassword" class="pdf-password-input" placeholder="Digite a senha para acessar" style="width: 100%; padding: 0.8rem; margin: 1rem 0; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem;">
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button onclick="accessPdfDocuments()" style="background: var(--primary); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; flex: 1;">
                    <i class="fas fa-lock-open"></i> Acessar
                </button>
                <button onclick="closePdfModal()" style="background: #95a5a6; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            <p style="font-size: 0.8rem; color: #666; margin-top: 1rem;">
                <i class="fas fa-info-circle"></i> Solicite a senha ao corretor
            </p>
        </div>
    </div>

    <button class="admin-toggle" onclick="toggleAdminPanel()" style="position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; border: none; padding: 1rem; border-radius: 50%; cursor: pointer; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 1.2rem;">
        <i class="fas fa-user-cog"></i>
    </button>

    <script>
// ========== CONFIGURA√á√ÉO SUPABASE ==========
const SUPABASE_URL = 'https://syztbxvpdaplpetmixmt.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5enRieHZwZGFwbHBldG1peG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxODY0OTAsImV4cCI6MjA3OTc2MjQ5MH0.SISlMoO1kLWbIgx9pze8Dv1O-kfQ_TAFDX6yPUxfJxo';

console.log('üöÄ Weber Lessa Im√≥veis - Sistema Iniciado');

// ========== VARI√ÅVEIS GLOBAIS ==========
let properties = [];
let editingPropertyId = null;
let currentPdfPropertyId = null;

// ========== CONFIGURA√á√ïES ==========
const ADMIN_PASSWORD = "weber123";
const PDF_PASSWORD = "doc123";

// ========== DADOS INICIAIS ==========
function getInitialProperties() {
    return [
        {
            id: 1,
            title: "Casa 2Qtos - Forene",
            price: "R$ 180.000",
            location: "Resid√™ncia Conj. Portal do Renascer, Forene",
            description: "Casa a 100m do CEASA; - Medindo 6,60m frente X 19m lado; - 125,40m¬≤ de √°rea total; -Somente um √∫nico dono; - 02 Quartos, Sala; - Cozinha; - 02 Banheiros; - Varanda; - 02 Vagas de garagem; - √Ågua de Po√ßo Artesiano;",
            features: ["02 Quartos", "Sala", "Cozinha", "02 Banheiros", "Varanda", "02 Vagas de carro"],
            type: "residencial",
            has_video: true,
            badge: "Destaque",
            rural: false,
            images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            pdfs: "",
            created_at: new Date().toISOString()
        }
    ];
}

// ========== CARREGAR IM√ìVEIS ==========
async function loadProperties() {
    try {
        console.log('üì° Carregando im√≥veis do Supabase...');
        
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=*`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            properties = Array.isArray(data) ? data : [];
            console.log(`‚úÖ ${properties.length} im√≥veis carregados do Supabase`);
            
            // Garantir que as imagens sejam tratadas corretamente
            properties = properties.map(property => {
                if (!property.images || property.images === 'EMPTY' || property.images.trim() === '') {
                    property.images = "https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                return property;
            });
            
        } else {
            console.log('‚ö†Ô∏è Supabase n√£o acess√≠vel, usando dados locais');
            throw new Error('Supabase n√£o dispon√≠vel');
        }
        
    } catch (error) {
        console.log('üîÑ Carregando dados locais...', error);
        const localData = localStorage.getItem('weberlessa_properties');
        properties = localData ? JSON.parse(localData) : getInitialProperties();
    }
    
    renderProperties();
}

// ========== RENDERIZAR IM√ìVEIS ==========
function renderProperties(filter = 'todos') {
    const container = document.getElementById('properties-container');
    if (!container) {
        console.error('‚ùå Container de propriedades n√£o encontrado!');
        return;
    }
    
    container.innerHTML = '';
    
    const filteredProperties = filter === 'todos' ? properties : properties.filter(p => {
        if (filter === 'Residencial') return p.type === 'residencial';
        if (filter === 'Comercial') return p.type === 'comercial';
        if (filter === 'Rural') return p.type === 'rural';
        if (filter === 'Minha Casa Minha Vida') return p.badge === 'MCMV';
        return true;
    });
    
    if (filteredProperties.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Nenhum im√≥vel encontrado para este filtro.</p>';
        return;
    }
    
    console.log(`üé® Renderizando ${filteredProperties.length} im√≥veis...`);
    
    filteredProperties.forEach(property => {
        const features = Array.isArray(property.features) ? property.features : (property.features ? property.features.split(',') : []);
        
        const hasImages = property.images && property.images.length > 0 && property.images !== 'EMPTY';
        const imageUrls = hasImages ? property.images.split(',').filter(url => url.trim() !== '') : [];
        const firstImageUrl = imageUrls.length > 0 ? imageUrls[0] : 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
        
        // VERIFICA√á√ÉO CORRETA DE PDFs
        const hasPdfs = property.pdfs && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined' && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs.length > 0;
        
        console.log(`üìã Im√≥vel: ${property.title} - PDFs: ${hasPdfs} - Valor: ${property.pdfs}`);
        
        const hasVideo = property.has_video !== undefined ? property.has_video : property.hasVideo;
        
        const card = `
            <div class="property-card">
                <div class="property-image ${property.rural ? 'rural-image' : ''}" style="position: relative; height: 250px; background: ${hasImages ? 'none' : 'linear-gradient(45deg, var(--accent), var(--secondary))'};">
                    <img src="${firstImageUrl}" 
                         style="width: 100%; height: 100%; object-fit: cover;"
                         alt="${property.title}"
                         onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                    ${property.badge ? `<div class="property-badge ${property.rural ? 'rural-badge' : ''}">${property.badge}</div>` : ''}
                    ${hasVideo ? `<div class="video-indicator"><i class="fas fa-video"></i> TEM V√çDEO</div>` : ''}
                    ${hasImages ? `<div class="image-count">üì∏ ${imageUrls.length}</div>` : ''}
                    
                    <!-- BOT√ÉO PDF MINIMALISTA -->
                    ${hasPdfs ? `
                    <button class="pdf-access" onclick="showPdfModal(${property.id})" title="Documentos do im√≥vel" style="position: absolute; bottom: 10px; left: 10px; background: rgba(231, 76, 60, 0.9); border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; color: white; transition: all 0.3s ease; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                    ` : ''}
                </div>
                <div class="property-content">
                    <div class="property-price">${property.price}</div>
                    <h3 class="property-title">${property.title}</h3>
                    <div class="property-location"><i class="fas fa-map-marker-alt"></i> ${property.location}</div>
                    <p>${property.description}</p>
                    <div class="property-features">
                        ${features.map(f => `<span class="feature-tag ${property.rural ? 'rural-tag' : ''}">${f.trim()}</span>`).join('')}
                    </div>
                    <button class="contact-btn" onclick="contactAgent(${property.id})">
                        <i class="fab fa-whatsapp"></i> Entrar em Contato
                    </button>
                </div>
            </div>
        `;
        container.innerHTML += card;
    });
}

// ========== SALVAR IM√ìVEL ==========
async function saveProperty(propertyData) {
    try {
        console.log('üíæ Iniciando processo de salvamento...');

        const dataToSave = {
            title: propertyData.title,
            price: propertyData.price,
            location: propertyData.location,
            description: propertyData.description,
            features: Array.isArray(propertyData.features) ? propertyData.features.join(', ') : propertyData.features,
            type: propertyData.type,
            has_video: propertyData.has_video,
            badge: propertyData.badge,
            rural: propertyData.rural,
            images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            pdfs: "",
            created_at: propertyData.created_at || new Date().toISOString()
        };

        console.log('üì§ Dados para salvar:', dataToSave);
        
        // Determinar URL e m√©todo
        const url = editingPropertyId
            ? `${SUPABASE_URL}/rest/v1/properties?id=eq.${editingPropertyId}`
            : `${SUPABASE_URL}/rest/v1/properties`;

        const method = editingPropertyId ? 'PATCH' : 'POST';

        console.log(`üåê Fazendo requisi√ß√£o: ${method} ${url}`);

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Prefer': 'return=representation'
            },
            body: JSON.stringify(dataToSave)
        });

        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro na resposta do Supabase:', response.status, errorText);
            throw new Error(`Erro ao salvar: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('‚úÖ Salvo com sucesso no Supabase:', result);
        
        // Recarregar os dados
        await loadProperties();
        return true;

    } catch (error) {
        console.error('‚ùå Erro cr√≠tico ao salvar no Supabase:', error);
        console.log('üîÑ Tentando salvar localmente como fallback...');
        return saveToLocalStorage(propertyData);
    }
}

function saveToLocalStorage(propertyData) {
    try {
        if (editingPropertyId) {
            const index = properties.findIndex(p => p.id === editingPropertyId);
            if (index !== -1) {
                propertyData.id = editingPropertyId;
                properties[index] = { ...properties[index], ...propertyData };
            }
        } else {
            const newId = properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1;
            const newProperty = {
                id: newId,
                ...propertyData,
                images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                pdfs: ""
            };
            properties.push(newProperty);
        }
        
        localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
        renderProperties();
        loadPropertyList();
        return true;
        
    } catch (error) {
        console.error('‚ùå Erro ao salvar no localStorage:', error);
        return false;
    }
}

// ========== EDITAR IM√ìVEL ==========
function editProperty(id) {
    const property = properties.find(p => p.id === id);
    if (!property) return;

    editingPropertyId = id;
    
    // Preencher formul√°rio
    document.getElementById('propTitle').value = property.title || '';
    document.getElementById('propPrice').value = property.price || '';
    document.getElementById('propLocation').value = property.location || '';
    document.getElementById('propDescription').value = property.description || '';
    
    const features = Array.isArray(property.features) 
        ? property.features 
        : (property.features || '');
    document.getElementById('propFeatures').value = Array.isArray(features) ? features.join(', ') : features;
    
    document.getElementById('propType').value = property.type || 'residencial';
    document.getElementById('propBadge').value = property.badge || 'Novo';
    document.getElementById('propHasVideo').checked = property.has_video || false;
    
    // Atualizar UI
    document.getElementById('formTitle').textContent = 'Editar Im√≥vel';
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Im√≥vel';
    }
    document.getElementById('cancelEditBtn').style.display = 'block';
    
    document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
    alert("Im√≥vel carregado para edi√ß√£o! Modifique os campos e clique em 'Atualizar Im√≥vel' para salvar.");
}

function cancelEdit() {
    editingPropertyId = null;
    const form = document.getElementById('propertyForm');
    if (form) form.reset();
    
    document.getElementById('formTitle').textContent = 'Adicionar Novo Im√≥vel';
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site';
    }
    document.getElementById('cancelEditBtn').style.display = 'none';
    
    console.log('‚úÖ Edi√ß√£o cancelada');
}

// ========== SISTEMA DO PAINEL ADMIN ==========
function toggleAdminPanel() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        const panel = document.getElementById('adminPanel');
        if (panel) {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                loadPropertyList();
            }
        }
    } else {
        alert("Senha incorreta!");
    }
}

function loadPropertyList() {
    const container = document.getElementById('propertyList');
    const countElement = document.getElementById('propertyCount');
    
    if (!container) return;
    
    container.innerHTML = '';
    if (countElement) countElement.textContent = properties.length;
    
    if (properties.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum im√≥vel cadastrado.</p>';
        return;
    }
    
    properties.forEach(property => {
        const features = Array.isArray(property.features) 
            ? property.features 
            : (property.features ? property.features.split(',') : []);
            
        const item = document.createElement('div');
        item.className = 'property-item';
        item.style.cssText = 'background: #f5f5f5; padding: 1rem; margin: 0.5rem 0; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary);';
        item.innerHTML = `
            <div style="flex: 1;">
                <strong style="color: var(--primary);">${property.title}</strong><br>
                <small>${property.price} - ${property.location}</small>
                <div style="margin-top: 0.5rem;">
                    ${features.map(f => 
                        `<span style="background: var(--accent); color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem; margin-right: 0.3rem; display: inline-block; margin-bottom: 0.3rem;">${f.trim()}</span>`
                    ).join('')}
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="editProperty(${property.id})" style="background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button onclick="deleteProperty(${property.id})" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        `;
        container.appendChild(item);
    });
}

// ========== FORMUL√ÅRIO ==========
function setupForm() {
    const form = document.getElementById('propertyForm');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const propertyData = {
            title: document.getElementById('propTitle').value,
            price: document.getElementById('propPrice').value,
            location: document.getElementById('propLocation').value,
            description: document.getElementById('propDescription').value,
            features: document.getElementById('propFeatures').value.split(',').map(f => f.trim()).filter(f => f !== ''),
            type: document.getElementById('propType').value,
            has_video: document.getElementById('propHasVideo').checked,
            badge: document.getElementById('propBadge').value,
            rural: document.getElementById('propType').value === 'rural',
            created_at: new Date().toISOString()
        };

        if (!propertyData.title || !propertyData.price || !propertyData.location) {
            alert('‚ùå Preencha T√≠tulo, Pre√ßo e Localiza√ß√£o!');
            return;
        }

        const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitBtn.disabled = true;

        try {
            const success = await saveProperty(propertyData);
            if (success) {
                alert("‚úÖ Im√≥vel salvo com sucesso!");
                this.reset();
                cancelEdit();
            } else {
                alert("‚ùå Erro ao salvar o im√≥vel!");
            }
        } catch (error) {
            alert("‚ùå Erro: " + error.message);
        } finally {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });
}

// ========== FUN√á√ïES DE CONTATO E EXCLUS√ÉO ==========
function contactAgent(id) {
    const property = properties.find(p => p.id === id);
    if (property) {
        const message = `Ol√°! Tenho interesse no im√≥vel: ${property.title} - ${property.price}`;
        const whatsappURL = `https://wa.me/5582996044513?text=${encodeURIComponent(message)}`;
        window.open(whatsappURL, '_blank');
    }
}

async function deleteProperty(id) {
    const property = properties.find(p => p.id === id);
    if (!property) return;

    if (confirm(`Tem certeza que deseja EXCLUIR permanentemente o im√≥vel:\n\n"${property.title}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
        try {
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${id}`, {
                method: 'DELETE',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`
                }
            });
            if (response.ok) console.log('‚úÖ Im√≥vel exclu√≠do do Supabase');
        } catch (error) {
            console.error('‚ùå Erro ao excluir do Supabase:', error);
        }

        const index = properties.findIndex(p => p.id === id);
        if (index !== -1) {
            properties.splice(index, 1);
            localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
        }

        renderProperties();
        loadPropertyList();
        alert("‚úÖ Im√≥vel exclu√≠do com sucesso!");
    }
}

// ========== SISTEMA DE PDFs ==========
function showPdfModal(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;

    currentPdfPropertyId = propertyId;
    const modal = document.getElementById('pdfModal');
    const title = document.getElementById('pdfModalTitle');
    const preview = document.getElementById('pdfPreview');
    
    if (title) title.innerHTML = `<i class="fas fa-file-pdf"></i> Documentos - ${property.title}`;
    if (preview) {
        if (property.pdfs && property.pdfs.length > 0) {
            const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
            preview.innerHTML = `
                <p><strong>${pdfUrls.length} documento(s) dispon√≠vel(is):</strong></p>
                ${pdfUrls.map((url, index) => `
                    <div class="pdf-file-item" style="display: flex; align-items: center; gap: 10px; padding: 0.5rem; margin: 0.5rem 0; background: white; border-radius: 5px; border: 1px solid #ddd;">
                        <i class="fas fa-file-pdf" style="color: #e74c3c;"></i>
                        <span>Documento ${index + 1}</span>
                    </div>
                `).join('')}
            `;
        } else {
            preview.innerHTML = '<p>Nenhum documento dispon√≠vel para este im√≥vel.</p>';
        }
    }
    
    const passwordInput = document.getElementById('pdfPassword');
    if (passwordInput) passwordInput.value = '';
    modal.style.display = 'flex';
}

function closePdfModal() {
    document.getElementById('pdfModal').style.display = 'none';
    currentPdfPropertyId = null;
}

function accessPdfDocuments() {
    const passwordInput = document.getElementById('pdfPassword');
    const password = passwordInput ? passwordInput.value : '';
    
    if (password !== PDF_PASSWORD) {
        alert('‚ùå Senha incorreta! Solicite a senha ao corretor.');
        return;
    }
    
    const property = properties.find(p => p.id === currentPdfPropertyId);
    if (!property || !property.pdfs) {
        alert('‚ùå Nenhum documento dispon√≠vel para este im√≥vel.');
        return;
    }
    
    const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
    pdfUrls.forEach(url => window.open(url, '_blank'));
    closePdfModal();
    alert('‚úÖ Documentos abertos com sucesso!');
}

// ========== INICIALIZA√á√ÉO ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Sistema Weber Lessa Iniciado');
    
    // Configurar eventos
    setupForm();
    
    // Configurar filtros
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            const text = this.textContent.trim();
            renderProperties(text === 'Todos' ? 'todos' : text);
        });
    });
    
    // Carregar dados
    await loadProperties();
    console.log('‚úÖ Sistema Weber Lessa carregado!');
});
    </script>
</body>
</html>
