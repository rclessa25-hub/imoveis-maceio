<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBER LESSA CORRETOR & CONSULTORIA DE IMÓVEIS - CRECI: 654/AL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #2980b9;
            --accent: #3498db;
            --gold: #f39c12;
            --green: #27ae60;
            --text: #2c3e50;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%);
            min-height: 100vh;
        }
        
        /* ========== HEADER INTEGRADO COMPACTO ========== */
        .header {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 8px 0;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
            border-bottom: 2px solid #d4af37;
            margin: 0;
            min-height: auto;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
            height: auto;
        }
        
        /* ========== DESKTOP LAYOUT INTEGRADO ========== */
        .header-integrated {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            width: 100%;
            padding: 5px 0;
        }
        
        /* Lado Esquerdo: Branding */
        .brand-section {
            display: flex;
            gap: 15px;
            align-items: flex-start;
            flex: 1;
        }
        
        /* Logo Compacta */
        .logo {
            position: relative;
            width: 70px;
            height: 70px;
            background: linear-gradient(145deg, #1a5276, #0c2d48);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(26, 82, 118, 0.2);
            border: 2px solid rgba(212, 175, 55, 0.3);
            flex-shrink: 0;
        }
        
        .logo-wl {
            font-family: 'Georgia', serif;
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .logo-badge {
            position: absolute;
            bottom: -6px;
            right: -6px;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #d4af37, #b8941f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 0.7rem;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #ffffff;
        }
        
        /* Informações da Marca */
        .brand-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }
        
        .brand-name-compact {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }
        
        .first-name-compact {
            font-family: 'Georgia', serif;
            font-size: 1.8rem;
            font-weight: 900;
            color: #0c2d48;
            letter-spacing: 1px;
            text-transform: uppercase;
            line-height: 1;
        }
        
        .last-name-compact {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a5276;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-top: -3px;
            line-height: 1;
        }
        
        /* CRECI Info Compacta */
        .creci-info-compact {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .creci-badge-compact {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .creci-badge-compact i {
            color: #1a5276;
            font-size: 0.9rem;
        }
        
        .creci-label-compact {
            font-size: 0.7rem;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .creci-number-compact {
            font-size: 1rem;
            font-weight: 900;
            color: #0c2d48;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }
        
        .certified-badge-compact {
            display: flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, #1a5276, #2980b9);
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid #d4af37;
        }
        
        .certified-badge-compact i {
            color: #d4af37;
            font-size: 0.8rem;
        }
        
        .certified-badge-compact span {
            color: #ffffff;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.8px;
        }
        
        /* Especialização Compacta */
        .specialty-compact {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 2px;
        }
        
        .specialty-compact i {
            color: #1a5276;
            font-size: 1rem;
        }
        
        .specialty-title-compact {
            font-size: 0.9rem;
            font-weight: 800;
            color: #1a5276;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .specialty-subtitle-compact {
            font-size: 0.75rem;
            color: #495057;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-left: 5px;
        }
        
        /* ========== LADO DIREITO: CONTATO E ENDEREÇO ========== */
        .contact-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 280px;
            padding-top: 5px;
        }
        
        /* Telefone/WhatsApp Compacto */
        .phone-whatsapp-compact {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .phone-icons-compact {
            display: flex;
            gap: 5px;
        }
        
        .phone-icons-compact .fa-mobile-alt {
            color: #1a5276;
            font-size: 1.1rem;
        }
        
        .phone-icons-compact .fa-whatsapp {
            color: #25D366;
            font-size: 1.1rem;
        }
        
        .phone-number-compact {
            display: flex;
            align-items: baseline;
            gap: 3px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .phone-prefix-compact {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 600;
        }
        
        .phone-main-compact {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a5276;
            letter-spacing: 0.5px;
        }
        
        /* Endereço Compacto */
        .address-compact {
            display: flex;
            gap: 10px;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            align-items: flex-start;
        }
        
        .address-compact i {
            color: #d4af37;
            font-size: 1rem;
            margin-top: 2px;
        }
        
        .address-text-compact {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .address-line-1 {
            font-size: 0.85rem;
            font-weight: 700;
            color: #1a5276;
            line-height: 1.2;
        }
        
        .address-line-2 {
            font-size: 0.8rem;
            color: #495057;
            line-height: 1.2;
        }
        
        .address-line-3 {
            font-size: 0.8rem;
            color: #6c757d;
            font-weight: 600;
            line-height: 1.2;
        }
        
        /* ========== MOBILE LAYOUT ULTRA COMPACTO ========== */
        .mobile-header-ultimate {
            display: none;
            width: 100%;
            padding: 5px 0;
        }
        
        /* Linha 1: Logo + Nome + Telefone */
        .mobile-row-1 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 0 0 5px 0;
            padding: 0;
            width: 100%;
        }
        
        .mobile-logo-mini {
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #1a5276, #0c2d48);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Georgia', serif;
            font-size: 1.2rem;
            font-weight: 900;
            box-shadow: 0 2px 6px rgba(26, 82, 118, 0.2);
            flex-shrink: 0;
        }
        
        .mobile-name-mini {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .mobile-first-name-mini {
            font-family: 'Georgia', serif;
            font-size: 1.2rem;
            font-weight: 900;
            color: #0c2d48;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            line-height: 1;
        }
        
        .mobile-last-name-mini {
            font-family: 'Georgia', serif;
            font-size: 1rem;
            font-weight: 700;
            color: #1a5276;
            letter-spacing: 1px;
            text-transform: uppercase;
            line-height: 1;
        }
        
        .mobile-phone-mini {
            display: flex;
            gap: 3px;
            flex-shrink: 0;
        }
        
        .mobile-phone-mini .fa-mobile-alt {
            color: #1a5276;
            font-size: 0.9rem;
        }
        
        .mobile-phone-mini .fa-whatsapp {
            color: #25D366;
            font-size: 0.9rem;
        }
        
        /* Linha 2: CRECI + Especialização */
        .mobile-row-2 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 3px 0;
            padding: 0;
            width: 100%;
        }
        
        .mobile-creci-mini {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            color: #0c2d48;
        }
        
        .mobile-creci-mini i {
            color: #1a5276;
            font-size: 0.7rem;
        }
        
        .mobile-specialty-mini {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            color: #1a5276;
        }
        
        .mobile-specialty-mini i {
            color: #1a5276;
            font-size: 0.7rem;
        }
        
        /* Linha 3: Endereço + Certificado */
        .mobile-row-3 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 3px 0 0 0;
            padding: 0;
            width: 100%;
        }
        
        .mobile-address-mini {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.65rem;
            color: #495057;
            font-weight: 600;
        }
        
        .mobile-address-mini i {
            color: #d4af37;
            font-size: 0.7rem;
        }
        
        .mobile-certified-mini {
            display: flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #1a5276, #2980b9);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.6rem;
            color: white;
            font-weight: 600;
        }
        
        .mobile-certified-mini i {
            color: #d4af37;
            font-size: 0.6rem;
        }
        
        /* ========== MEDIA QUERIES ========== */
        @media (max-width: 1024px) {
            .header-integrated {
                gap: 15px;
            }
            
            .contact-section {
                min-width: 250px;
            }
            
            .phone-main-compact {
                font-size: 1.1rem;
            }
            
            .address-line-1 {
                font-size: 0.8rem;
            }
            
            .address-line-2,
            .address-line-3 {
                font-size: 0.75rem;
            }
        }
        
        @media (max-width: 768px) {
            .header-integrated {
                display: none;
            }
            
            .mobile-header-ultimate {
                display: block;
            }
            
            .header {
                padding: 5px 0;
            }
            
            .header-content {
                padding: 0 10px;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-header-ultimate {
                display: none;
            }
            
            .header-integrated {
                display: flex;
            }
        }
        
        /* Ajuste para telas muito pequenas */
        @media (max-width: 380px) {
            .mobile-logo-mini {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .mobile-first-name-mini {
                font-size: 1rem;
            }
            
            .mobile-last-name-mini {
                font-size: 0.85rem;
            }
            
            .mobile-creci-mini,
            .mobile-specialty-mini {
                font-size: 0.65rem;
                padding: 3px 6px;
            }
            
            .mobile-address-mini {
                font-size: 0.6rem;
            }
            
            .mobile-certified-mini {
                font-size: 0.55rem;
                padding: 2px 6px;
            }
        }
            
        /* Header e Navegação - Estilos Gerais */
        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(26, 82, 118, 0.8), rgba(41, 128, 185, 0.8)), url('https://images.unsplash.com/photo-1544984243-ec57ea16fe25?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 4rem 1rem;
        }
        
        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .cta-button {
            display: inline-block;
            background: var(--gold);
            color: white;
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }
        
        /* Serviços Section */
        .services {
            background: white;
            padding: 4rem 1rem;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .section-title p {
            color: var(--dark);
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .service-card {
            background: var(--light);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .service-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .service-card h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .service-card p {
            color: var(--dark);
        }
        
        /* Imóveis Section */
        .properties {
            padding: 4rem 1rem;
            background: #f8f9fa;
        }
        
        .filters {
            background: white;
            padding: 1.5rem;
            margin: 0 auto 2rem;
            max-width: 1200px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            background: var(--light);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .property-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .property-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .property-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .rural-image {
            background: linear-gradient(45deg, var(--green), #2ecc71);
        }
        
        .property-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--gold);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .rural-badge {
            background: var(--green);
        }
        
        .property-content {
            padding: 1.5rem;
        }
        
        .property-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .property-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .property-location {
            color: #666;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .property-features {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .feature-tag {
            background: var(--accent);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .rural-tag {
            background: var(--green);
        }
        
        .contact-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .contact-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 119, 182, 0.3);
        }
        
        .video-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Sobre Section */
        .about {
            background: white;
            padding: 4rem 1rem;
        }
        
        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
        }
        
        .about-text h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .about-text p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        .about-image {
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            height: 400px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 3rem 1rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--gold);
        }
        
        .footer-section p, .footer-section a {
            color: #bbb;
            margin-bottom: 0.8rem;
            display: block;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 1rem;
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .social-icon:hover {
            background: var(--accent);
            transform: translateY(-3px);
        }
        
        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #999;
        }
        
        /* ========== ESTILOS DO PAINEL ADMIN ========== */
        .admin-panel {
            background: #f8f9fa;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
            border-radius: 10px;
            display: none;
        }
        
        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 1.2rem;
        }
        
        .property-item {
            background: #f5f5f5;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
        }

        /* ÍCONE DO PDF - À ESQUERDA DO CONTADOR, TAMBÉM ENCOSTADO NA BORDA INFERIOR */
        .pdf-access {
            position: absolute;
            bottom: 2px; /* Encostado na borda inferior */
            right: 35px; /* À esquerda do contador (contador ocupa ~30px + espaço) */
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--primary);
            transition: all 0.3s ease;
            z-index: 15; /* Sobre o contador quando hover */
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            border: 1px solid rgba(0,0,0,0.15);
        }


        .pdf-access:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 3px 12px rgba(0,0,0,0.4);
            color: #1a5276; /* Cor primária mais forte no hover */
        }

        .pdf-modal {
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0,0,0,0.8);
             z-index: 1000;
             align-items: center;
             justify-content: center;
        }

        .pdf-modal-content {
              background: white;
              padding: 2rem;
              border-radius: 10px;
              max-width: 400px;
              width: 90%;
              text-align: center;
        }

        .pdf-preview {
              margin: 1rem 0;
              padding: 1rem;
              background: #f8f9fa;
              border-radius: 5px;
        }

        .pdf-file-item {
              display: flex;
              align-items: center;
              gap: 10px;
              padding: 0.5rem;
              margin: 0.5rem 0;
              background: white;
              border-radius: 5px;
              border: 1px solid #ddd;
        }

        .pdf-password-input {
              width: 100%;
              padding: 0.8rem;
              margin: 1rem 0;
              border: 1px solid #ddd;
              border-radius: 5px;
              font-size: 1rem;
        }

        /* ========== NOVOS ESTILOS PARA EXCLUSÃO DE FOTOS ========== */
        .image-preview-container {
            position: relative;
            display: inline-block;
            margin: 5px;
        }
        
        .delete-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .delete-image-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        /* CONTADOR DE FOTOS - CONTAINER MÍNIMO */
        .image-count {
            position: absolute;
            bottom: 1px;
            right: 1px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 0.1rem 0.35rem; /* MÍNIMO possível */
            border-radius: 8px 0 8px 8px; /* Menos arredondado */
            font-size: 0.75rem; /* Fonte NORMAL */
            z-index: 10;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.6);
            font-weight: 600; /* Negrito para melhor visibilidade */
            min-width: 22px; /* Mínima largura */
            height: 18px; /* Altura mínima */
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            border: 0.5px solid rgba(255,255,255,0.15); /* Borda fina para definição */
        }
        
        /* ========== ESTILOS PARA UPLOAD E PREVIEW ========== */
        /* Diferenciação entre existentes e novos */
        #existingImagesSection .image-preview-container,
        #existingPdfsSection .image-preview-container {
            border: 2px solid var(--success);
        }
        
        #existingImagesSection .delete-image-btn,
        #existingPdfsSection .delete-image-btn {
            background: #e74c3c;
        }
        
        #newImagesSection .image-preview-container {
            border: 2px dashed #3498db;
        }
        
        #newImagesSection .delete-image-btn,
        #newPdfsSection .delete-image-btn {
            background: #3498db;
        }
        
        #newImagesSection .delete-image-btn:hover,
        #newPdfsSection .delete-image-btn:hover {
            background: #2980b9;
        }
        
        #newPdfsSection .pdf-file-item {
            border: 2px dashed #3498db;
            background: #f8faff;
        }
        
        /* Separação visual */
        #existingImagesSection,
        #existingPdfsSection {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
        }
        
        #newImagesSection,
        #newPdfsSection {
            margin-top: 1rem;
            padding-top: 1.5rem;
        }
        
        /* Melhor visualização dos containers */
        #existingImagesSection > div,
        #newImagesSection > div,
        #existingPdfsSection > div,
        #newPdfsSection > div {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        /* Estilo para PDF preview */
        .pdf-file-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .pdf-file-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Correção para elementos de upload */
        #pdfUploadArea * {
            pointer-events: none;
        }
        
        #pdfUploadArea {
            pointer-events: auto;
        }
        
        .delete-image-btn {
            pointer-events: auto;
        }
        
        .image-preview-container {
            pointer-events: auto;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .about-content {
                grid-template-columns: 1fr;
            }
            
            .property-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .property-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Desktop Layout Único -->
            <div class="header-integrated">
                <!-- Logo e Nome (Lado Esquerdo) -->
                <div class="brand-section">
                    <div class="logo">
                        <span class="logo-wl">WL</span>
                        <div class="logo-badge">
                            <i class="fas fa-key"></i>
                        </div>
                    </div>
                    
                    <div class="brand-info">
                        <div class="brand-name-compact">
                            <span class="first-name-compact">WEBER</span>
                            <span class="last-name-compact">LESSA</span>
                        </div>
                        
                        <div class="creci-info-compact">
                            <div class="creci-badge-compact">
                                <i class="fas fa-shield-alt"></i>
                                <span class="creci-label-compact">CRECI</span>
                                <span class="creci-number-compact">654/AL</span>
                            </div>
                            
                            <div class="certified-badge-compact">
                                <i class="fas fa-award"></i>
                                <span>CRECI CERTIFICADO</span>
                            </div>
                        </div>
                        
                        <div class="specialty-compact">
                            <i class="fas fa-home"></i>
                            <span class="specialty-title-compact">CORRETOR & CONSULTOR</span>
                            <span class="specialty-subtitle-compact">IMOBILIÁRIO | JURÍDICO</span>
                        </div>
                    </div>
                </div>
                
                <!-- Contato e Endereço (Lado Direito - Topo) -->
                <div class="contact-section">
                    <!-- Telefone/WhatsApp -->
                    <div class="phone-whatsapp-compact">
                        <div class="phone-icons-compact">
                            <i class="fas fa-mobile-alt"></i>
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="phone-number-compact">
                            <span class="phone-prefix-compact">(82)</span>
                            <span class="phone-main-compact">9.9604-4513</span>
                        </div>
                    </div>
                    
                    <!-- Endereço -->
                    <div class="address-compact">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="address-text-compact">
                            <span class="address-line-1">Empresarial Sizi & Neusa</span>
                            <span class="address-line-2">Praça São Vicente, 09</span>
                            <span class="address-line-3">Centro, Maceió-AL</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Layout Super Compacto -->
            <div class="mobile-header-ultimate">
                <!-- Linha 1: Logo + Nome + Telefone -->
                <div class="mobile-row-1">
                    <div class="mobile-logo-mini">
                        <span>WL</span>
                    </div>
                    
                    <div class="mobile-name-mini">
                        <span class="mobile-first-name-mini">WEBER</span>
                        <span class="mobile-last-name-mini">LESSA</span>
                    </div>
                    
                    <div class="mobile-phone-mini">
                        <i class="fas fa-mobile-alt"></i>
                        <i class="fab fa-whatsapp"></i>
                    </div>
                </div>
                
                <!-- Linha 2: CRECI + Especialização -->
                <div class="mobile-row-2">
                    <div class="mobile-creci-mini">
                        <i class="fas fa-shield-alt"></i>
                        <span>CRECI 654/AL</span>
                    </div>
                    
                    <div class="mobile-specialty-mini">
                        <i class="fas fa-home"></i>
                        <span>CORRETOR</span>
                    </div>
                </div>
                
                <!-- Linha 3: Endereço + Certificado -->
                <div class="mobile-row-3">
                    <div class="mobile-address-mini">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Emp. Sizi & Neusa</span>
                    </div>
                    
                    <div class="mobile-certified-mini">
                        <i class="fas fa-award"></i>
                        <span>CERTIFICADO</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Encontre seu imóvel dos sonhos em Maceió</h1>
        <p>Na orla mais bonita do Brasil, com a expertise de quem entende do mercado imobiliário alagoano</p>
        <a href="#properties" class="cta-button">
            <i class="fas fa-home"></i> Ver Imóveis
        </a>
    </section>

    <!-- Serviços Section -->
    <section class="services">
        <div class="section-title">
            <h2>Nossos Serviços Especializados</h2>
            <p>Oferecemos soluções completas para suas necessidades imobiliárias</p>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Equipe de Corretagem</h3>
                <p>Venda de lotes, imóveis residenciais, comerciais, sítios, incorporações, consultoria, avaliação de imóveis, chácaras e fazendas com equipe qualificada.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>Incorporação Imobiliária</h3>
                <p>Desenvolvemos empreendimentos de alto padrão com qualidade e inovação.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Financiamento Facilitado</h3>
                <p>Linhas bancárias com boleto facilitado e condições especiais para sua aquisição.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-gavel"></i>
                </div>
                <h3>Regularização de Imóveis</h3>
                <p>Usucapião, herança, inventário e toda documentação necessária para regularização.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>Minha Casa Minha Vida</h3>
                <p>Acesso facilitado ao programa governamental para realização do sonho da casa própria.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-tractor"></i>
                </div>
                <h3>Propriedades Rurais</h3>
                <p>Especialistas em sítios, chácaras e fazendas com documentação completa e regularizada.</p>
            </div>
        </div>
    </section>

    <!-- Imóveis Section -->
    <section class="properties" id="properties">
        <div class="section-title">
            <h2>Imóveis em Destaque</h2>
            <p>Confira nossas melhores oportunidades em Maceió e região</p>
        </div>
        
        <div class="filters">
            <h3>Filtrar por:</h3>
            <div class="filter-options">
                <button class="filter-btn active">Todos</button>
                <button class="filter-btn">Residencial</button>
                <button class="filter-btn">Comercial</button>
                <button class="filter-btn">Rural</button>
                <button class="filter-btn">Minha Casa Minha Vida</button>
            </div>
        </div>
        
        <div class="property-grid" id="properties-container">
            <!-- Os imóveis serão carregados aqui via JavaScript -->
        </div>
    </section>

    <!-- Sobre Section -->
    <section class="about">
        <div class="about-content">
            <div class="about-text">
                <h2>Sobre Weber Lessa</h2>
                <p>Com mais de 30 anos de experiência no mercado imobiliário de Maceió,com formação Jurídica e especialização em Direito Imobiliário a empresa Weber Lessa Corretor & Consultor - CRECI: 654/AL, se consolidou como referência em soluções imobiliárias completas e personalizadas.</p>
                <p>Nossa equipe especializada atua em todas as fases do processo: desde a assessoria na compra e venda, passando pela regularização documental, até o financiamento e incorporação de empreendimentos.</p>
                <p>Localizada no Empresarial Sizi & Neusa, no coração de Maceió, estamos prontos para ajudar você a realizar o sonho do imóvel próprio com segurança, transparência e expertise.</p>
            </div>
            <div class="about-image">
                <div>
                    <i class="fas fa-building"></i>
                    <p>Empresarial Sizi & Neusa</p>
                    <p>Sede Weber Lessa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Weber Lessa</h3>
                <p>Corretor & Consultor com tradição e qualidade no mercado imobiliário de Maceió desde 1995.</p>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <p><i class="fas fa-phone"></i> (82) 9.9604-4513</p>
                <p><i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa</p>
                <p>Praça São Vicente, 09 - Centro</p>
                <p>Maceió - AL, 57020-420</p>
                <p><i class="fas fa-clock"></i> Segunda a Sexta: 8h às 18h</p>
            </div>
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <a href="#properties">Imóveis</a>
                <a href="#services">Serviços</a>
                <a href="#about">Sobre Nós</a>
                <a href="#contact">Contato</a>
            </div>
            <div class="footer-section">
                <h3>Especialidades</h3>
                <a href="#">Venda de Imóveis</a>
                <a href="#">Aluguel de Imóveis</a>
                <a href="#">Propriedades Rurais</a>
                <a href="#">Incorporação</a>
                <a href="#">Financiamento</a>
                <a href="#">Regularização</a>
                <a href="#">Minha Casa Minha Vida</a>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Weber Lessa Corretor & Consultor - CRECI: 654/AL. Todos os direitos reservados.</p>
        </div>
    </footer>

<!-- ========== PAINEL DE ADMINISTRAÇÃO ATUALIZADO ========== -->
<section class="admin-panel" id="adminPanel">
    <h3 style="text-align: center; color: var(--primary); margin-bottom: 1.5rem;">
        <i class="fas fa-cog"></i> Painel do Corretor - Weber Lessa
    </h3>
    
    <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h4 id="formTitle">Adicionar Novo Imóvel</h4>
        <form id="propertyForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>Título do Imóvel *</strong></label>
                    <input type="text" id="propTitle" placeholder="Ex: Apartamento Vista Mar" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
                <div>
                    <label><strong>Preço *</strong></label>
                    <input type="text" id="propPrice" placeholder="Ex: R$ 450.000" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Localização *</strong></label>
                <input type="text" id="propLocation" placeholder="Ex: Ponta Verde, Maceió-AL" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Descrição</strong></label>
                <textarea id="propDescription" placeholder="Descreva o imóvel..." style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%; height: 100px;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Características (separadas por vírgula)</strong></label>
                <input type="text" id="propFeatures" placeholder="Ex: 2 Quartos, 1 Vaga, Piscina, Varanda" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                <small style="color: #666;">Separe por vírgulas</small>
            </div>

            <!-- ========== SEÇÃO UPLOAD DE PDFs ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Documentos PDF do Imóvel</strong></label>
                
                <div id="pdfUploadArea" style="border: 2px dashed #95a5a6; border-radius: 10px; padding: 1.5rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-file-pdf" style="font-size: 2rem; color: #95a5a6; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1rem; color: #555;">Clique ou arraste documentos PDF aqui</p>
                    <p style="margin: 0; font-size: 0.8rem; color: #888;">
                        <i class="fas fa-file-pdf"></i> Documentos técnicos e legais
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: #999;">Máximo: 5 arquivos • 10MB cada</p>
                </div>
                
                <input type="file" id="pdfFileInput" multiple accept=".pdf,application/pdf" style="display: none;">
                
                <div id="pdfUploadPreview" style="margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <!-- ========== SEÇÃO UPLOAD DE FOTOS/VIDEOS ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Fotos e Vídeos do Imóvel</strong></label>
                
                <div id="uploadArea" style="border: 2px dashed #ddd; border-radius: 10px; padding: 2rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1.1rem; color: #555;">Clique ou arraste fotos e vídeos aqui</p>
                    <p style="margin: 0; font-size: 0.9rem; color: #888;">
                        <i class="fas fa-image"></i> Fotos (JPG, PNG) • 
                        <i class="fas fa-video"></i> Vídeos (MP4)
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.8rem; color: #999;">Máximo: 10 arquivos • 5MB cada</p>
                </div>
                
                <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                
                <div id="uploadPreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>Tipo do Imóvel</strong></label>
                    <select id="propType" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="residencial">Residencial</option>
                        <option value="comercial">Comercial</option>
                        <option value="rural">Rural</option>
                    </select>
                </div>
                <div>
                    <label><strong>Destaque</strong></label>
                    <select id="propBadge" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="Novo">Novo</option>
                        <option value="Destaque">Destaque</option>
                        <option value="Luxo">Luxo</option>
                        <option value="MCMV">Minha Casa Minha Vida</option>
                        <option value="Fazenda">Fazenda</option>
                        <option value="Chácara">Chácara</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="propHasVideo"> 
                    <span><strong>Este imóvel tem vídeo?</strong></span>
                </label>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button type="submit" style="background: var(--success); color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; flex: 1; font-size: 1.1rem;">
                    <i class="fas fa-plus"></i> Adicionar Imóvel ao Site
                </button>
                <button type="button" id="cancelEditBtn" onclick="cancelEdit()" style="background: #95a5a6; color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; display: none;">
                    <i class="fas fa-times"></i> Cancelar Edição
                </button>
            </div>
        </form>
        
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
            <h4>Gerenciar Imóveis Existentes</h4>
            <p><small>Total de imóveis: <span id="propertyCount">0</span></small></p>
            <div id="propertyList"></div>
        </div>
    </div>
</section>

    <button class="admin-toggle" onclick="toggleAdminPanel()">
        <i class="fas fa-user-cog"></i>
    </button>

    <!-- ========== MODAL PARA DOCUMENTOS PDF ========== -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-modal-content">
            <h3 id="pdfModalTitle"><i class="fas fa-file-pdf"></i> Documentos do Imóvel</h3>
            <div id="pdfPreview" class="pdf-preview">
                <p>Documentos técnicos e legais disponíveis</p>
            </div>
            <input type="password" id="pdfPassword" class="pdf-password-input" placeholder="Digite a senha para acessar">
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button onclick="accessPdfDocuments()" style="background: var(--primary); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; flex: 1;">
                    <i class="fas fa-lock-open"></i> Acessar
                </button>
                <button onclick="closePdfModal()" style="background: #95a5a6; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            <p style="font-size: 0.8rem; color: #666; margin-top: 1rem;">
                <i class="fas fa-info-circle"></i> Solicite a senha ao corretor
            </p>
        </div>
    </div>

    <script>
// ========== DIRETRIZ CONSTITUCIONAL APERFEIÇOADA E EXPANDIDA ==========
const CONSTITUTIONAL_GUIDELINE = Object.freeze({
    // IDENTIFICAÇÃO E VERSÃO
    version: "2.0",
    established: "2024",
    lastRevision: new Date().toISOString().split('T')[0],
    developerAuthorization: "https://chat.deepseek.com",
    primaryContact: "Weber Lessa - CRECI 654/AL",
    
    // SEÇÕES IMUTÁVEIS (ESTRUTURA CORE - NÃO MODIFICAR)
    immutableSections: Object.freeze([
        "Estrutura Visual Principal",
        "Sistema de Administração (Painel do Corretor)",
        "Funcionalidades de Upload (Fotos e PDFs)",
        "Sistema de Exclusão de Imagens/PDFs",
        "Separação: Fotos Existentes vs Novas Fotos",
        "Separação: PDFs Existentes vs Novos PDFs",
        "Botão 'X' no canto superior direito para exclusão"
    ]),
    
    // PRINCÍPIOS FUNDAMENTAIS
    fundamentalPrinciples: Object.freeze({
        // PRINCÍPIO DA SEPARAÇÃO VISUAL
        visualSeparation: "Manter clara separação visual entre conteúdos existentes e novos",
        
        // PRINCÍPIO DA CONSISTÊNCIA
        consistency: "Manter formato consistente entre elementos equivalentes (botões 'X' sempre no mesmo lugar)",
        
        // PRINCÍPIO DA NÃO DUPLICAÇÃO
        noDuplication: "Não criar funções duplicadas para mesma finalidade",
        
        // PRINCÍPIO DA MANUTENIBILIDADE
        maintainability: "Maximizar uso de funções existentes em vez de criar novas",
        
        // PRINCÍPIO DA PRESERVAÇÃO ESTRUTURAL
        structuralPreservation: "Não modificar estrutura visual aprovada sem autorização expressa"
    }),
    
    // ESTRUTURAS VISUAIS APROVADAS
    approvedVisualStructures: Object.freeze({
        uploadSections: Object.freeze({
            existingImages: {
                title: "📸 Fotos atuais do imóvel (clique no X para excluir):",
                borderColor: "2px solid var(--success)",
                buttonColor: "#e74c3c"
            },
            newImages: {
                title: "📸 Novas fotos a serem adicionadas:",
                borderColor: "2px dashed #3498db",
                buttonColor: "#3498db"
            },
            existingPdfs: {
                title: "📄 Documentos atuais do imóvel (clique no X para excluir):",
                borderColor: "2px solid var(--success)",
                buttonColor: "#e74c3c"
            },
            newPdfs: {
                title: "📄 Novos documentos a serem adicionados:",
                borderColor: "2px dashed #3498db",
                buttonColor: "#3498db"
            }
        }),
        
        buttonPositions: Object.freeze({
            deleteButton: "position: absolute; top: -8px; right: -8px;",
            alwaysVisible: "Botão 'X' deve ser SEMPRE visível no canto superior direito"
        })
    }),
    
    // SISTEMA DE UPLOAD - ESPECIFICAÇÕES TÉCNICAS
    uploadSystem: Object.freeze({
        images: Object.freeze({
            maxFiles: 10,
            maxSizeMB: 5,
            acceptedTypes: ["image/*", "video/*"],
            methods: Object.freeze(["drag-drop", "click-browse"])
        }),
        pdfs: Object.freeze({
            maxFiles: 5,
            maxSizeMB: 10,
            acceptedTypes: ["application/pdf"],
            methods: Object.freeze(["drag-drop", "click-browse"])
        })
    }),
    
    // POLÍTICA DE MODIFICAÇÃO
    modificationPolicy: Object.freeze({
        // RESTRIÇÕES
        restrictions: [
            "Nenhuma modificação estrutural pode ser realizada sem autorização expressa via plataforma oficial",
            "Não alterar posição, cor ou comportamento dos botões de exclusão ('X')",
            "Manter títulos das seções exatamente como definidos",
            "Não criar funções duplicadas para operações já existentes"
        ],
        
        // PROCESSO DE APROVAÇÃO
        approvalProcess: [
            "1. Identificar necessidade específica",
            "2. Verificar funções existentes que possam atender",
            "3. Se necessário criar nova função, justificar por escrito",
            "4. Submeter para revisão via chat.deepseek.com",
            "5. Implementar apenas após aprovação explícita"
        ],
        
        // PARA NOVOS DESENVOLVEDORES/ASSISTENTES
        instructionsForNewContributors: [
            "ESTE SCRIPT TEM ESTRUTURA ESTABELECIDA E APROVADA",
            "Antes de sugerir alterações, estudar as funções existentes",
            "Sempre maximizar uso do que já existe",
            "Se encontrar problema, verificar primeiro configurações locais (VPN, firewall, cache)",
            "Problemas intermitentes são frequentemente de conexão, não de código"
        ]
    }),
    
    // REGISTRO DE PROBLEMAS CONHECIDOS E SOLUÇÕES
    knownIssuesRegistry: Object.freeze({
        // ISSUE #001: Click intermitente no upload
        uploadClickIntermittent: Object.freeze({
            description: "Click via mouse funciona intermitentemente em algumas máquinas",
            rootCause: "Configurações locais (VPN, firewall, extensões do navegador)",
            solution: "Testar em múltiplos dispositivos, limpar cache, desativar VPN temporariamente",
            status: "IDENTIFICADO - não é bug do código",
            workaround: "Usar drag & drop que funciona 100%"
        }),
        
        // ISSUE #002: Problemas de conexão com Supabase
        supabaseConnection: Object.freeze({
            description: "Erros intermitentes de conexão com Supabase",
            rootCause: "Configuração inicial feita com VPN ativa",
            solution: "Verificar credenciais sem VPN, testar conexão direta",
            status: "RESOLVIDO - usar conexão direta sem VPN"
        })
    }),
    
    // VERIFICAÇÃO DE CONFORMIDADE
    complianceCheck: function() {
        console.log('🔍 VERIFICAÇÃO DE CONFORMIDADE CONSTITUCIONAL');
        console.log('=============================================');
        
        const checks = {
            uploadSections: {
                existingImages: !!document.getElementById('existingImagesSection'),
                newImages: !!document.getElementById('newImagesSection'),
                existingPdfs: !!document.getElementById('existingPdfsSection'),
                newPdfs: !!document.getElementById('newPdfsSection')
            },
            
            coreFunctions: {
                cancelEdit: typeof cancelEdit === 'function',
                showNewImagePreview: typeof showNewImagePreview === 'function',
                handleFiles: typeof handleFiles === 'function',
                setupUploadSystem: typeof setupUploadSystem === 'function'
            },
            
            structuralIntegrity: {
                buttonsExist: document.querySelectorAll('.delete-image-btn').length > 0,
                sectionsTitles: this.checkSectionTitles()
            }
        };
        
        // Exibir resultados
        Object.entries(checks).forEach(([category, items]) => {
            console.log(`\n${category.toUpperCase()}:`);
            Object.entries(items).forEach(([item, result]) => {
                console.log(`  ${item}: ${result ? '✅' : '❌'}`);
            });
        });
        
        console.log('\n=============================================');
        console.log('✅ VERIFICAÇÃO CONSTITUCIONAL COMPLETA');
        
        return checks;
    },
    
    // Método auxiliar para verificar títulos
    checkSectionTitles: function() {
        const titles = this.approvedVisualStructures.uploadSections;
        let allCorrect = true;
        
        Object.entries(titles).forEach(([section, config]) => {
            const element = document.querySelector(`#${section}Section p`);
            if (element && element.textContent !== config.title) {
                console.warn(`⚠️ Título incorreto em ${section}: "${element.textContent}"`);
                allCorrect = false;
            }
        });
        
        return allCorrect;
    }
});

// Função de verificação obrigatória
function enforceConstitutionalGuideline() {
    console.log('🏛️ APLICANDO DIRETRIZ CONSTITUCIONAL DO SCRIPT');
    
    try {
        // Verificar se há tentativas de modificação não autorizadas
        const originalStructure = {
            adminPanel: document.getElementById('adminPanel') !== null,
            propertyForm: document.getElementById('propertyForm') !== null,
            uploadPreview: document.getElementById('uploadPreview') !== null,
            pdfUploadPreview: document.getElementById('pdfUploadPreview') !== null
        };
        
        // Monitorar elementos críticos
        const criticalElements = [
            'adminPanel', 'propertyForm', 'uploadPreview', 
            'pdfUploadPreview', 'existingImagesSection', 'newImagesSection'
        ];
        
        let violations = [];
        criticalElements.forEach(elementId => {
            const element = document.getElementById(elementId);
            if (!element) {
                violations.push(`Elemento crítico ${elementId} ausente`);
                console.error(`❌ VIOLAÇÃO DA DIRETRIZ: ${elementId} removido!`);
            }
        });
        
        if (violations.length > 0) {
            console.error('🚨 VIOLAÇÕES DETECTADAS:', violations);
            alert('ATENÇÃO: Estrutura do sistema comprometida. Restaure o backup original.');
        } else {
            console.log('✅ Estrutura constitucional preservada');
            
            // Executar verificação de conformidade
            CONSTITUTIONAL_GUIDELINE.complianceCheck();
        }
        
    } catch (error) {
        console.error('❌ Erro na verificação constitucional:', error);
    }
    
    console.log('✅ Diretriz Constitucional verificada e aplicada\n');
}

// ========== MONITOR CONSTITUCIONAL SIMPLES (DENTRO DO PAINEL ADMIN) ==========
function createAdminMonitor() {
    console.log('🔧 Criando monitor dentro do painel admin...');
    
    // Encontrar o painel admin
    const adminPanel = document.getElementById('adminPanel');
    if (!adminPanel) {
        console.error('❌ Painel admin não encontrado');
        return;
    }
    
    // Verificar se já existe monitor
    if (document.getElementById('adminMonitor')) {
        return;
    }
    
    // Criar container do monitor (estilo console F12)
    const monitorContainer = document.createElement('div');
    monitorContainer.id = 'adminMonitor';
    monitorContainer.style.cssText = `
        margin-top: 20px;
        border-top: 1px solid #dee2e6;
        padding-top: 15px;
        font-family: 'Monaco', 'Consolas', monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        background: #f8f9fa;
        border-radius: 5px;
        padding: 10px;
        display: none; /* Inicialmente oculto */
    `;
    
    // Título do monitor
    const monitorTitle = document.createElement('div');
    monitorTitle.style.cssText = `
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px solid #ddd;
    `;
    
    const titleText = document.createElement('span');
    titleText.textContent = '📋 Monitor do Sistema';
    titleText.style.fontWeight = '600';
    titleText.style.color = '#2c3e50';
    
    const toggleBtn = document.createElement('button');
    toggleBtn.innerHTML = '−';
    toggleBtn.style.cssText = `
        background: #6c757d;
        color: white;
        border: none;
        width: 20px;
        height: 20px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
    `;
    toggleBtn.onclick = function() {
        const logsArea = document.getElementById('monitorLogsArea');
        if (logsArea.style.display === 'none') {
            logsArea.style.display = 'block';
            this.innerHTML = '−';
        } else {
            logsArea.style.display = 'none';
            this.innerHTML = '+';
        }
    };
    
    monitorTitle.appendChild(titleText);
    monitorTitle.appendChild(toggleBtn);
    monitorContainer.appendChild(monitorTitle);
    
    // Área de logs
    const logsArea = document.createElement('div');
    logsArea.id = 'monitorLogsArea';
    logsArea.style.cssText = `
        max-height: 150px;
        overflow-y: auto;
        font-size: 11px;
        line-height: 1.3;
        background: white;
        padding: 8px;
        border-radius: 3px;
        border: 1px solid #e9ecef;
    `;
    
    monitorContainer.appendChild(logsArea);
    
    // Status bar
    const statusBar = document.createElement('div');
    statusBar.id = 'monitorStatusBar';
    statusBar.style.cssText = `
        margin-top: 8px;
        padding-top: 5px;
        border-top: 1px solid #ddd;
        font-size: 10px;
        color: #6c757d;
        text-align: right;
    `;
    statusBar.textContent = 'Pronto';
    
    monitorContainer.appendChild(statusBar);
    
    // Adicionar ao painel admin (após a lista de imóveis)
    const propertyList = document.getElementById('propertyList');
    if (propertyList && propertyList.parentNode) {
        propertyList.parentNode.insertBefore(monitorContainer, propertyList.nextSibling);
    } else {
        adminPanel.appendChild(monitorContainer);
    }
    
    console.log('✅ Monitor criado dentro do painel admin');
    return monitorContainer;
}

// ========== SISTEMA DE LOGS SIMPLES ==========
const SystemMonitor = {
    logs: [],
    maxLogs: 50,
    
    // Adicionar log
    log: function(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = { time: timestamp, message: message, type: type };
        
        // Adicionar à memória
        this.logs.push(logEntry);
        if (this.logs.length > this.maxLogs) {
            this.logs.shift(); // Remove o mais antigo
        }
        
        // Atualizar display se monitor visível
        this.updateDisplay();
        
        // Também logar no console real
        const consoleMsg = `[${timestamp}] ${message}`;
        if (type === 'error') console.error(consoleMsg);
        else if (type === 'warn') console.warn(consoleMsg);
        else console.log(consoleMsg);
    },
    
    // Atualizar display
    // NO SystemMonitor, substitua a função updateDisplay:
updateDisplay: function() {
    const logsArea = document.getElementById('monitorLogsArea');
    const statusBar = document.getElementById('monitorStatusBar');
    
    if (!logsArea || !statusBar) return;
    
    // Limpar e recriar logs
    logsArea.innerHTML = '';
    
    this.logs.forEach(log => {
        const logLine = document.createElement('div');
        logLine.style.cssText = `
            margin-bottom: 2px;
            padding: 2px 4px;
            border-radius: 2px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            ${log.type === 'error' ? 'background: #fee; color: #c7254e;' : ''}
            ${log.type === 'warn' ? 'background: #fff3cd; color: #856404;' : ''}
            ${log.type === 'success' ? 'background: #d4edda; color: #155724;' : ''}
        `;
        
        logLine.innerHTML = `<span style="color: #6c757d;">[${log.time}]</span> ${log.message}`;
        logsArea.appendChild(logLine);
    });
    
    // Auto-scroll
    logsArea.scrollTop = logsArea.scrollHeight;
    
    // CORREÇÃO: Usar this.logs para pegar timestamp
    const lastLog = this.logs[this.logs.length - 1];
    if (lastLog) {
        statusBar.textContent = `Última: ${lastLog.time} | Total: ${this.logs.length} logs`;
    } else {
        statusBar.textContent = 'Pronto | Total: 0 logs';
    }
},
    
    // Verificação rápida do sistema
    quickCheck: function() {
        this.log('🔍 Verificação rápida do sistema...');
        
        // Verificar elementos essenciais
        const essentials = ['adminPanel', 'propertyForm', 'uploadPreview', 'pdfUploadPreview'];
        essentials.forEach(id => {
            if (document.getElementById(id)) {
                this.log(`✅ ${id} encontrado`, 'success');
            } else {
                this.log(`❌ ${id} AUSENTE`, 'error');
            }
        });
        
        // Verificar botões de exclusão
        const deleteButtons = document.querySelectorAll('.delete-image-btn');
        if (deleteButtons.length > 0) {
            this.log(`✅ ${deleteButtons.length} botões de exclusão funcionais`, 'success');
        }
        
        this.log('✅ Verificação completa');
    },
    
    // Limpar logs
    clear: function() {
        this.logs = [];
        this.updateDisplay();
        this.log('🧹 Logs limpos');
    }
};

// ========== INTEGRAÇÃO COM O SISTEMA ==========
function setupAdminMonitor() {
    // Criar monitor quando admin abrir
    const adminPanel = document.getElementById('adminPanel');
    if (adminPanel && adminPanel.style.display === 'block') {
        createAdminMonitor();
        
        // Mostrar monitor
        const monitor = document.getElementById('adminMonitor');
        if (monitor) {
            monitor.style.display = 'block';
            SystemMonitor.log('🟢 Monitor do sistema ativado');
            SystemMonitor.quickCheck();
        }
    }
}

// ========== SUBSTITUIR A FUNÇÃO toggleAdminPanel ==========
const originalToggleAdminPanel = toggleAdminPanel;
toggleAdminPanel = function() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        originalToggleAdminPanel();
        
        // Após abrir painel, configurar monitor
        setTimeout(() => {
            setupAdminMonitor();
        }, 300);
    } else {
        alert("Senha incorreta!");
    }
};

// ========== MONITORAR EVENTOS DO SISTEMA ==========
function monitorSystemEvents() {
    // Monitorar função handleFiles
    const originalHandleFiles = handleFiles;
    if (originalHandleFiles) {
        handleFiles = function(files) {
            SystemMonitor.log(`📸 ${files.length} arquivo(s) para upload`);
            return originalHandleFiles.apply(this, arguments);
        };
    }
    
    // Monitorar edição
    const originalEditProperty = editProperty;
    if (originalEditProperty) {
        editProperty = function(id) {
            SystemMonitor.log(`🏠 Editando imóvel ID: ${id}`);
            return originalEditProperty.apply(this, arguments);
        };
    }
    
    // Monitorar salvamento
    const originalSaveProperty = saveProperty;
    if (originalSaveProperty) {
        saveProperty = function(propertyData) {
            SystemMonitor.log(`💾 Salvando: "${propertyData.title.substring(0, 30)}..."`);
            return originalSaveProperty.apply(this, arguments);
        };
    }
    
    // Monitorar exclusão
    const originalDeleteProperty = deleteProperty;
    if (originalDeleteProperty) {
        deleteProperty = function(id) {
            SystemMonitor.log(`🗑️ Excluindo imóvel ID: ${id}`);
            return originalDeleteProperty.apply(this, arguments);
        };
    }
    
    SystemMonitor.log('✅ Monitoramento de eventos configurado');
}

// ========== ATUALIZAR enforceConstitutionalGuideline ==========
function enforceConstitutionalGuideline() {
    // Apenas inicializar monitoramento
    setTimeout(() => {
        if (typeof setupAdminMonitor === 'function') {
            setupAdminMonitor();
        }
        if (typeof monitorSystemEvents === 'function') {
            monitorSystemEvents();
        }
    }, 1000);
}

// ========== ADICIONAR BOTÃO DE CONTROLE NO PAINEL ==========
function addMonitorControls() {
    const adminPanel = document.getElementById('adminPanel');
    if (!adminPanel) return;
    
    // Criar barra de controles
    const controlsBar = document.createElement('div');
    controlsBar.style.cssText = `
        display: flex;
        gap: 8px;
        margin: 10px 0;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #dee2e6;
    `;
    
    // Botão Verificar
    const checkBtn = document.createElement('button');
    checkBtn.innerHTML = '🔍 Verificar Sistema';
    checkBtn.style.cssText = `
        padding: 6px 12px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    `;
    checkBtn.onclick = () => SystemMonitor.quickCheck();
    
    // Botão Limpar
    const clearBtn = document.createElement('button');
    clearBtn.innerHTML = '🧹 Limpar Logs';
    clearBtn.style.cssText = `
        padding: 6px 12px;
        background: #95a5a6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    `;
    clearBtn.onclick = () => SystemMonitor.clear();
    
    controlsBar.appendChild(checkBtn);
    controlsBar.appendChild(clearBtn);
    
    // Adicionar após o título do painel
    const panelTitle = adminPanel.querySelector('h3');
    if (panelTitle) {
        panelTitle.parentNode.insertBefore(controlsBar, panelTitle.nextSibling);
    } else {
        adminPanel.insertBefore(controlsBar, adminPanel.firstChild);
    }
}

// ========== INICIALIZAR QUANDO ADMIN ABRIR ==========
// Monitorar quando o painel ficar visível
const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            const adminPanel = document.getElementById('adminPanel');
            if (adminPanel && adminPanel.style.display === 'block') {
                setTimeout(() => {
                    setupAdminMonitor();
                    addMonitorControls();
                }, 500);
            }
        }
    });
});

// Iniciar observação quando DOM carregar
document.addEventListener('DOMContentLoaded', function() {
    const adminPanel = document.getElementById('adminPanel');
    if (adminPanel) {
        observer.observe(adminPanel, { attributes: true });
    }
});


// Adicionar estilos ao documento
const styleSheet = document.createElement("style");
styleSheet.textContent = galleryStyles;
document.head.appendChild(styleSheet);

// Variáveis globais para a galeria
let currentGalleryImages = [];
let currentGalleryIndex = 0;
let touchStartX = 0;
let touchEndX = 0;
const SWIPE_THRESHOLD = 50;

// ========== FUNÇÃO PARA CRIAR GALERIA NO IMÓVEL ==========
function createPropertyGallery(property) {
    // Verificar se há imagens
    const hasImages = property.images && 
                     property.images.length > 0 && 
                     property.images !== 'EMPTY';
    
    const imageUrls = hasImages ? 
        property.images.split(',').filter(url => url.trim() !== '') : 
        [];
    
    const firstImageUrl = imageUrls.length > 0 ? 
        imageUrls[0] : 
        'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
    
    // Se só tem uma imagem, mostrar imagem estática
    if (imageUrls.length <= 1) {
        return `
            <div class="property-image ${property.rural ? 'rural-image' : ''}" style="position: relative; height: 250px;">
                <img src="${firstImageUrl}" 
                     style="width: 100%; height: 100%; object-fit: cover;"
                     alt="${property.title}"
                     onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                ${property.badge ? `<div class="property-badge ${property.rural ? 'rural-badge' : ''}">${property.badge}</div>` : ''}
                ${property.has_video ? `<div class="video-indicator"><i class="fas fa-video"></i> TEM VÍDEO</div>` : ''}
                ${imageUrls.length > 0 ? `<div class="image-count">${imageUrls.length}</div>` : ''}
                
                ${hasImages && property.pdfs && property.pdfs !== 'EMPTY' ? 
                    `<button class="pdf-access" onclick="showPdfModal(${property.id})" title="Documentos do imóvel (senha: doc123)">
                        <i class="fas fa-file-pdf"></i>
                    </button>` : ''}
            </div>
        `;
    }
    
    // Se tem múltiplas imagens, criar galeria
    return `
        <div class="property-image ${property.rural ? 'rural-image' : ''}" style="position: relative; height: 250px;">
            <div class="property-gallery-container" onclick="openGallery(${property.id})">
                <img src="${firstImageUrl}" 
                     class="property-gallery-image"
                     alt="${property.title}"
                     onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                
                <!-- Indicador de galeria MOBILE -->
                <div class="gallery-indicator-mobile">
                    <i class="fas fa-images"></i>
                    <span>${imageUrls.length}</span>
                </div>
                
                <!-- Pontos indicadores -->
                <div class="gallery-controls">
                    ${imageUrls.map((_, index) => `
                        <div class="gallery-dot ${index === 0 ? 'active' : ''}" 
                             data-index="${index}"
                             onclick="event.stopPropagation(); showGalleryImage(${property.id}, ${index})"></div>
                    `).join('')}
                </div>
                
                <!-- Ícone de expansão -->
                <div class="gallery-expand-icon" onclick="openGallery(${property.id})">
                    <i class="fas fa-expand"></i>
                </div>
            </div>
            
            ${property.badge ? `<div class="property-badge ${property.rural ? 'rural-badge' : ''}">${property.badge}</div>` : ''}
            ${property.has_video ? `<div class="video-indicator"><i class="fas fa-video"></i> TEM VÍDEO</div>` : ''}
            
            <!-- Botão PDF (agora no canto inferior direito) -->
            ${hasImages && property.pdfs && property.pdfs !== 'EMPTY' ? 
                `<button class="pdf-access" onclick="event.stopPropagation(); showPdfModal(${property.id})" title="Documentos do imóvel (senha: doc123)">
                    <i class="fas fa-file-pdf"></i>
                </button>` : ''}
        </div>
    `;
}

// ========== FUNÇÃO PARA ABRIR GALERIA ==========
function openGallery(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;
    
    const hasImages = property.images && 
                     property.images.length > 0 && 
                     property.images !== 'EMPTY';
    
    if (!hasImages) return;
    
    currentGalleryImages = property.images.split(',').filter(url => url.trim() !== '');
    currentGalleryIndex = 0;
    
    // Criar ou atualizar modal da galeria
    let galleryModal = document.getElementById('propertyGalleryModal');
    
    if (!galleryModal) {
        galleryModal = document.createElement('div');
        galleryModal.id = 'propertyGalleryModal';
        galleryModal.className = 'gallery-modal';
        galleryModal.innerHTML = `
            <div class="gallery-modal-content">
                <!-- Área para swipe -->
                <div class="gallery-swipe-area" 
                     ontouchstart="handleTouchStart(event)"
                     ontouchend="handleTouchEnd(event)"></div>
                
                <!-- Imagem -->
                <img id="galleryCurrentImage" class="gallery-modal-image" 
                     src="${currentGalleryImages[0]}"
                     alt="Imagem ${currentGalleryIndex + 1} de ${currentGalleryImages.length}">
                
                <!-- Controles -->
                <div class="gallery-modal-controls">
                    <button class="gallery-modal-btn" onclick="prevGalleryImage()" 
                            aria-label="Imagem anterior">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <div id="galleryCounter" class="gallery-counter">
                        ${currentGalleryIndex + 1} / ${currentGalleryImages.length}
                    </div>
                    
                    <button class="gallery-modal-btn" onclick="nextGalleryImage()" 
                            aria-label="Próxima imagem">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <!-- Botão fechar -->
                <button class="gallery-modal-close" onclick="closeGallery()" 
                        aria-label="Fechar galeria">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        document.body.appendChild(galleryModal);
        
        // Adicionar suporte a teclado
        document.addEventListener('keydown', handleGalleryKeyboard);
    } else {
        // Atualizar imagem atual
        document.getElementById('galleryCurrentImage').src = currentGalleryImages[0];
        document.getElementById('galleryCounter').textContent = 
            `${currentGalleryIndex + 1} / ${currentGalleryImages.length}`;
    }
    
    // Mostrar modal
    galleryModal.style.display = 'block';
    document.body.style.overflow = 'hidden'; // Prevenir scroll
    
    // Focar no botão fechar para acessibilidade
    setTimeout(() => {
        const closeBtn = galleryModal.querySelector('.gallery-modal-close');
        if (closeBtn) closeBtn.focus();
    }, 100);
}

// ========== FUNÇÃO PARA FECHAR GALERIA ==========
function closeGallery() {
    const galleryModal = document.getElementById('propertyGalleryModal');
    if (galleryModal) {
        galleryModal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Restaurar scroll
        
        // Remover listener de teclado
        document.removeEventListener('keydown', handleGalleryKeyboard);
        
        // Retornar foco para o elemento que abriu a galeria
        if (lastGalleryOpener) {
            lastGalleryOpener.focus();
            lastGalleryOpener = null;
        }
    }
}

// ========== FUNÇÕES DE NAVEGAÇÃO DA GALERIA ==========
function showGalleryImage(propertyId, index) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;
    
    const hasImages = property.images && 
                     property.images.length > 0 && 
                     property.images !== 'EMPTY';
    
    if (!hasImages) return;
    
    const images = property.images.split(',').filter(url => url.trim() !== '');
    if (index < 0 || index >= images.length) return;
    
    // Atualizar imagem no card
    const container = document.querySelector(`[onclick="openGallery(${propertyId})"]`);
    if (container) {
        const img = container.querySelector('.property-gallery-image');
        if (img) {
            img.src = images[index];
            img.onerror = function() {
                this.src = 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
            };
        }
        
        // Atualizar dots ativos
        const dots = container.querySelectorAll('.gallery-dot');
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
    }
}

function nextGalleryImage() {
    if (currentGalleryImages.length === 0) return;
    
    currentGalleryIndex = (currentGalleryIndex + 1) % currentGalleryImages.length;
    updateGalleryModal();
}

function prevGalleryImage() {
    if (currentGalleryImages.length === 0) return;
    
    currentGalleryIndex = (currentGalleryIndex - 1 + currentGalleryImages.length) % currentGalleryImages.length;
    updateGalleryModal();
}

function updateGalleryModal() {
    const imageElement = document.getElementById('galleryCurrentImage');
    const counterElement = document.getElementById('galleryCounter');
    
    if (imageElement && counterElement) {
        imageElement.src = currentGalleryImages[currentGalleryIndex];
        counterElement.textContent = `${currentGalleryIndex + 1} / ${currentGalleryImages.length}`;
        
        // Animar transição
        imageElement.style.opacity = '0';
        setTimeout(() => {
            imageElement.style.opacity = '1';
        }, 50);
    }
}

// ========== SUPPORTE A SWIPE PARA MOBILE ==========
function handleTouchStart(event) {
    touchStartX = event.changedTouches[0].screenX;
    event.stopPropagation();
}

function handleTouchEnd(event) {
    touchEndX = event.changedTouches[0].screenX;
    handleSwipe();
    event.stopPropagation();
}

function handleSwipe() {
    const diff = touchStartX - touchEndX;
    
    // Swipe esquerda (próxima imagem)
    if (diff > SWIPE_THRESHOLD) {
        nextGalleryImage();
    }
    // Swipe direita (imagem anterior)
    else if (diff < -SWIPE_THRESHOLD) {
        prevGalleryImage();
    }
}

// ========== SUPORTE A TECLADO ==========
function handleGalleryKeyboard(event) {
    const galleryModal = document.getElementById('propertyGalleryModal');
    if (!galleryModal || galleryModal.style.display !== 'block') return;
    
    switch(event.key) {
        case 'ArrowLeft':
            prevGalleryImage();
            event.preventDefault();
            break;
        case 'ArrowRight':
            nextGalleryImage();
            event.preventDefault();
            break;
        case 'Escape':
            closeGallery();
            event.preventDefault();
            break;
        case ' ':
        case 'Enter':
            // Evitar comportamento padrão do espaço
            if (event.target.tagName !== 'BUTTON') {
                event.preventDefault();
            }
            break;
    }
}
        
// ========== CONFIGURAÇÃO SUPABASE ==========
const SUPABASE_URL = 'https://syztbxvpdaplpetmixmt.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5enRieHZwZGFwbHBldG1peG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxODY0OTAsImV4cCI6MjA3OTc2MjQ5MH0.SISlMoO1kLWbIgx9pze8Dv1O-kfQ_TAFDX6yPUxfJxo';

// ========== ESTILOS DA GALERIA DE IMÓVEIS ==========
const galleryStyles = `
/* ========== GALERIA DE IMÓVEIS - MOBILE FIRST ========== */
.property-gallery-container {
    position: relative;
    width: 100%;
    height: 250px;
    overflow: hidden;
    cursor: pointer;
}

.property-gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.property-gallery-image:hover {
    transform: scale(1.02);
}

/* Controles da galeria MOBILE */
.gallery-controls {
    position: absolute;
    bottom: 10px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 8px;
    z-index: 5;
    padding: 0 10px;
}

.gallery-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.gallery-dot.active {
    background: white;
    transform: scale(1.2);
}

/* Indicador de múltiplas fotos (MOBILE) */
.gallery-indicator-mobile {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    z-index: 5;
    display: flex;
    align-items: center;
    gap: 4px;
    backdrop-filter: blur(4px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Modal da galeria FULLSCREEN - MOBILE FIRST */
.gallery-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10000;
    touch-action: pan-y pinch-zoom;
}

.gallery-modal-content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Imagem principal no modal */
.gallery-modal-image {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
    margin: 0 auto;
    display: block;
    -webkit-user-select: none;
    user-select: none;
    touch-action: manipulation;
}

/* Controles do modal MOBILE */
.gallery-modal-controls {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    z-index: 10;
    padding: 0 20px;
}

.gallery-modal-btn {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: #333;
    cursor: pointer;
    transition: all 0.3s ease;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.gallery-modal-btn:active {
    transform: scale(0.95);
    background: white;
}

.gallery-modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #333;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.gallery-modal-close:active {
    transform: scale(0.95);
    background: white;
}

/* Contador no modal */
.gallery-counter {
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    background: rgba(0, 0, 0, 0.5);
    padding: 6px 12px;
    border-radius: 20px;
    min-width: 70px;
    text-align: center;
}

/* Swipe para mobile */
.gallery-swipe-area {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 5;
}

/* Ícone de expansão na imagem principal */
.gallery-expand-icon {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    z-index: 5;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.gallery-expand-icon:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
}

/* Para Desktop - ajustes */
@media (min-width: 768px) {
    .gallery-indicator-mobile {
        top: 15px;
        right: 15px;
        padding: 6px 12px;
        font-size: 0.8rem;
    }
    
    .gallery-controls {
        bottom: 15px;
        gap: 10px;
    }
    
    .gallery-dot {
        width: 10px;
        height: 10px;
    }
    
    .gallery-modal-btn {
        width: 50px;
        height: 50px;
        font-size: 1.3rem;
    }
    
    .gallery-modal-close {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        top: 30px;
        right: 30px;
    }
    
    .gallery-counter {
        font-size: 1rem;
        padding: 8px 16px;
    }
}

/* Animações */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.gallery-modal {
    animation: fadeIn 0.3s ease;
}

/* Suporte a landscape mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .gallery-modal-image {
        max-height: 85vh;
    }
    
    .gallery-modal-controls {
        bottom: 10px;
    }
}

/* Melhorias de acessibilidade */
.gallery-modal-btn:focus,
.gallery-modal-close:focus {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Prevenção de seleção de texto */
.gallery-modal-content {
    -webkit-user-select: none;
    user-select: none;
}
`;
        
console.log('🚀 Weber Lessa Imóveis - Sistema Iniciado');

// ========== SISTEMA DE IMÓVEIS ==========
let properties = [];
let editingPropertyId = null;
let selectedFiles = [];
let selectedPdfFiles = [];

// Dados iniciais com IMAGENS de exemplo
function getInitialProperties() {
    return [
        {
            id: 1,
            title: "Casa 2Qtos - Forene",
            price: "R$ 180.000",
            location: "Residência Conj. Portal do Renascer, Forene",
            description: "Casa a 100m do CEASA; - Medindo 6,60m frente X 19m lado; - 125,40m² de área total; -Somente um único dono; - 02 Quartos, Sala; - Cozinha; - 02 Banheiros; - Varanda; - 02 Vagas de garagem; - Água de Poço Artesiano;",
            features: ["02 Quartos", "Sala", "Cozinha", "02 Banheiros", "Varanda", "02 Vagas de carro"],
            type: "residencial",
            has_video: true,
            badge: "Destaque",
            rural: false,
            images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            created_at: new Date().toISOString()
        },
        {
            id: 2,
            title: "Apartamento 4Qtos (178m²) - Ponta Verde",
            price: "R$ 1.500.000",
            location: "Rua Saleiro Pitão, Ponta Verde - Maceió/AL",
            description: "Apartamento amplo, super claro e arejado, imóvel diferenciado com 178m² de área privativa, oferecendo conforto, espaço e alto padrão de acabamento. 4 Qtos, sendo 03 suítes, sala ampla com varanda, cozinha, dependência de empregada, área de serviço, 02 vagas de garagem no subsolo.",
            features: ["4Qtos s/ 3 suítes", "Sala ampla com varanda", "Cozinha", "Área de serviço", "DCE", "02 vagas de garagem"],
            type: "residencial",
            has_video: false,
            badge: "Luxo",
            rural: false,
            images: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            created_at: new Date().toISOString()
        }
    ];
}

// ========== CORREÇÃO DO CARREGAMENTO DE IMÓVEIS ==========
async function loadProperties() {
    try {
        console.log('📡 Carregando imóveis do Supabase...');
        
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=*`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            properties = Array.isArray(data) ? data : [];
            console.log(`✅ ${properties.length} imóveis carregados do Supabase`);
            
            // CORREÇÃO CRÍTICA: Garantir que todos os campos sejam tratados corretamente
            properties = properties.map(property => {
                // Se images estiver vazio, usar imagens padrão
                if (!property.images || property.images === 'EMPTY' || property.images.trim() === '') {
                    property.images = "https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                
                // CORREÇÃO: Garantir que pdfs seja sempre uma string válida
                if (!property.pdfs || property.pdfs === 'null' || property.pdfs === 'undefined') {
                    property.pdfs = '';
                }
                
                return property;
            });
            
        } else {
            console.log('⚠️ Supabase não acessível, usando dados locais');
            throw new Error('Supabase não disponível');
        }
        
    } catch (error) {
        console.log('🔄 Carregando dados locais...', error);
        const localData = localStorage.getItem('weberlessa_properties');
        properties = localData ? JSON.parse(localData) : getInitialProperties();
    }
    
    renderProperties();
    checkPdfData();
    debugPropertyData();
}

// ========== NOVA FUNÇÃO: MOSTRAR PREVIEW DE NOVAS IMAGENS ==========
// ========== CORREÇÃO DA FUNÇÃO showNewImagePreview() ==========
// ========== FUNÇÃO showNewImagePreview() ATUALIZADA ==========
function showNewImagePreview() {
    console.log('🔍 showNewImagePreview() chamada com', selectedFiles.length, 'arquivos');
    
    const preview = document.getElementById('uploadPreview');
    if (!preview) {
        console.error('❌ Elemento uploadPreview não encontrado!');
        return;
    }
    
    // Verificar se já existe seção de novas imagens
    let newImagesSection = document.getElementById('newImagesSection');
    
    if (!newImagesSection) {
        console.log('⚠️ Seção de novas imagens não encontrada, criando...');
        const existingSection = document.getElementById('existingImagesSection');
        if (existingSection) {
            // Criar após a seção existente
            newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📸 Novas fotos a serem adicionadas:</p>';
            existingSection.parentNode.insertBefore(newImagesSection, existingSection.nextSibling);
        } else {
            // Criar na área principal
            newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📸 Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
        }
    }
    
    // Se ainda não encontrou a seção, sair
    if (!newImagesSection) {
        console.error('❌ Não foi possível criar seção de novas imagens');
        return;
    }
    
    // LIMPAR APENAS O CONTEÚDO DA SEÇÃO DE NOVAS (não a seção inteira)
    const header = newImagesSection.querySelector('p');
    if (header) {
        // Manter o cabeçalho e limpar o resto
        newImagesSection.innerHTML = '';
        newImagesSection.appendChild(header);
    } else {
        newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📸 Novas fotos a serem adicionadas:</p>';
    }

    if (selectedFiles.length === 0) {
        newImagesSection.innerHTML += '<p style="color: #666; text-align: center; padding: 1rem;">Nenhuma nova foto selecionada</p>';
        return;
    }

    console.log('🎨 Renderizando', selectedFiles.length, 'NOVAS imagens');
    
    // Container para as novas imagens
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.gap = '10px';
    newContainer.style.marginBottom = '1rem';
    
    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';

        if (file.type.startsWith('image/')) {
            const imageUrl = URL.createObjectURL(file);
            
            fileItem.innerHTML = `
                <img src="${imageUrl}" 
                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px dashed #3498db;"
                     onload="URL.revokeObjectURL(this.src)" 
                     onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                <!-- BOTÃO "X" NO CANTO SUPERIOR DIREITO -->
                <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                        style="background: #3498db;" 
                        title="Remover esta foto">×</button>
                <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                    ${file.name.substring(0, 12)}${file.name.length > 12 ? '...' : ''}
                </div>
            `;
            
        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f8ff; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                     display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; 
                     border: 2px dashed #3498db;">
                    <i class="fas fa-video" style="font-size: 2rem; color: #3498db;"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">
                        ${file.name.substring(0, 12)}${file.name.length > 12 ? '...' : ''}
                    </p>
                    <!-- BOTÃO "X" NO CANTO SUPERIOR DIREITO -->
                    <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                            style="background: #3498db;" 
                            title="Remover este vídeo">×</button>
                </div>
                <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; color: #666;">
                    ${(file.size / 1024 / 1024).toFixed(1)} MB
                </div>
            `;
        }
        
        newContainer.appendChild(fileItem);
    });
    
    newImagesSection.appendChild(newContainer);
    console.log('✅ Seção de novas imagens atualizada');
}

// ========== NOVA FUNÇÃO: REMOVER NOVA IMAGEM/VIDEO ==========
function removeNewFile(index) {
    console.log('🗑️ Tentando remover novo arquivo no índice:', index);
    
    if (confirm('Tem certeza que deseja remover este arquivo da lista de novos?')) {
        selectedFiles.splice(index, 1);
        console.log('🗑️ Arquivo removido. Arquivos novos restantes:', selectedFiles.length);
        showNewImagePreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.files = dataTransfer.files;
            console.log('📸 Input file atualizado após remoção');
        }
    }
}

// ========== SISTEMA DE EXCLUSÃO DE PDFs INDIVIDUAIS ==========
function showPdfPreview() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'pdf-file-item';
        fileItem.innerHTML = `
            <i class="fas fa-file-pdf" style="color: #e74c3c; font-size: 1.2rem;"></i>
            <div style="flex: 1;">
                <div style="font-weight: 500;">${file.name}</div>
                <div style="font-size: 0.8rem; color: #666;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
            </div>
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">×</button>
        `;
        preview.appendChild(fileItem);
    });
}

function removePdfFile(index) {
    if (confirm('Tem certeza que deseja excluir este PDF?')) {
        selectedPdfFiles.splice(index, 1);
        showPdfPreviewWithDelete(); // Usar função com botão "X"
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('pdfFileInput').files = dataTransfer.files;
    }
}

// ========== RENDERIZAR IMÓVEIS CORRIGIDO ==========
function renderProperties(filter = 'todos') {
    const container = document.getElementById('properties-container');
    if (!container) {
        console.error('❌ Container de propriedades não encontrado!');
        return;
    }
    
    container.innerHTML = '';
    
    const filteredProperties = filter === 'todos' ? properties : properties.filter(p => {
        if (filter === 'Residencial') return p.type === 'residencial';
        if (filter === 'Comercial') return p.type === 'comercial';
        if (filter === 'Rural') return p.type === 'rural';
        if (filter === 'Minha Casa Minha Vida') return p.badge === 'MCMV';
        return true;
    });
    
    if (filteredProperties.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Nenhum imóvel encontrado para este filtro.</p>';
        return;
    }
    
    console.log(`🎨 Renderizando ${filteredProperties.length} imóveis...`);
    
    filteredProperties.forEach(property => {
        const features = Array.isArray(property.features) ? property.features : (property.features ? property.features.split(',') : []);
        
        // DEBUG: Verificar imagens
        const hasImages = property.images && property.images.length > 0 && property.images !== 'EMPTY';
        const imageUrls = hasImages ? property.images.split(',').filter(url => url.trim() !== '') : [];
        const firstImageUrl = imageUrls.length > 0 ? imageUrls[0] : 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
        
        // CORREÇÃO CRÍTICA: Verificar PDFs de forma segura
        const hasPdfs = property.pdfs && 
                       property.pdfs.length > 0 && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined';
        
        // CORREÇÃO: has_video em vez de hasVideo
        const hasVideo = property.has_video !== undefined ? property.has_video : property.hasVideo;
        
        // USAR A NOVA GALERIA DE IMAGENS
        const propertyGalleryHTML = createPropertyGallery(property);
        
        const card = `
            <div class="property-card">
                ${propertyGalleryHTML}
                <div class="property-content">
                    <div class="property-price">${property.price}</div>
                    <h3 class="property-title">${property.title}</h3>
                    <div class="property-location"><i class="fas fa-map-marker-alt"></i> ${property.location}</div>
                    <p>${property.description}</p>
                    <div class="property-features">
                        ${features.map(f => `<span class="feature-tag ${property.rural ? 'rural-tag' : ''}">${f.trim()}</span>`).join('')}
                    </div>
                    <button class="contact-btn" onclick="contactAgent(${property.id})">
                        <i class="fab fa-whatsapp"></i> Entrar em Contato
                    </button>
                </div>
            </div>
        `;
        container.innerHTML += card;
    });
}

// ========== CORREÇÃO DO DEBUG DOS DADOS ==========
function debugPropertyData() {
    console.log('🐛 DEBUG - Dados dos Imóveis:');
    properties.forEach((property, index) => {
        console.log(`--- Imóvel ${index + 1} ---`);
        console.log('Título:', property.title);
        console.log('ID:', property.id);
        console.log('PDFs:', property.pdfs);
        console.log('Tipo de PDFs:', typeof property.pdfs);
        console.log('Tem PDFs?', property.pdfs && property.pdfs !== 'EMPTY' && property.pdfs.trim() !== '');
        console.log('---------------');
    });
}

function checkPdfData() {
    console.log('🔍 Verificando dados dos PDFs...');
    properties.forEach((property, index) => {
        console.log(`Imóvel ${index + 1}: ${property.title}`);
        console.log(`PDFs:`, property.pdfs);
        console.log(`Tem PDFs:`, property.pdfs && property.pdfs !== 'EMPTY' && property.pdfs.trim() !== '');
    });
}
        
// ========== SALVAR NO LOCALSTORAGE ==========
function saveToLocalStorage(propertyData) {
    try {
        console.log('💾 Salvando no localStorage...');
        
        // Se estiver editando, atualizar o imóvel existente
        if (editingPropertyId) {
            const index = properties.findIndex(p => p.id === editingPropertyId);
            if (index !== -1) {
                // Manter o ID original e adicionar URLs das imagens
                propertyData.id = editingPropertyId;
                if (selectedFiles.length > 0) {
                    // Em modo local, usar URLs de imagens de exemplo
                    propertyData.images = "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                properties[index] = { ...properties[index], ...propertyData };
            }
        } else {
            // Novo imóvel
            const newId = properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1;
            const newProperty = {
                id: newId,
                ...propertyData,
                images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
            };
            properties.push(newProperty);
        }
        
        localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
        renderProperties();
        loadPropertyList();
        
        console.log('✅ Salvo no localStorage com sucesso!');
        return true;
        
    } catch (error) {
        console.error('❌ Erro ao salvar no localStorage:', error);
        return false;
    }
}
        
// ========== SISTEMA DO PAINEL ADMIN ==========
const ADMIN_PASSWORD = "wl654";

// ========== FUNÇÃO toggleAdminPanel() CORRIGIDA ==========
function toggleAdminPanel() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        const panel = document.getElementById('adminPanel');
        if (panel) {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                // LIMPAR FORMULÁRIO AO ABRIR PAINEL
                cancelEdit(); // Chama a função que limpa tudo
                loadPropertyList();
                
                // GARANTIR QUE O UPLOAD FUNCIONE
                setTimeout(() => {
                    setupUploadSystem();
                    setupPdfUploadSystem();
                }, 300);
            }
        }
    } else {
        alert("Senha incorreta!");
    }
}

function loadPropertyList() {
    const container = document.getElementById('propertyList');
    const countElement = document.getElementById('propertyCount');
    
    if (!container) return;
    
    container.innerHTML = '';
    if (countElement) countElement.textContent = properties.length;
    
    if (properties.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum imóvel cadastrado.</p>';
        return;
    }
    
    properties.forEach(property => {
        const features = Array.isArray(property.features)   
            ? property.features 
            : (property.features ? property.features.split(',') : []);
            
        const item = document.createElement('div');
        item.className = 'property-item';
        item.innerHTML = `
            <div style="flex: 1;">
                <strong style="color: var(--primary);">${property.title}</strong><br>
                <small>${property.price} - ${property.location}</small>
                <div style="margin-top: 0.5rem;">
                    ${features.map(f => 
                        `<span style="background: var(--accent); color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem; margin-right: 0.3rem; display: inline-block; margin-bottom: 0.3rem;">${f.trim()}</span>`
                    ).join('')}
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="editProperty(${property.id})" style="background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button onclick="deleteProperty(${property.id})" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        `;
        container.appendChild(item);
    });
}
        
// ========== SISTEMA DE DOCUMENTOS PDF ==========
let currentPdfPropertyId = null;
const PDF_PASSWORD = "doc123"; // Senha simples para documentos

// Mostrar modal de PDF
function showPdfModal(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;

    currentPdfPropertyId = propertyId;
    const modal = document.getElementById('pdfModal');
    const title = document.getElementById('pdfModalTitle');
    const preview = document.getElementById('pdfPreview');
    
    if (title) {
        title.innerHTML = `<i class="fas fa-file-pdf"></i> Documentos - ${property.title}`;
    }
    
    if (preview) {
        if (property.pdfs && property.pdfs.length > 0) {
            const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
            preview.innerHTML = `
                <p><strong>${pdfUrls.length} documento(s) disponível(is):</strong></p>
                ${pdfUrls.map((url, index) => `
                    <div class="pdf-file-item">
                        <i class="fas fa-file-pdf" style="color: #e74c3c;"></i>
                        <span>Documento ${index + 1}</span>
                    </div>
                `).join('')}
            `;
        } else {
            preview.innerHTML = '<p>Nenhum documento disponível para este imóvel.</p>';
        }
    }
    
    // Resetar senha
    const passwordInput = document.getElementById('pdfPassword');
    if (passwordInput) passwordInput.value = '';
    
    modal.style.display = 'flex';
}

// Fechar modal
function closePdfModal() {
    const modal = document.getElementById('pdfModal');
    modal.style.display = 'none';
    currentPdfPropertyId = null;
}

// Acessar documentos com senha
function accessPdfDocuments() {
    const passwordInput = document.getElementById('pdfPassword');
    const password = passwordInput ? passwordInput.value : '';
    
    if (password !== PDF_PASSWORD) {
        alert('❌ Senha incorreta! Solicite a senha ao corretor.');
        return;
    }
    
    const property = properties.find(p => p.id === currentPdfPropertyId);
    if (!property || !property.pdfs) {
        alert('❌ Nenhum documento disponível para este imóvel.');
        return;
    }
    
    // Abrir todos os PDFs em novas abas
    const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
    pdfUrls.forEach(url => {
        window.open(url, '_blank');
    });
    
    closePdfModal();
    alert('✅ Documentos abertos com sucesso!');
}
        
// ========== CORREÇÃO DO SISTEMA DE UPLOAD DE PDFs ==========
function setupPdfUploadSystem() {
    const pdfUploadArea = document.getElementById('pdfUploadArea');
    const pdfFileInput = document.getElementById('pdfFileInput');
    const pdfPreview = document.getElementById('pdfUploadPreview');

    if (pdfUploadArea && pdfFileInput) {
        // Drag and drop para PDFs
        pdfUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = 'var(--primary)';
            pdfUploadArea.style.background = '#f0f8ff';
        });

        pdfUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
        });

        pdfUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
            
            const files = Array.from(e.dataTransfer.files).filter(file => 
                file.type === 'application/pdf'
            );
            
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });

        // CORREÇÃO: Click para selecionar - evitar propagação de eventos
        pdfUploadArea.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('📁 Click no upload area de PDFs');
            pdfFileInput.click();
        });

        // CORREÇÃO: Lidar com mudança no input de arquivo
        pdfFileInput.addEventListener('change', (e) => {
            console.log('📄 Input de arquivo PDF alterado:', e.target.files.length, 'arquivos');
            const files = Array.from(e.target.files).filter(file => 
                file.type === 'application/pdf'
            );
            console.log('📄 PDFs filtrados:', files.length);
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });
        
        // CORREÇÃO: Prevenir comportamento padrão do input
        pdfFileInput.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    } else {
        console.error('❌ Elementos do upload de PDFs não encontrados:', {
            pdfUploadArea: !!pdfUploadArea,
            pdfFileInput: !!pdfFileInput,
            pdfPreview: !!pdfPreview
        });
    }
}

// ========== CORREÇÃO DA FUNÇÃO HANDLE PDF FILES ==========
function handlePdfFiles(files) {
    console.log('📄 Processando novos PDFs:', files);
    
    const newFiles = Array.from(files);
    
    // CORREÇÃO: Contar apenas novos PDFs, não os existentes
    const currentNewPdfCount = selectedPdfFiles.length;
    const totalAfterAdd = currentNewPdfCount + newFiles.length;
    
    // Limitar a 5 arquivos PDF no total (novos)
    if (totalAfterAdd > 5) {
        alert('⚠️ Máximo de 5 novos arquivos PDF permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (10MB max para PDFs)
    for (const file of newFiles) {
        if (file.size > 10 * 1024 * 1024) {
            alert(`⚠️ O arquivo PDF "${file.name}" é muito grande! Máximo: 10MB`);
            return;
        }
    }
    
    // CORREÇÃO: Adicionar novos PDFs à lista existente
    selectedPdfFiles = [...selectedPdfFiles, ...newFiles];
    console.log('📄 PDFs selecionados após adição:', selectedPdfFiles.length);
    
    // CORREÇÃO: Mostrar apenas novos PDFs na seção apropriada
    showNewPdfPreview();
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
    document.getElementById('pdfFileInput').files = dataTransfer.files;
    console.log('📄 Input file atualizado');
}

// ========== FUNÇÃO CRÍTICA: VERIFICAR E CRIAR CAMPO PDFs NO SUPABASE ==========
async function ensurePdfFieldExists() {
    try {
        console.log('🔍 Verificando se o campo pdfs existe no Supabase...');
        
        // Primeiro, tentar verificar a estrutura da tabela
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=pdfs&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.status === 400) {
            console.log('⚠️ Campo pdfs não existe ou tem problemas. Tentando criar...');
            
            // Se não existir, tentar adicionar um imóvel com o campo pdfs
            const testData = {
                title: "Teste PDF Field",
                price: "R$ 0,00",
                location: "Teste",
                description: "Teste do campo PDF",
                features: "Teste",
                type: "residencial",
                has_video: false,
                badge: "Novo",
                rural: false,
                created_at: new Date().toISOString(),
                pdfs: "" // Campo vazio para criar a estrutura
            };
            
            const createResponse = await fetch(`${SUPABASE_URL}/rest/v1/properties`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify(testData)
            });
            
            if (createResponse.ok) {
                console.log('✅ Campo pdfs criado com sucesso!');
                
                // Excluir o registro de teste
                const testData = await createResponse.json();
                if (testData && testData[0] && testData[0].id) {
                    await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${testData[0].id}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    console.log('✅ Registro de teste removido');
                }
            }
        } else if (response.ok) {
            console.log('✅ Campo pdfs já existe no Supabase!');
        }
        
    } catch (error) {
        console.error('❌ Erro ao verificar campo pdfs:', error);
    }
}
        
// ========== CORREÇÃO URGENTE: FUNÇÃO DE UPLOAD DE PDFs ==========
async function uploadPdfFile(file) {
    try {
        console.log('📤 Iniciando upload de PDF:', file.name);
        
        // Sanitizar nome do arquivo
        const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
        const fileName = `pdf_${Date.now()}_${safeName}`;
        
        console.log('📁 Nome do arquivo para upload:', fileName);
        
        // Criar FormData
        const formData = new FormData();
        formData.append('file', file, fileName);
        
        // DEBUG: Mostrar headers
        console.log('📤 Headers da requisição:', {
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'apikey': SUPABASE_KEY
        });
        
        // Fazer upload para o storage
        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, 
            {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );
        
        console.log('📊 Status da resposta:', response.status);
        console.log('📊 Status OK?', response.ok);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ Erro detalhado no upload do PDF:', {
                status: response.status,
                statusText: response.statusText,
                error: errorText
            });
            
            // Tentar alternativa: usar bucket público
            const altResponse = await fetch(
                `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`, 
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'apikey': SUPABASE_KEY
                    },
                    body: formData
                }
            );
            
            if (altResponse.ok) {
                const altResult = await altResponse.json();
                const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
                console.log('✅ PDF upload alternativo concluído:', publicUrl);
                return publicUrl;
            } else {
                const altError = await altResponse.text();
                console.error('❌ Erro no upload alternativo:', altError);
                throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
            }
        }

        const result = await response.json();
        console.log('📄 Resultado do upload:', result);
        
        // Construir URL pública correta
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('✅ PDF upload concluído com sucesso!');
        console.log('🔗 URL pública:', publicUrl);
        
        // Verificar se a URL é acessível
        try {
            const testResponse = await fetch(publicUrl, { method: 'HEAD' });
            console.log('🔍 Teste de acesso à URL:', testResponse.ok);
        } catch (testError) {
            console.log('⚠️ URL pode não estar acessível publicamente');
        }
        
        return publicUrl;
        
    } catch (error) {
        console.error('❌ Erro crítico no upload do PDF:', error);
        console.error('📄 Detalhes do arquivo:', {
            name: file.name,
            type: file.type,
            size: file.size,
            lastModified: file.lastModified
        });
        return null;
    }
}

// ========== EXCLUIR PDF EXISTENTE DO IMÓVEL ==========
async function deleteExistingPdf(propertyId, pdfIndex) {
    if (!confirm('Tem certeza que deseja excluir este documento PDF? Esta ação não pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.pdfs) return;

    try {
        // Separar as URLs dos PDFs
        const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
        
        // Remover o PDF selecionado
        if (pdfIndex >= 0 && pdfIndex < pdfUrls.length) {
            const pdfToDelete = pdfUrls[pdfIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = pdfToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('✅ PDF excluído do Supabase Storage:', fileName);
                    } else {
                        console.log('⚠️ Não foi possível excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('⚠️ Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            pdfUrls.splice(pdfIndex, 1);
            
            // Atualizar a propriedade
            property.pdfs = pdfUrls.length > 0 ? pdfUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ pdfs: property.pdfs })
            });

            if (response.ok) {
                console.log('✅ PDF excluído com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualização
                editProperty(propertyId);
                alert('✅ Documento PDF excluído com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('❌ Erro ao excluir PDF:', error);
        alert('❌ Erro ao excluir o documento PDF. Tente novamente.');
    }
}

// ========== MOSTRAR PREVIEW DE PDFs COM BOTÕES "X" ==========
// ========== FUNÇÃO showPdfPreviewWithDelete() ==========
function showPdfPreviewWithDelete() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    // Para NOVOS PDFs (ainda não salvos)
    const newSection = document.createElement('div');
    newSection.id = 'newPdfsSection';
    newSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📄 Novos documentos a serem adicionados:</p>';
    
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.gap = '10px';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.marginBottom = '1rem';
    
    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';
        
        fileItem.innerHTML = `
            <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                 display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
            </div>
            <!-- BOTÃO "X" NO CANTO SUPERIOR DIREITO -->
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">×</button>
            <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                ${(file.size / 1024 / 1024).toFixed(2)} MB
            </div>
        `;
        newContainer.appendChild(fileItem);
    });
    
    newSection.appendChild(newContainer);
    preview.appendChild(newSection);
}
        
// ========== NOVA FUNÇÃO: MOSTRAR PREVIEW DE NOVOS PDFs ==========
// ========== FUNÇÃO showNewPdfPreview() RESTAURADA ==========
function showNewPdfPreview() {
    console.log('📄 showNewPdfPreview() - Renderizando NOVOS PDFs');
    
    let newPdfsSection = document.getElementById('newPdfsSection');
    
    if (!newPdfsSection) {
        console.log('⚠️ Seção de novos PDFs não encontrada, criando...');
        const pdfPreview = document.getElementById('pdfUploadPreview');
        if (pdfPreview) {
            // Verificar se já existe seção de novos PDFs
            let existingNewSection = document.getElementById('newPdfsSection');
            if (!existingNewSection) {
                existingNewSection = document.createElement('div');
                existingNewSection.id = 'newPdfsSection';
                existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📄 Novos documentos a serem adicionados:</p>';
                pdfPreview.appendChild(existingNewSection);
            }
            newPdfsSection = existingNewSection;
        } else {
            return;
        }
    }
    
    // Limpar apenas a seção de novos PDFs (mantém o título)
    const existingTitle = newPdfsSection.querySelector('p');
    newPdfsSection.innerHTML = '';
    if (existingTitle) {
        newPdfsSection.appendChild(existingTitle);
    } else {
        newPdfsSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">📄 Novos documentos a serem adicionados:</p>';
    }

    if (selectedPdfFiles.length === 0) {
        newPdfsSection.innerHTML += '<p style="color: #666; text-align: center;">Nenhum novo PDF selecionado</p>';
        return;
    }

    console.log('🎨 Renderizando preview de', selectedPdfFiles.length, 'novos PDFs');
    
    // Container para os novos PDFs
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.gap = '10px';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.marginBottom = '1rem';
    
    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';
        
        fileItem.innerHTML = `
            <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                 display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
            </div>
            <!-- BOTÃO "X" NO CANTO SUPERIOR DIREITO -->
            <button class="delete-image-btn" onclick="removeNewPdfFile(${index})" 
                    title="Excluir este PDF">×</button>
            <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                ${(file.size / 1024 / 1024).toFixed(2)} MB
            </div>
        `;
        newContainer.appendChild(fileItem);
    });
    
    newPdfsSection.appendChild(newContainer);
    console.log('✅ Novos PDFs renderizados com botão "X"');
}
        
// ========== NOVA FUNÇÃO: REMOVER PDF NOVO ==========
// ========== FUNÇÃO removeNewPdfFile() ==========
function removeNewPdfFile(index) {
    console.log('🗑️ Tentando remover novo PDF no índice:', index);
    
    if (confirm('Tem certeza que deseja remover este PDF da lista de novos documentos?')) {
        selectedPdfFiles.splice(index, 1);
        console.log('🗑️ PDF removido. PDFs novos restantes:', selectedPdfFiles.length);
        showNewPdfPreview(); // Usar a função corrigida
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        const pdfFileInput = document.getElementById('pdfFileInput');
        if (pdfFileInput) {
            pdfFileInput.files = dataTransfer.files;
            console.log('📄 Input file atualizado após remoção');
        }
    }
}
        
// ========== CORREÇÃO DA FUNÇÃO EDIT PROPERTY PARA FOTOS ==========
// ========== FUNÇÃO editProperty() COMPLETA E CORRIGIDA ==========
function editProperty(id) {
    const property = properties.find(p => p.id === id);
    if (!property) return;

    editingPropertyId = id;
    
    // Preencher formulário
    document.getElementById('propTitle').value = property.title || '';
    document.getElementById('propPrice').value = property.price || '';
    document.getElementById('propLocation').value = property.location || '';
    document.getElementById('propDescription').value = property.description || '';
    
    const features = Array.isArray(property.features) 
        ? property.features 
        : (property.features || '');
    document.getElementById('propFeatures').value = Array.isArray(features) ? features.join(', ') : features;
    
    document.getElementById('propType').value = property.type || 'residencial';
    document.getElementById('propBadge').value = property.badge || 'Novo';
    
    document.getElementById('propHasVideo').checked = property.has_video || false;
    
    // Atualizar título do formulário
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Editar Imóvel';
    }
    
    // Atualizar texto do botão
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Imóvel';
    }
    
    // Mostrar botão cancelar
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'block';
    }
    
    // CORREÇÃO: Inicializar arrays vazios mas manter referência para adições futuras
    selectedFiles = [];
    
    // CORREÇÃO: Mostrar imagens existentes se houver - COM SEPARAÇÃO ENTRE EXISTENTES E NOVAS
    const preview = document.getElementById('uploadPreview');
    if (preview) {
        preview.innerHTML = '';
        
        if (property.images && property.images.length > 0 && property.images !== 'EMPTY') {
            const existingImages = property.images.split(',').filter(img => img.trim() !== '');
            
            // CORREÇÃO: Criar uma área separada para imagens existentes
            preview.innerHTML = '<div id="existingImagesSection">';
            preview.innerHTML += '<p style="color: var(--success); margin-bottom: 1rem;">📸 Fotos atuais do imóvel (clique no X para excluir):</p>';
            
            // Container para imagens existentes
            const existingContainer = document.createElement('div');
            existingContainer.style.display = 'flex';
            existingContainer.style.gap = '10px';
            existingContainer.style.flexWrap = 'wrap';
            existingContainer.style.marginBottom = '1.5rem';
            
            existingImages.forEach((imgUrl, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'image-preview-container';
                imgContainer.innerHTML = `
                    <img src="${imgUrl}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid var(--success);"
                         onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                    <button class="delete-image-btn" onclick="deleteExistingImage(${property.id}, ${index})" 
                            title="Excluir esta foto">×</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Foto ${index + 1}</div>
                `;
                existingContainer.appendChild(imgContainer);
            });
            
            preview.appendChild(existingContainer);
            preview.innerHTML += '</div>';
            
            // CORREÇÃO: Adicionar seção para novas imagens
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">📸 Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
            
            // Armazenar URLs das imagens existentes para referência futura
            property.existingImageUrls = existingImages;
            
        } else {
            preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma foto cadastrada</p>';
            
            // CORREÇÃO: Adicionar seção para novas imagens mesmo quando não há existentes
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">📸 Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
        }
    }
    
    // CORREÇÃO: Mostrar PDFs existentes se houver - COM SEPARAÇÃO ENTRE EXISTENTES E NOVOS
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '';
        
        // CORREÇÃO: Verificar se há PDFs de forma segura
        const hasPdfs = property.pdfs && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined' &&
                       property.pdfs.trim() !== '';
        
        console.log('📄 Editando imóvel - Tem PDFs?', hasPdfs, 'PDFs:', property.pdfs);
        
        if (hasPdfs) {
            const existingPdfs = property.pdfs.split(',').filter(url => url.trim() !== '');
            
            // CORREÇÃO: Criar uma área separada para PDFs existentes
            pdfPreview.innerHTML = '<div id="existingPdfsSection">';
            pdfPreview.innerHTML += '<p style="color: var(--success); margin-bottom: 1rem;">📄 Documentos atuais do imóvel (clique no X para excluir):</p>';
            
            const existingPdfContainer = document.createElement('div');
            existingPdfContainer.style.display = 'flex';
            existingPdfContainer.style.gap = '10px';
            existingPdfContainer.style.flexWrap = 'wrap';
            existingPdfContainer.style.marginBottom = '1.5rem';
            
            existingPdfs.forEach((pdfUrl, index) => {
                // Extrair nome do arquivo da URL
                const fileName = pdfUrl.split('/').pop() || `Documento ${index + 1}`;
                
                const pdfContainer = document.createElement('div');
                pdfContainer.className = 'image-preview-container';
                pdfContainer.innerHTML = `
                    <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                        <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                        <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${fileName}</p>
                    </div>
                    <button class="delete-image-btn" onclick="deleteExistingPdf(${property.id}, ${index})" 
                            title="Excluir este documento">×</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Doc ${index + 1}</div>
                `;
                existingPdfContainer.appendChild(pdfContainer);
            });
            
            pdfPreview.appendChild(existingPdfContainer);
            pdfPreview.innerHTML += '</div>';
            
            // CORREÇÃO: Adicionar seção para novos PDFs
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">📄 Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
            
            // Armazenar URLs dos PDFs existentes para referência futura
            property.existingPdfUrls = existingPdfs;
            
        } else {
            pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum documento PDF cadastrado</p>';
            
            // CORREÇÃO: Adicionar seção para novos PDFs mesmo quando não há existentes
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">📄 Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
        }
    }
    
    // ========== CORREÇÃO CRÍTICA: REATIVAR UPLOAD DE FOTOS ==========
    setTimeout(() => {
        console.log('🔄 REATIVANDO UPLOAD DE FOTOS para edição...');
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        if (uploadArea && fileInput) {
            console.log('✅ Elementos de upload encontrados');
            
            // 1. CLONAR E SUBSTITUIR OS ELEMENTOS (remove listeners antigos)
            const newUploadArea = uploadArea.cloneNode(true);
            const newFileInput = fileInput.cloneNode(true);
            
            // Substituir no DOM
            uploadArea.parentNode.replaceChild(newUploadArea, uploadArea);
            fileInput.parentNode.replaceChild(newFileInput, fileInput);
            
            // 2. OBTER NOVAS REFERÊNCIAS
            const updatedUploadArea = document.getElementById('uploadArea');
            const updatedFileInput = document.getElementById('fileInput');
            
            if (updatedUploadArea && updatedFileInput) {
                console.log('✅ Elementos clonados com sucesso');
                
                // 3. REAPLICAR OS EVENT LISTENERS
                
                // Drag over
                updatedUploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = 'var(--primary)';
                    this.style.background = '#f0f8ff';
                    console.log('📸 Drag over ativo (edição)');
                });

                // Drag leave
                updatedUploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = '#ddd';
                    this.style.background = '';
                });

                // Drop
                updatedUploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = '#ddd';
                    this.style.background = '';
                    
                    if (e.dataTransfer.files.length > 0) {
                        console.log('📸 Arquivos arrastados na edição:', e.dataTransfer.files.length);
                        handleFiles(e.dataTransfer.files);
                    }
                });

                // Click para selecionar
                updatedUploadArea.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('📸 Click na área de upload (edição)');
                    updatedFileInput.click();
                });

                // Mudança no input
                updatedFileInput.addEventListener('change', function(e) {
                    console.log('📸 Input file alterado (edição):', e.target.files.length);
                    if (e.target.files.length > 0) {
                        handleFiles(e.target.files);
                    }
                });

                // Prevenir comportamento padrão
                updatedFileInput.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                // 4. GARANTIR QUE ESTÁ CLICÁVEL E VISÍVEL
                updatedUploadArea.style.cursor = 'pointer';
                updatedUploadArea.style.pointerEvents = 'auto';
                updatedUploadArea.style.opacity = '1';
                
                // 5. ADICIONAR FEEDBACK VISUAL
                updatedUploadArea.addEventListener('mouseenter', function() {
                    this.style.borderColor = 'var(--primary)';
                    this.style.boxShadow = '0 0 10px rgba(52, 152, 219, 0.3)';
                });
                
                updatedUploadArea.addEventListener('mouseleave', function() {
                    this.style.borderColor = '#ddd';
                    this.style.boxShadow = 'none';
                });
                
                console.log('✅ Upload de fotos REATIVADO para edição - PRONTO PARA USO!');
            }
        } else {
            console.error('❌ Elementos de upload não encontrados após edição');
        }
        
        // TAMBÉM REATIVAR UPLOAD DE PDFs
        console.log('🔄 Reativando upload de PDFs...');
        const pdfUploadArea = document.getElementById('pdfUploadArea');
        const pdfFileInput = document.getElementById('pdfFileInput');
        
        if (pdfUploadArea && pdfFileInput) {
            pdfUploadArea.style.cursor = 'pointer';
            pdfUploadArea.style.pointerEvents = 'auto';
            console.log('✅ Upload de PDFs reativado');
        }
        
    }, 500); // Esperar 500ms para o DOM atualizar completamente
    
    // Rolar até o formulário
    document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
    
    alert("Imóvel carregado para edição! Modifique os campos e clique em 'Atualizar Imóvel' para salvar.");
}
        
// ========== EXCLUIR FOTO EXISTENTE DO IMÓVEL ==========
async function deleteExistingImage(propertyId, imageIndex) {
    if (!confirm('Tem certeza que deseja excluir esta foto? Esta ação não pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.images) return;

    try {
        // Separar as URLs das imagens
        const imageUrls = property.images.split(',').filter(url => url.trim() !== '');
        
        // Remover a imagem selecionada
        if (imageIndex >= 0 && imageIndex < imageUrls.length) {
            const imageToDelete = imageUrls[imageIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = imageToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('✅ Imagem excluída do Supabase Storage:', fileName);
                    } else {
                        console.log('⚠️ Não foi possível excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('⚠️ Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            imageUrls.splice(imageIndex, 1);
            
            // Atualizar a propriedade
            property.images = imageUrls.length > 0 ? imageUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ images: property.images })
            });

            if (response.ok) {
                console.log('✅ Imagem excluída com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualização
                editProperty(propertyId);
                alert('✅ Foto excluída com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('❌ Erro ao excluir imagem:', error);
        alert('❌ Erro ao excluir a foto. Tente novamente.');
    }
}

// ========== FUNÇÃO PARA DELETAR IMÓVEL ==========
function deleteProperty(id) {
    if (!confirm('Tem certeza que deseja excluir este imóvel? Esta ação não pode ser desfeita.')) {
        return;
    }

    try {
        // Remover do array local
        const index = properties.findIndex(p => p.id === id);
        if (index !== -1) {
            properties.splice(index, 1);
            
            // Atualizar localStorage
            localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
            
            // Atualizar Supabase
            fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${id}`, {
                method: 'DELETE',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`
                }
            }).then(response => {
                if (response.ok) {
                    console.log('✅ Imóvel excluído do Supabase');
                }
            }).catch(error => {
                console.log('⚠️ Erro ao excluir do Supabase, mas continuando...', error);
            });
            
            // Recarregar a lista
            loadPropertyList();
            renderProperties();
            
            alert('✅ Imóvel excluído com sucesso!');
        }
    } catch (error) {
        console.error('❌ Erro ao excluir imóvel:', error);
        alert('❌ Erro ao excluir o imóvel. Tente novamente.');
    }
}
        
// ========== FUNÇÃO AUXILIAR PARA EXCLUIR DO STORAGE ==========
async function deleteFromStorage(imageUrl) {
    try {
        // Extrair o nome do arquivo da URL
        const fileName = imageUrl.split('/').pop();
        if (!fileName || fileName === 'EMPTY') return false;

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                }
            }
        );

        return response.ok;
    } catch (error) {
        console.error('❌ Erro ao excluir do storage:', error);
        return false;
    }
}
// ========== FUNÇÃO setupUploadSystem() CORRIGIDA ==========
// ========== SISTEMA DE UPLOAD ROBUSTO - COMPATÍVEL COM PROBLEMAS LOCAIS ==========
function setupUploadSystem() {
    console.log('🔧 Configurando sistema de upload ROBUSTO...');
    
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');

    if (!uploadArea || !fileInput) {
        console.error('❌ Elementos de upload não encontrados!');
        return;
    }

    // ESTRATÉGIA 1: MÚLTIPLOS MÉTODOS DE CLICK (defesa em profundidade)
    const setupClickMethods = () => {
        console.log('🛡️ Configurando múltiplos métodos de click...');
        
        // Método A: onclick tradicional
        uploadArea.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('🎯 Método A (onclick) acionado');
            fileInput.click();
        };
        
        // Método B: addEventListener
        uploadArea.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('🎯 Método B (addEventListener) acionado');
            fileInput.click();
        }, true); // true = useCapture phase
        
        // Método C: mousedown (para browsers problemáticos)
        uploadArea.addEventListener('mousedown', function(e) {
            if (e.button === 0) { // Botão esquerdo
                console.log('🎯 Método C (mousedown) acionado');
                setTimeout(() => fileInput.click(), 10);
            }
        });
        
        // Método D: touch para dispositivos touch
        uploadArea.addEventListener('touchstart', function(e) {
            e.preventDefault();
            console.log('🎯 Método D (touch) acionado');
            fileInput.click();
        });
        
        console.log('✅ 4 métodos de click configurados');
    };

    // ESTRATÉGIA 2: SISTEMA DE FALLBACK AUTOMÁTICO
    let clickAttempts = 0;
    const maxAttempts = 3;
    
    const setupFallbackSystem = () => {
        console.log('🔄 Configurando sistema de fallback...');
        
        // Monitorar se o click está funcionando
        const checkClickFunctionality = () => {
            clickAttempts++;
            console.log(`📊 Tentativa de click #${clickAttempts}`);
            
            if (clickAttempts >= maxAttempts) {
                console.warn('⚠️ Múltiplas falhas de click detectadas');
                activateEmergencyMode();
            }
        };
        
        // Modo de emergência para click persistente
        const activateEmergencyMode = () => {
            console.log('🚨 ATIVANDO MODO DE EMERGÊNCIA PARA UPLOAD');
            
            // Substituir completamente a área de upload
            const emergencyHTML = `
                <div id="uploadEmergency" style="
                    border: 3px solid #e74c3c; 
                    border-radius: 10px; 
                    padding: 30px; 
                    text-align: center;
                    background: #fff5f5;
                    cursor: pointer;
                    margin: 1rem 0;">
                    <i class="fas fa-exclamation-triangle" style="color: #e74c3c; font-size: 2rem;"></i>
                    <h4 style="color: #e74c3c; margin: 1rem 0;">MODO DE EMERGÊNCIA ATIVADO</h4>
                    <p style="color: #666; margin-bottom: 1rem;">
                        Clique AQUI para selecionar fotos<br>
                        <small>(Sistema detectou problemas no click normal)</small>
                    </p>
                    <button onclick="document.getElementById('fileInput').click()" 
                            style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-upload"></i> CLIQUE AQUI PARA UPLOAD
                    </button>
                </div>
            `;
            
            uploadArea.insertAdjacentHTML('afterend', emergencyHTML);
            
            // Também adicionar click direto no botão de emergência
            document.getElementById('uploadEmergency').addEventListener('click', function() {
                console.log('🎯 CLICK DE EMERGÊNCIA FUNCIONANDO');
                fileInput.click();
            });
        };
        
        // Adicionar verificação em cada click
        uploadArea.addEventListener('click', checkClickFunctionality);
        console.log('✅ Sistema de fallback configurado');
    };

    // ESTRATÉGIA 3: DIAGNÓSTICO AUTOMÁTICO
    const runDiagnostic = () => {
        console.log('🔍 EXECUTANDO DIAGNÓSTICO DO SISTEMA DE UPLOAD');
        
        const diagnostic = {
            userAgent: navigator.userAgent,
            isFirefox: navigator.userAgent.includes('Firefox'),
            isChrome: navigator.userAgent.includes('Chrome'),
            platform: navigator.platform,
            cookiesEnabled: navigator.cookieEnabled,
            javaScriptEnabled: true,
            // Verificar event listeners
            hasOnClick: !!uploadArea.onclick,
            hasAddEventListener: true, // Assumimos que sim
            // Verificar estilos
            cursorStyle: uploadArea.style.cursor,
            pointerEvents: uploadArea.style.pointerEvents,
            // Verificar posição/z-index
            position: window.getComputedStyle(uploadArea).position,
            zIndex: window.getComputedStyle(uploadArea).zIndex
        };
        
        console.table(diagnostic);
        
        // Sugestões baseadas no diagnóstico
        if (diagnostic.isFirefox) {
            console.log('💡 SUGESTÃO PARA FIREFOX: about:config -> dom.event.clipboardevents.enabled = true');
        }
        
        if (diagnostic.cursorStyle !== 'pointer') {
            console.log('💡 AJUSTANDO cursor para pointer');
            uploadArea.style.cursor = 'pointer';
        }
        
        console.log('✅ Diagnóstico completo');
    };

    // ESTRATÉGIA 4: LOG DETALHADO PARA DEBUG
    const setupDetailedLogging = () => {
        console.log('📝 Configurando logging detalhado...');
        
        // Log de todos os eventos na área de upload
        const events = ['click', 'mousedown', 'mouseup', 'touchstart', 'dragenter', 'dragover', 'dragleave', 'drop'];
        
        events.forEach(eventType => {
            uploadArea.addEventListener(eventType, (e) => {
                console.log(`🖱️ Evento "${eventType}" na uploadArea:`, {
                    type: e.type,
                    time: e.timeStamp,
                    coordinates: { x: e.clientX, y: e.clientY },
                    target: e.target.id,
                    defaultPrevented: e.defaultPrevented
                });
            });
        });
        
        // Log detalhado do change no input
        fileInput.addEventListener('change', (e) => {
            console.log('📁 EVENTO CHANGE NO FILE INPUT:', {
                files: e.target.files.length,
                fileNames: Array.from(e.target.files).map(f => f.name),
                fileSizes: Array.from(e.target.files).map(f => `${(f.size/1024/1024).toFixed(2)}MB`),
                timestamp: new Date().toISOString()
            });
            
            // Verificar se handleFiles será chamada
            setTimeout(() => {
                if (selectedFiles.length === 0 && e.target.files.length > 0) {
                    console.warn('⚠️ Arquivos selecionados mas handleFiles não foi chamada!');
                    console.warn('💡 Forçando chamada de handleFiles...');
                    handleFiles(e.target.files);
                }
            }, 100);
        });
        
        console.log('✅ Logging detalhado configurado');
    };

    // EXECUTAR TODAS AS ESTRATÉGIAS
    setupClickMethods();
    setupFallbackSystem();
    runDiagnostic();
    setupDetailedLogging();
    
    // CONFIGURAÇÃO DRAG & DROP (já funciona 100%)
    setupDragAndDrop();
    
    console.log('✅ Sistema de upload ROBUSTO configurado');
    console.log('💡 DICA: Se o click ainda não funcionar, use Drag & Drop (funciona 100%)');
}

// Função auxiliar para drag & drop
function setupDragAndDrop() {
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = 'var(--primary)';
        uploadArea.style.background = '#f0f8ff';
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '';
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '';
        
        if (e.dataTransfer.files.length > 0) {
            console.log('📸 Arquivos arrastados via Drag & Drop:', e.dataTransfer.files.length);
            handleFiles(e.dataTransfer.files);
        }
    });
}

// ========== SOLUÇÃO DEFINITIVA PARA SEU PROBLEMA LOCAL ==========
// Adicione este código para contornar problemas específicos da sua máquina

// 1. LIMPAR CACHE E RECONFIGURAR AO CARREGAR
window.addEventListener('load', function() {
    console.log('🧹 LIMPANDO CACHE DE UPLOAD AO CARREGAR...');
    
    // Forçar reconexão dos event listeners
    setTimeout(() => {
        if (typeof setupUploadSystem === 'function') {
            setupUploadSystem();
        }
    }, 1000);
});

// 2. BOTÃO DE FORÇA BRUTA (emergência)

// Adicionar botão de emergência no painel admin

// Executar após carregar

// ========== FUNÇÃO handleFiles() COMPLETA E CORRIGIDA ==========
function handleFiles(files) {
    console.log('📸 Arquivos recebidos no handleFiles:', files.length);
    
    const newFiles = Array.from(files);
    
    // Verificar se há arquivos válidos
    const validFiles = newFiles.filter(file => 
        file.type.startsWith('image/') || file.type.startsWith('video/')
    );
    
    if (validFiles.length === 0) {
        alert('⚠️ Por favor, selecione apenas imagens ou vídeos!');
        return;
    }
    
    // Contar arquivos atuais
    const currentCount = selectedFiles.length;
    const totalAfterAdd = currentCount + validFiles.length;
    
    // Limitar a 10 arquivos no total
    if (totalAfterAdd > 10) {
        alert('⚠️ Máximo de 10 arquivos permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (5MB max)
    for (const file of validFiles) {
        if (file.size > 5 * 1024 * 1024) {
            alert(`⚠️ O arquivo "${file.name}" é muito grande! Máximo: 5MB`);
            return;
        }
    }
    
    // Adicionar arquivos à lista
    validFiles.forEach(file => {
        selectedFiles.push(file);
    });
    
    console.log('📸 Total de arquivos selecionados:', selectedFiles.length);
    
    // ✅ CORREÇÃO CRÍTICA: Chamar showNewImagePreview() para mostrar as fotos
    setTimeout(() => {
        console.log('🔄 Chamando showNewImagePreview()...');
        if (typeof showNewImagePreview === 'function') {
            showNewImagePreview();
            console.log('✅ showNewImagePreview() executada com sucesso');
        } else {
            console.error('❌ showNewImagePreview() não é uma função!');
            // Fallback: usar showPreview() se existir
            if (typeof showPreview === 'function') {
                showPreview();
            }
        }
    }, 100);
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedFiles.forEach(file => dataTransfer.items.add(file));
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        fileInput.files = dataTransfer.files;
        console.log('📸 Input file atualizado');
    }
}
        
// ========== UPLOAD PARA SUPABASE ==========
async function uploadFile(file) {
    try {
        console.log('📤 Iniciando upload:', file.name);
        
        const fileName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );

        if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ Erro no upload:', errorText);
            throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        
        // URL CORRETA para acesso público
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('✅ Upload concluído:', publicUrl);
        return publicUrl;
        
    } catch (error) {
        console.error('❌ Erro crítico no upload:', error);
        return null;
    }
}

// ========== FUNÇÃO cancelEdit() COMPLETA E CORRIGIDA ==========
function cancelEdit() {
    console.log('❌ Cancelando edição...');
    
    editingPropertyId = null;
    
    // 1. LIMPAR FORMULÁRIO COMPLETAMENTE
    const form = document.getElementById('propertyForm');
    if (form) {
        form.reset(); // Isso limpa inputs, textareas, selects
        
        // Limpar manualmente campos que form.reset() não limpa completamente
        document.getElementById('propTitle').value = '';
        document.getElementById('propPrice').value = '';
        document.getElementById('propLocation').value = '';
        document.getElementById('propDescription').value = ''; // CORREÇÃO CRÍTICA
        document.getElementById('propFeatures').value = '';
        document.getElementById('propType').selectedIndex = 0;
        document.getElementById('propBadge').selectedIndex = 0;
        document.getElementById('propHasVideo').checked = false;
    }
    
    // 2. ATUALIZAR TÍTULO
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Adicionar Novo Imóvel';
    }
    
    // 3. ATUALIZAR BOTÃO
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Imóvel ao Site';
    }
    
    // 4. ESCONDER BOTÃO CANCELAR
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'none';
    }
    
    // 5. LIMPAR ARQUIVOS SELECIONADOS
    selectedFiles = [];
    selectedPdfFiles = [];
    
    // 6. LIMPAR PREVIEWS DE IMAGENS
    const preview = document.getElementById('uploadPreview');
    if (preview) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
    }
    
    // 7. LIMPAR PREVIEWS DE PDFs
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
    }
    
    // 8. LIMPAR INPUTS DE ARQUIVO
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        fileInput.value = '';
    }
    
    const pdfFileInput = document.getElementById('pdfFileInput');
    if (pdfFileInput) {
        pdfFileInput.value = '';
    }
    
    // 9. RECONFIGURAR SISTEMAS DE UPLOAD
    setTimeout(() => {
        setupUploadSystem(); // Reconfigurar click
        setupPdfUploadSystem(); // Reconfigurar PDFs
    }, 100);
    
    console.log('✅ Edição cancelada - Formulário completamente limpo');
}

// ========== FUNÇÃO resetPdfUploadSystem() ==========
function resetPdfUploadSystem() {
    console.log('🔄 Resetando sistema de upload de PDFs...');
    
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
    }
    
    const pdfFileInput = document.getElementById('pdfFileInput');
    if (pdfFileInput) {
        pdfFileInput.value = '';
    }
    
    console.log('✅ Sistema de PDFs resetado');
}
        
// ========== CORREÇÃO DA FUNÇÃO SALVAR PROPRIEDADE PARA IMAGENS ==========
async function saveProperty(propertyData) {
    try {
        console.log('💾 Iniciando processo de salvamento...');
        console.log('📋 Dados do imóvel:', propertyData);
        console.log('📸 NOVAS Imagens selecionadas:', selectedFiles.length);
        console.log('📄 NOVOS PDFs selecionados:', selectedPdfFiles.length);

        const dataToSave = {
            title: propertyData.title,
            price: propertyData.price,
            location: propertyData.location,
            description: propertyData.description,
            features: Array.isArray(propertyData.features) ? propertyData.features.join(', ') : propertyData.features,
            type: propertyData.type,
            has_video: propertyData.has_video,
            badge: propertyData.badge,
            rural: propertyData.rural,
            created_at: propertyData.created_at || new Date().toISOString()
        };

        // Garantir que o campo pdfs existe antes de continuar
        await ensurePdfFieldExists();

        // CORREÇÃO: Upload das NOVAS imagens se houver
        if (selectedFiles.length > 0) {
            console.log(`📸 Fazendo upload de ${selectedFiles.length} NOVAS imagens...`);
            let uploadedFiles = [];
            
            for (const file of selectedFiles) {
                console.log(`⬆️ Enviando NOVA imagem/vídeo: ${file.name}`);
                const fileUrl = await uploadFile(file);
                if (fileUrl) {
                    uploadedFiles.push(fileUrl);
                    console.log(`✅ NOVA imagem/vídeo enviada: ${fileUrl}`);
                } else {
                   console.log(`❌ Falha no upload do NOVO arquivo: ${file.name}`);
                }
            }
            
            if (uploadedFiles.length > 0) {
                // CORREÇÃO: Combinar imagens existentes com novas
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.images && existingProperty.images !== 'EMPTY') {
                    const existingImages = existingProperty.images.split(',').filter(img => img.trim() !== '');
                    dataToSave.images = [...existingImages, ...uploadedFiles].join(', ');
                    console.log('🖼️ Imagens combinadas (existentes + novas):', dataToSave.images);
                    console.log('🔢 Total de imagens:', existingImages.length + uploadedFiles.length);
                } else {
                    dataToSave.images = uploadedFiles.join(', ');
                    console.log('🖼️ Apenas NOVAS imagens:', dataToSave.images);
                    console.log('🔢 Número de NOVAS imagens:', uploadedFiles.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter imagens existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.images) {
                dataToSave.images = existingProperty.images;
                console.log('🔄 Mantendo imagens existentes:', dataToSave.images);
            } else {
                dataToSave.images = '';
                console.log('🔄 Campo images será vazio');
            }
        }

        // CORREÇÃO: Upload dos NOVOS PDFs se houver
        if (selectedPdfFiles.length > 0) {
            console.log(`📄 Fazendo upload de ${selectedPdfFiles.length} NOVOS PDFs...`);
            let uploadedPdfs = [];
            
            for (const file of selectedPdfFiles) {
                console.log(`⬆️ Enviando NOVO PDF: ${file.name}`);
                console.log(`📊 Tamanho do NOVO PDF: ${(file.size / 1024).toFixed(2)} KB`);
                
                const fileUrl = await uploadPdfFile(file);
                if (fileUrl) {
                    uploadedPdfs.push(fileUrl);
                    console.log(`✅ NOVO PDF enviado com sucesso: ${fileUrl}`);
                } else {
                    console.log(`❌ Falha crítica no upload do NOVO PDF: ${file.name}`);
                }
            }
            
            if (uploadedPdfs.length > 0) {
                // CORREÇÃO: Combinar PDFs existentes com novos
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                    const existingPdfs = existingProperty.pdfs.split(',').filter(url => url.trim() !== '');
                    dataToSave.pdfs = [...existingPdfs, ...uploadedPdfs].join(', ');
                    console.log('📄 PDFs combinados (existentes + novos):', dataToSave.pdfs);
                    console.log('🔢 Total de PDFs:', existingPdfs.length + uploadedPdfs.length);
                } else {
                    dataToSave.pdfs = uploadedPdfs.join(', ');
                    console.log('📄 Apenas NOVOS PDFs:', dataToSave.pdfs);
                    console.log('🔢 Número de NOVOS PDFs:', uploadedPdfs.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter PDFs existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                dataToSave.pdfs = existingProperty.pdfs;
                console.log('🔄 Mantendo PDFs existentes:', dataToSave.pdfs);
            } else {
                dataToSave.pdfs = '';
                console.log('🔄 Campo pdfs será vazio');
            }
        } else {
            // Garantir que pdfs seja uma string vazia se não houver PDFs
            dataToSave.pdfs = '';
            console.log('📄 Nenhum PDF selecionado, campo será vazio');
        }
        
        console.log('📤 Dados completos para salvar no Supabase:', JSON.stringify(dataToSave, null, 2));
        
        // Determinar URL e método
        const url = editingPropertyId
            ? `${SUPABASE_URL}/rest/v1/properties?id=eq.${editingPropertyId}`
            : `${SUPABASE_URL}/rest/v1/properties`;

        const method = editingPropertyId ? 'PATCH' : 'POST';

        console.log(`🌐 Fazendo requisição: ${method} ${url}`);

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Prefer': 'return=representation'
            },
            body: JSON.stringify(dataToSave)
        });

        console.log('📊 Status da resposta do Supabase:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('❌ Erro na resposta do Supabase:', errorText);
            throw new Error(`Erro ao salvar: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('✅ Salvo com sucesso no Supabase:', result);
        
        // CORREÇÃO: Limpar apenas os NOVOS arquivos selecionados após salvar
        selectedFiles = [];
        selectedPdfFiles = [];
        
        // Recarregar os dados do Supabase
        await loadProperties();
        
        // CORREÇÃO: Fechar o painel de edição após salvar
        cancelEdit();
        
        alert("✅ Imóvel atualizado com sucesso!\n\n📸 Fotos existentes foram mantidas e novas fotos foram adicionadas.\n📄 PDFs existentes foram mantidos e novos PDFs foram adicionados.");
        return true;

    } catch (error) {
        console.error('❌ Erro crítico ao salvar no Supabase:', error);
        console.log('🔄 Tentando salvar localmente como fallback...');
        return saveToLocalStorage(propertyData);
    }
}

// ========== FORMULÁRIO CORRIGIDO ==========
function setupForm() {
    const form = document.getElementById('propertyForm');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const propertyData = {
            title: document.getElementById('propTitle').value,
            price: document.getElementById('propPrice').value,
            location: document.getElementById('propLocation').value,
            description: document.getElementById('propDescription').value,
            features: document.getElementById('propFeatures').value.split(',').map(f => f.trim()).filter(f => f !== ''),
            type: document.getElementById('propType').value,
            has_video: document.getElementById('propHasVideo').checked,
            badge: document.getElementById('propBadge').value,
            rural: document.getElementById('propType').value === 'rural',
            created_at: new Date().toISOString()
        };

        if (!propertyData.title || !propertyData.price || !propertyData.location) {
            alert('❌ Preencha Título, Preço e Localização!');
            return;
        }

        const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitBtn.disabled = true;

        try {
            const success = await saveProperty(propertyData);
            
            if (success) {
                alert("✅ Imóvel salvo com sucesso!");
            } else {
                alert("❌ Erro ao salvar o imóvel!");
            }

            this.reset();
            cancelEdit();
            selectedFiles = [];
            selectedPdfFiles = [];
            showNewImagePreview();
            showNewPdfPreview();

        } catch (error) {
            alert("❌ Erro: " + error.message);
        } finally {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });
}
        
// ========== FUNÇÕES DE INTERAÇÃO ==========
function contactAgent(id) {
    const property = properties.find(p => p.id === id);
    if (property) {
        const message = `Olá! Tenho interesse no imóvel: ${property.title} - ${property.price}`;
        const whatsappURL = `https://wa.me/5582996044513?text=${encodeURIComponent(message)}`;
        window.open(whatsappURL, '_blank');
    }
}

function viewProperty(id) {
    const property = properties.find(p => p.id === id);
    if (property) {
        alert(`🏠 ${property.title}\n\n💰 ${property.price}\n📍 ${property.location}\n\n${property.description}`);
    }
}

// ========== TESTAR CONEXÃO SUPABASE ==========
async function testSupabaseConnection() {
    try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=id&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        return response.ok;
    } catch (error) {
        return false;
    }
}

// ========== TESTAR ACESSO ÀS IMAGENS ==========
async function testImageAccess() {
    console.log('🔍 Testando acesso às imagens...');
    
    // URLs das suas imagens no Supabase
    const testImages = [
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341618532_thumbnail3.jpeg',
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341628860_thumbnail2.jpeg',
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341634876_thumbnail1.jpeg'
    ];
    
    for (const imgUrl of testImages) {
        try {
            const response = await fetch(imgUrl);
            if (response.ok) {
                console.log(`✅ Imagem acessível: ${imgUrl}`);
            } else {
                console.log(`❌ Imagem não acessível: ${imgUrl} - Status: ${response.status}`);
            }
        } catch (error) {
            console.log(`❌ Erro ao acessar imagem: ${imgUrl} - ${error.message}`);
        }
    }
}

// ========== FUNÇÕES DE PREVIEW FALTANTES ==========
function showPreview() {
    // Esta função agora é apenas um wrapper para a nova função
    console.log('📸 showPreview() chamada, usando showNewImagePreview()...');
    showNewImagePreview();
}

// Função auxiliar para mostrar preview básico (compatibilidade)
function showBasicPreview() {
    const preview = document.getElementById('uploadPreview');
    if (!preview) return;
    
    preview.innerHTML = '';
    
    if (selectedFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
        return;
    }

    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'position: relative; display: inline-block; margin: 5px;';
        
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                fileItem.innerHTML = `
                    <img src="${e.target.result}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid #ddd;">
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; line-height: 1; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">×</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">${file.name}</div>
                `;
                preview.appendChild(fileItem);
            };
            reader.readAsDataURL(file);
        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                    <i class="fas fa-video" style="font-size: 2rem; color: var(--primary);"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">×</button>
                </div>
            `;
            preview.appendChild(fileItem);
        }
    });
}

// Função para remover arquivo (compatibilidade)
function removeFile(index) {
    console.log('🗑️ removeFile() chamado para índice:', index);
    
    if (confirm('Tem certeza que deseja excluir este arquivo?')) {
        selectedFiles.splice(index, 1);
        console.log('🗑️ Arquivo removido. Arquivos restantes:', selectedFiles.length);
        showBasicPreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.files = dataTransfer.files;
            console.log('📸 Input file atualizado após remoção');
        }
    }
}

// ========== TESTE DE CONEXÃO SUPABASE DETALHADO ==========
async function testSupabaseDetailed() {
    console.log('🔍 Testando conexão com Supabase...');
    
    try {
        // Teste 1: Acesso básico
        const test1 = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=id&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        console.log('Teste 1 - Status:', test1.status, test1.ok ? '✅ OK' : '❌ FALHOU');
        
        // Teste 2: Storage
        const test2 = await fetch(`${SUPABASE_URL}/storage/v1/bucket/properties`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        console.log('Teste 2 - Storage:', test2.status, test2.ok ? '✅ OK' : '❌ FALHOU');
        
        // Teste 3: Ping
        const test3 = await fetch(`${SUPABASE_URL}/rest/v1/`, {
            method: 'HEAD',
            headers: {
                'apikey': SUPABASE_KEY
            }
        });
        console.log('Teste 3 - Ping:', test3.status, test3.ok ? '✅ OK' : '❌ FALHOU');
        
        return test1.ok;
        
    } catch (error) {
        console.error('❌ Erro detalhado na conexão:', error);
        return false;
    }
}
        
// ========== INICIALIZAÇÃO CORRIGIDA ==========
// ========== ADICIONAR DEBUG NA INICIALIZAÇÃO ==========
// ========== INICIALIZAÇÃO COMPLETA E ATUALIZADA ==========
// Adicione no início do DOMContentLoaded, antes de tudo:
// ========== INICIALIZAÇÃO COMPLETA E ATUALIZADA ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log('🚀 Sistema Weber Lessa Iniciado');
    
    // TEMPORARIAMENTE desabilitar verificação constitucional inicial
    // para evitar alertas durante desenvolvimento
    // enforceConstitutionalGuideline(); // COMENTE ESTA LINHA
    
    // LIMPAR QUALQUER DADO REMANESCENTE DO FORMULÁRIO
    if (typeof cancelEdit === 'function') {
        cancelEdit(); // Limpa formulário ao carregar a página
    }
    
    // Aplicar diretriz constitucional
    enforceConstitutionalGuideline();
    
    // Testar conexão com Supabase DETALHADO
    console.log('🔍 Testando conexão com Supabase...');
    const supabaseOk = await testSupabaseConnection();
    
    if (!supabaseOk) {
        console.log('⚠️ ATENÇÃO: Problemas detectados com Supabase!');
        console.log('📌 Possíveis causas:');
        console.log('1. Conexão com internet instável');
        console.log('2. VPN ativa interferindo');
        console.log('3. Credenciais incorretas ou expiradas');
        console.log('4. Restrições de CORS no navegador');
        console.log('🔄 Usando modo local como fallback...');
    } else {
        console.log('✅ Supabase conectado com sucesso!');
        
        // Verificar se o campo pdfs existe no Supabase
        await ensurePdfFieldExists();
    }
    
    // Carregar propriedades
    await loadProperties();
    
    // Configurar formulário e sistemas de upload
    setupForm();
    setupUploadSystem();
    setupPdfUploadSystem();
    
    // DEBUG: Verificar se os elementos de upload foram configurados
    console.log('🔍 Verificando configuração do sistema:');
    console.log('- uploadArea:', document.getElementById('uploadArea') ? '✅' : '❌');
    console.log('- pdfUploadArea:', document.getElementById('pdfUploadArea') ? '✅' : '❌');
    console.log('- fileInput:', document.getElementById('fileInput') ? '✅' : '❌');
    console.log('- pdfFileInput:', document.getElementById('pdfFileInput') ? '✅' : '❌');
    
    // Configurar filtros
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            const text = this.textContent.trim();
            renderProperties(text === 'Todos' ? 'todos' : text);
        });
    });
    
    // Testar acesso às imagens
    testImageAccess();
    
    // ========== INICIALIZAR GALERIA DE FOTOS ==========
    console.log('🎨 Inicializando galeria de fotos...');
    
    // Adicionar estilos da galeria
    const styleSheet = document.createElement("style");
    styleSheet.textContent = galleryStyles;
    document.head.appendChild(styleSheet);
    
    // Adicionar evento para fechar galeria ao clicar fora
    document.addEventListener('click', function(event) {
        const galleryModal = document.getElementById('propertyGalleryModal');
        if (galleryModal && galleryModal.style.display === 'block') {
            if (event.target === galleryModal) {
                closeGallery();
            }
        }
    });
    
    // Adicionar suporte a teclado para navegação na galeria
    document.addEventListener('keydown', function(event) {
        const galleryModal = document.getElementById('propertyGalleryModal');
        if (!galleryModal || galleryModal.style.display !== 'block') return;
        
        switch(event.key) {
            case 'ArrowLeft':
                event.preventDefault();
                prevGalleryImage();
                break;
            case 'ArrowRight':
                event.preventDefault();
                nextGalleryImage();
                break;
            case 'Escape':
                event.preventDefault();
                closeGallery();
                break;
            case ' ':
                // Evitar que o espaço role a página quando a galeria estiver aberta
                if (galleryModal.style.display === 'block') {
                    event.preventDefault();
                }
                break;
        }
    });
    
    // Adicionar evento de toque para swipe
    document.addEventListener('touchstart', function(event) {
        const galleryModal = document.getElementById('propertyGalleryModal');
        if (galleryModal && galleryModal.style.display === 'block') {
            // Encontrar a área de swipe
            const swipeArea = galleryModal.querySelector('.gallery-swipe-area');
            if (swipeArea && swipeArea.contains(event.target)) {
                handleTouchStart(event);
            }
        }
    }, { passive: true });
    
    document.addEventListener('touchend', function(event) {
        const galleryModal = document.getElementById('propertyGalleryModal');
        if (galleryModal && galleryModal.style.display === 'block') {
            // Encontrar a área de swipe
            const swipeArea = galleryModal.querySelector('.gallery-swipe-area');
            if (swipeArea && swipeArea.contains(event.target)) {
                handleTouchEnd(event);
            }
        }
    }, { passive: true });
    
    // Prevenir zoom com dois dedos na galeria
    document.addEventListener('gesturestart', function(event) {
        const galleryModal = document.getElementById('propertyGalleryModal');
        if (galleryModal && galleryModal.style.display === 'block') {
            event.preventDefault();
        }
    });
    
    console.log('✅ Galeria de fotos MOBILE FIRST inicializada!');
    console.log('✅ Sistema Weber Lessa completamente carregado e pronto!');
    
    // TESTE: Verificar se a galeria está funcionando
    setTimeout(() => {
        console.log('🔍 Testando funcionalidade da galeria...');
        console.log('- Função createPropertyGallery:', typeof createPropertyGallery === 'function' ? '✅' : '❌');
        console.log('- Função openGallery:', typeof openGallery === 'function' ? '✅' : '❌');
        console.log('- Função closeGallery:', typeof closeGallery === 'function' ? '✅' : '❌');
        console.log('- Variável galleryStyles:', galleryStyles ? '✅ (definida)' : '❌');
        
        // Verificar se há imóveis com múltiplas imagens
        const propertiesWithMultipleImages = properties.filter(p => {
            const hasImages = p.images && p.images !== 'EMPTY' && p.images.length > 0;
            if (!hasImages) return false;
            const imageCount = p.images.split(',').filter(url => url.trim() !== '').length;
            return imageCount > 1;
        });
        
        console.log(`📊 Imóveis com múltiplas imagens: ${propertiesWithMultipleImages.length}`);
        
        if (propertiesWithMultipleImages.length > 0) {
            console.log('🎉 A galeria funcionará para estes imóveis:');
            propertiesWithMultipleImages.forEach(p => {
                const imageCount = p.images.split(',').filter(url => url.trim() !== '').length;
                console.log(`   - ${p.title}: ${imageCount} imagens`);
            });
        }
    }, 1000);
});

  </script>
</body>
</html>
