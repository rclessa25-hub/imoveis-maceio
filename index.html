<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBER LESSA CORRETOR & CONSULTORIA DE IM√ìVEIS - CRECI: 654/AL</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 
    <!-- CSS Modularizado -->
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/gallery.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/main.css">
   
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Desktop Layout √önico -->
            <div class="header-integrated">
                <!-- Logo e Nome (Lado Esquerdo) -->
                <div class="brand-section">
                    <div class="logo">
                        <span class="logo-wl">WL</span>
                        <div class="logo-badge">
                            <i class="fas fa-key"></i>
                        </div>
                    </div>
                    
                    <div class="brand-info">
                        <div class="brand-name-compact">
                            <span class="first-name-compact">WEBER</span>
                            <span class="last-name-compact">LESSA</span>
                        </div>
                        
                        <div class="creci-info-compact">
                            <div class="creci-badge-compact">
                                <i class="fas fa-shield-alt"></i>
                                <span class="creci-label-compact">CRECI</span>
                                <span class="creci-number-compact">654/AL</span>
                            </div>
                            
                            <div class="certified-badge-compact">
                                <i class="fas fa-award"></i>
                                <span>CRECI CERTIFICADO</span>
                            </div>
                        </div>
                        
                        <div class="specialty-compact">
                            <i class="fas fa-home"></i>
                            <span class="specialty-title-compact">CORRETOR & CONSULTOR</span>
                            <span class="specialty-subtitle-compact">IMOBILI√ÅRIO | JUR√çDICO</span>
                        </div>
                    </div>
                </div>
                
                <!-- Contato e Endere√ßo (Lado Direito - Topo) -->
                <div class="contact-section">
                    <!-- Telefone/WhatsApp -->
                    <div class="phone-whatsapp-compact">
                        <div class="phone-icons-compact">
                            <i class="fas fa-mobile-alt"></i>
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="phone-number-compact">
                            <span class="phone-prefix-compact">(82)</span>
                            <span class="phone-main-compact">9.9604-4513</span>
                        </div>
                    </div>
                    
                    <!-- Endere√ßo -->
                    <div class="address-compact">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="address-text-compact">
                            <span class="address-line-1">Empresarial Sizi & Neusa</span>
                            <span class="address-line-2">Pra√ßa S√£o Vicente, 09</span>
                            <span class="address-line-3">Centro, Macei√≥-AL</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Layout Super Compacto -->
            <div class="mobile-header-ultimate">
                <!-- Linha 1: Logo + Nome + Telefone -->
                <div class="mobile-row-1">
                    <div class="mobile-logo-mini">
                        <span>WL</span>
                    </div>
                    
                    <div class="mobile-name-mini">
                        <span class="mobile-first-name-mini">WEBER</span>
                        <span class="mobile-last-name-mini">LESSA</span>
                    </div>
                    
                    <div class="mobile-phone-mini">
                        <i class="fas fa-mobile-alt"></i>
                        <i class="fab fa-whatsapp"></i>
                    </div>
                </div>
                
                <!-- Linha 2: CRECI + Especializa√ß√£o -->
                <div class="mobile-row-2">
                    <div class="mobile-creci-mini">
                        <i class="fas fa-shield-alt"></i>
                        <span>CRECI 654/AL</span>
                    </div>
                    
                    <div class="mobile-specialty-mini">
                        <i class="fas fa-home"></i>
                        <span>CORRETOR</span>
                    </div>
                </div>
                
                <!-- Linha 3: Endere√ßo + Certificado -->
                <div class="mobile-row-3">
                    <div class="mobile-address-mini">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Emp. Sizi & Neusa</span>
                    </div>
                    
                    <div class="mobile-certified-mini">
                        <i class="fas fa-award"></i>
                        <span>CERTIFICADO</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Encontre seu im√≥vel dos sonhos em Macei√≥</h1>
        <p>Na orla mais bonita do Brasil, com a expertise de quem entende do mercado imobili√°rio alagoano</p>
        <a href="#properties" class="cta-button">
            <i class="fas fa-home"></i> Ver Im√≥veis
        </a>
    </section>

    <!-- Servi√ßos Section -->
    <section class="services">
        <div class="section-title">
            <h2>Nossos Servi√ßos Especializados</h2>
            <p>Oferecemos solu√ß√µes completas para suas necessidades imobili√°rias</p>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Equipe de Corretagem</h3>
                <p>Venda de lotes, im√≥veis residenciais, comerciais, s√≠tios, incorpora√ß√µes, consultoria, avalia√ß√£o de im√≥veis, ch√°caras e fazendas com equipe qualificada.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>Incorpora√ß√£o Imobili√°ria</h3>
                <p>Desenvolvemos empreendimentos de alto padr√£o com qualidade e inova√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Financiamento Facilitado</h3>
                <p>Linhas banc√°rias com boleto facilitado e condi√ß√µes especiais para sua aquisi√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-gavel"></i>
                </div>
                <h3>Regulariza√ß√£o de Im√≥veis</h3>
                <p>Usucapi√£o, heran√ßa, invent√°rio e toda documenta√ß√£o necess√°ria para regulariza√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>Minha Casa Minha Vida</h3>
                <p>Acesso facilitado ao programa governamental para realiza√ß√£o do sonho da casa pr√≥pria.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-tractor"></i>
                </div>
                <h3>Propriedades Rurais</h3>
                <p>Especialistas em s√≠tios, ch√°caras e fazendas com documenta√ß√£o completa e regularizada.</p>
            </div>
        </div>
    </section>

    <!-- Im√≥veis Section -->
    <section class="properties" id="properties">
        <div class="section-title">
            <h2>Im√≥veis em Destaque</h2>
            <p>Confira nossas melhores oportunidades em Macei√≥ e regi√£o</p>
        </div>
        
        <div class="filters">
            <h3>Filtrar por:</h3>
            <div class="filter-options">
                <button class="filter-btn active">Todos</button>
                <button class="filter-btn">Residencial</button>
                <button class="filter-btn">Comercial</button>
                <button class="filter-btn">Rural</button>
                <button class="filter-btn">Minha Casa Minha Vida</button>
            </div>
        </div>
        
        <div class="property-grid" id="properties-container">
            <!-- Os im√≥veis ser√£o carregados aqui via JavaScript -->
        </div>
    </section>

    <!-- Sobre Section -->
    <section class="about">
        <div class="about-content">
            <div class="about-text">
                <h2>Sobre Weber Lessa</h2>
                <p>Com mais de 30 anos de experi√™ncia no mercado imobili√°rio de Macei√≥,com forma√ß√£o Jur√≠dica e especializa√ß√£o em Direito Imobili√°rio a empresa Weber Lessa Corretor & Consultor - CRECI: 654/AL, se consolidou como refer√™ncia em solu√ß√µes imobili√°rias completas e personalizadas.</p>
                <p>Nossa equipe especializada atua em todas as fases do processo: desde a assessoria na compra e venda, passando pela regulariza√ß√£o documental, at√© o financiamento e incorpora√ß√£o de empreendimentos.</p>
                <p>Localizada no Empresarial Sizi & Neusa, no cora√ß√£o de Macei√≥, estamos prontos para ajudar voc√™ a realizar o sonho do im√≥vel pr√≥prio com seguran√ßa, transpar√™ncia e expertise.</p>
            </div>
            <div class="about-image">
                <div>
                    <i class="fas fa-building"></i>
                    <p>Empresarial Sizi & Neusa</p>
                    <p>Sede Weber Lessa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Weber Lessa</h3>
                <p>Corretor & Consultor com tradi√ß√£o e qualidade no mercado imobili√°rio de Macei√≥ desde 1995.</p>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <p><i class="fas fa-phone"></i> (82) 9.9604-4513</p>
                <p><i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa</p>
                <p>Pra√ßa S√£o Vicente, 09 - Centro</p>
                <p>Macei√≥ - AL, 57020-420</p>
                <p><i class="fas fa-clock"></i> Segunda a Sexta: 8h √†s 18h</p>
            </div>
            <div class="footer-section">
                <h3>Links R√°pidos</h3>
                <a href="#properties">Im√≥veis</a>
                <a href="#services">Servi√ßos</a>
                <a href="#about">Sobre N√≥s</a>
                <a href="#contact">Contato</a>
            </div>
            <div class="footer-section">
                <h3>Especialidades</h3>
                <a href="#">Venda de Im√≥veis</a>
                <a href="#">Aluguel de Im√≥veis</a>
                <a href="#">Propriedades Rurais</a>
                <a href="#">Incorpora√ß√£o</a>
                <a href="#">Financiamento</a>
                <a href="#">Regulariza√ß√£o</a>
                <a href="#">Minha Casa Minha Vida</a>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Weber Lessa Corretor & Consultor - CRECI: 654/AL. Todos os direitos reservados.</p>
        </div>
    </footer>

<!-- ========== PAINEL DE ADMINISTRA√á√ÉO ATUALIZADO ========== -->
<section class="admin-panel" id="adminPanel">
    <h3 style="text-align: center; color: var(--primary); margin-bottom: 1.5rem;">
        <i class="fas fa-cog"></i> Painel do Corretor - Weber Lessa
    </h3>
    
    <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h4 id="formTitle">Adicionar Novo Im√≥vel</h4>
        <form id="propertyForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>T√≠tulo do Im√≥vel *</strong></label>
                    <input type="text" id="propTitle" placeholder="Ex: Apartamento Vista Mar" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
                <div>
                    <label><strong>Pre√ßo *</strong></label>
                    <input type="text" id="propPrice" placeholder="Ex: R$ 450.000" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Localiza√ß√£o *</strong></label>
                <input type="text" id="propLocation" placeholder="Ex: Ponta Verde, Macei√≥-AL" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Descri√ß√£o</strong></label>
                <textarea id="propDescription" placeholder="Descreva o im√≥vel..." style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%; height: 100px;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Caracter√≠sticas (separadas por v√≠rgula)</strong></label>
                <input type="text" id="propFeatures" placeholder="Ex: 2 Quartos, 1 Vaga, Piscina, Varanda" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                <small style="color: #666;">Separe por v√≠rgulas</small>
            </div>

            <!-- ========== SE√á√ÉO UPLOAD DE PDFs ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Documentos PDF do Im√≥vel</strong></label>
                
                <div id="pdfUploadArea" style="border: 2px dashed #95a5a6; border-radius: 10px; padding: 1.5rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-file-pdf" style="font-size: 2rem; color: #95a5a6; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1rem; color: #555;">Clique ou arraste documentos PDF aqui</p>
                    <p style="margin: 0; font-size: 0.8rem; color: #888;">
                        <i class="fas fa-file-pdf"></i> Documentos t√©cnicos e legais
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: #999;">M√°ximo: 5 arquivos ‚Ä¢ 10MB cada</p>
                </div>
                
                <input type="file" id="pdfFileInput" multiple accept=".pdf,application/pdf" style="display: none;">
                
                <div id="pdfUploadPreview" style="margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <!-- ========== SE√á√ÉO UPLOAD DE FOTOS/VIDEOS ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Fotos e V√≠deos do Im√≥vel</strong></label>
                
                <div id="uploadArea" style="border: 2px dashed #ddd; border-radius: 10px; padding: 2rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1.1rem; color: #555;">Clique ou arraste fotos e v√≠deos aqui</p>
                    <p style="margin: 0; font-size: 0.9rem; color: #888;">
                        <i class="fas fa-image"></i> Fotos (JPG, PNG) ‚Ä¢ 
                        <i class="fas fa-video"></i> V√≠deos (MP4)
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.8rem; color: #999;">M√°ximo: 10 arquivos ‚Ä¢ 5MB cada</p>
                </div>
                
                <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                
                <div id="uploadPreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>Tipo do Im√≥vel</strong></label>
                    <select id="propType" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="residencial">Residencial</option>
                        <option value="comercial">Comercial</option>
                        <option value="rural">Rural</option>
                    </select>
                </div>
                <div>
                    <label><strong>Destaque</strong></label>
                    <select id="propBadge" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="Novo">Novo</option>
                        <option value="Destaque">Destaque</option>
                        <option value="Luxo">Luxo</option>
                        <option value="MCMV">Minha Casa Minha Vida</option>
                        <option value="Fazenda">Fazenda</option>
                        <option value="Ch√°cara">Ch√°cara</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="propHasVideo"> 
                    <span><strong>Este im√≥vel tem v√≠deo?</strong></span>
                </label>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button type="submit" style="background: var(--success); color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; flex: 1; font-size: 1.1rem;">
                    <i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site
                </button>
                <button type="button" id="cancelEditBtn" onclick="cancelEdit()" style="background: #95a5a6; color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; display: none;">
                    <i class="fas fa-times"></i> Cancelar Edi√ß√£o
                </button>
            </div>
        </form>
        
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
            <h4>Gerenciar Im√≥veis Existentes</h4>
            <p><small>Total de im√≥veis: <span id="propertyCount">0</span></small></p>
            <div id="propertyList"></div>
        </div>
    </div>
</section>

    <button class="admin-toggle" onclick="toggleAdminPanel()">
        <i class="fas fa-user-cog"></i>
    </button>

    <!-- ========== MODAL PARA DOCUMENTOS PDF ========== -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-modal-content">
            <h3 id="pdfModalTitle"><i class="fas fa-file-pdf"></i> Documentos do Im√≥vel</h3>
            <div id="pdfPreview" class="pdf-preview">
                <p>Documentos t√©cnicos e legais dispon√≠veis</p>
            </div>
            <input type="password" id="pdfPassword" class="pdf-password-input" placeholder="Digite a senha para acessar">
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button onclick="accessPdfDocuments()" style="background: var(--primary); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; flex: 1;">
                    <i class="fas fa-lock-open"></i> Acessar
                </button>
                <button onclick="closePdfModal()" style="background: #95a5a6; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            <p style="font-size: 0.8rem; color: #666; margin-top: 1rem;">
                <i class="fas fa-info-circle"></i> Solicite a senha ao corretor
            </p>
        </div>
    </div>

    <script>
// ========== DIRETRIZ CONSTITUCIONAL APERFEI√áOADA E EXPANDIDA ==========
const CONSTITUTIONAL_GUIDELINE = Object.freeze({
    // IDENTIFICA√á√ÉO E VERS√ÉO
    version: "2.0",
    established: "2024",
    lastRevision: new Date().toISOString().split('T')[0],
    developerAuthorization: "https://chat.deepseek.com",
    primaryContact: "Weber Lessa - CRECI 654/AL",
    
    // SE√á√ïES IMUT√ÅVEIS (ESTRUTURA CORE - N√ÉO MODIFICAR)
    immutableSections: Object.freeze([
        "Estrutura Visual Principal",
        "Sistema de Administra√ß√£o (Painel do Corretor)",
        "Funcionalidades de Upload (Fotos e PDFs)",
        "Sistema de Exclus√£o de Imagens/PDFs",
        "Separa√ß√£o: Fotos Existentes vs Novas Fotos",
        "Separa√ß√£o: PDFs Existentes vs Novos PDFs",
        "Bot√£o 'X' no canto superior direito para exclus√£o"
    ]),
    
    // PRINC√çPIOS FUNDAMENTAIS
    fundamentalPrinciples: Object.freeze({
        // PRINC√çPIO DA SEPARA√á√ÉO VISUAL
        visualSeparation: "Manter clara separa√ß√£o visual entre conte√∫dos existentes e novos",
        
        // PRINC√çPIO DA CONSIST√äNCIA
        consistency: "Manter formato consistente entre elementos equivalentes (bot√µes 'X' sempre no mesmo lugar)",
        
        // PRINC√çPIO DA N√ÉO DUPLICA√á√ÉO
        noDuplication: "N√£o criar fun√ß√µes duplicadas para mesma finalidade",
        
        // PRINC√çPIO DA MANUTENIBILIDADE
        maintainability: "Maximizar uso de fun√ß√µes existentes em vez de criar novas",
        
        // PRINC√çPIO DA PRESERVA√á√ÉO ESTRUTURAL
        structuralPreservation: "N√£o modificar estrutura visual aprovada sem autoriza√ß√£o expressa"
    }),
    
    // ESTRUTURAS VISUAIS APROVADAS
    approvedVisualStructures: Object.freeze({
        uploadSections: Object.freeze({
            existingImages: {
                title: "üì∏ Fotos atuais do im√≥vel (clique no X para excluir):",
                borderColor: "2px solid var(--success)",
                buttonColor: "#e74c3c"
            },
            newImages: {
                title: "üì∏ Novas fotos a serem adicionadas:",
                borderColor: "2px dashed #3498db",
                buttonColor: "#3498db"
            },
            existingPdfs: {
                title: "üìÑ Documentos atuais do im√≥vel (clique no X para excluir):",
                borderColor: "2px solid var(--success)",
                buttonColor: "#e74c3c"
            },
            newPdfs: {
                title: "üìÑ Novos documentos a serem adicionados:",
                borderColor: "2px dashed #3498db",
                buttonColor: "#3498db"
            }
        }),
        
        buttonPositions: Object.freeze({
            deleteButton: "position: absolute; top: -8px; right: -8px;",
            alwaysVisible: "Bot√£o 'X' deve ser SEMPRE vis√≠vel no canto superior direito"
        })
    }),
    
    // SISTEMA DE UPLOAD - ESPECIFICA√á√ïES T√âCNICAS
    uploadSystem: Object.freeze({
        images: Object.freeze({
            maxFiles: 10,
            maxSizeMB: 5,
            acceptedTypes: ["image/*", "video/*"],
            methods: Object.freeze(["drag-drop", "click-browse"])
        }),
        pdfs: Object.freeze({
            maxFiles: 5,
            maxSizeMB: 10,
            acceptedTypes: ["application/pdf"],
            methods: Object.freeze(["drag-drop", "click-browse"])
        })
    }),
    
    // POL√çTICA DE MODIFICA√á√ÉO
    modificationPolicy: Object.freeze({
        // RESTRI√á√ïES
        restrictions: [
            "Nenhuma modifica√ß√£o estrutural pode ser realizada sem autoriza√ß√£o expressa via plataforma oficial",
            "N√£o alterar posi√ß√£o, cor ou comportamento dos bot√µes de exclus√£o ('X')",
            "Manter t√≠tulos das se√ß√µes exatamente como definidos",
            "N√£o criar fun√ß√µes duplicadas para opera√ß√µes j√° existentes"
        ],
        
        // PROCESSO DE APROVA√á√ÉO
        approvalProcess: [
            "1. Identificar necessidade espec√≠fica",
            "2. Verificar fun√ß√µes existentes que possam atender",
            "3. Se necess√°rio criar nova fun√ß√£o, justificar por escrito",
            "4. Submeter para revis√£o via chat.deepseek.com",
            "5. Implementar apenas ap√≥s aprova√ß√£o expl√≠cita"
        ],
        
        // PARA NOVOS DESENVOLVEDORES/ASSISTENTES
        instructionsForNewContributors: [
            "ESTE SCRIPT TEM ESTRUTURA ESTABELECIDA E APROVADA",
            "Antes de sugerir altera√ß√µes, estudar as fun√ß√µes existentes",
            "Sempre maximizar uso do que j√° existe",
            "Se encontrar problema, verificar primeiro configura√ß√µes locais (VPN, firewall, cache)",
            "Problemas intermitentes s√£o frequentemente de conex√£o, n√£o de c√≥digo"
        ]
    }),
    
    // REGISTRO DE PROBLEMAS CONHECIDOS E SOLU√á√ïES
    knownIssuesRegistry: Object.freeze({
        // ISSUE #001: Click intermitente no upload
        uploadClickIntermittent: Object.freeze({
            description: "Click via mouse funciona intermitentemente em algumas m√°quinas",
            rootCause: "Configura√ß√µes locais (VPN, firewall, extens√µes do navegador)",
            solution: "Testar em m√∫ltiplos dispositivos, limpar cache, desativar VPN temporariamente",
            status: "IDENTIFICADO - n√£o √© bug do c√≥digo",
            workaround: "Usar drag & drop que funciona 100%"
        }),
        
        // ISSUE #002: Problemas de conex√£o com Supabase
        supabaseConnection: Object.freeze({
            description: "Erros intermitentes de conex√£o com Supabase",
            rootCause: "Configura√ß√£o inicial feita com VPN ativa",
            solution: "Verificar credenciais sem VPN, testar conex√£o direta",
            status: "RESOLVIDO - usar conex√£o direta sem VPN"
        })
    }),
    
    // VERIFICA√á√ÉO DE CONFORMIDADE
    complianceCheck: function() {
        console.log('üîç VERIFICA√á√ÉO DE CONFORMIDADE CONSTITUCIONAL');
        console.log('=============================================');
        
        const checks = {
            uploadSections: {
                existingImages: !!document.getElementById('existingImagesSection'),
                newImages: !!document.getElementById('newImagesSection'),
                existingPdfs: !!document.getElementById('existingPdfsSection'),
                newPdfs: !!document.getElementById('newPdfsSection')
            },
            
            coreFunctions: {
                cancelEdit: typeof cancelEdit === 'function',
                showNewImagePreview: typeof showNewImagePreview === 'function',
                handleFiles: typeof handleFiles === 'function',
                setupUploadSystem: typeof setupUploadSystem === 'function'
            },
            
            structuralIntegrity: {
                buttonsExist: document.querySelectorAll('.delete-image-btn').length > 0,
                sectionsTitles: this.checkSectionTitles()
            }
        };
        
        // Exibir resultados
        Object.entries(checks).forEach(([category, items]) => {
            console.log(`\n${category.toUpperCase()}:`);
            Object.entries(items).forEach(([item, result]) => {
                console.log(`  ${item}: ${result ? '‚úÖ' : '‚ùå'}`);
            });
        });
        
        console.log('\n=============================================');
        console.log('‚úÖ VERIFICA√á√ÉO CONSTITUCIONAL COMPLETA');
        
        return checks;
    },
    
    // M√©todo auxiliar para verificar t√≠tulos
    checkSectionTitles: function() {
        const titles = this.approvedVisualStructures.uploadSections;
        let allCorrect = true;
        
        Object.entries(titles).forEach(([section, config]) => {
            const element = document.querySelector(`#${section}Section p`);
            if (element && element.textContent !== config.title) {
                console.warn(`‚ö†Ô∏è T√≠tulo incorreto em ${section}: "${element.textContent}"`);
                allCorrect = false;
            }
        });
        
        return allCorrect;
    }
});

// Fun√ß√£o de verifica√ß√£o obrigat√≥ria
function enforceConstitutionalGuideline() {
    console.log('üèõÔ∏è APLICANDO DIRETRIZ CONSTITUCIONAL DO SCRIPT');
    
    try {
        // Verificar se h√° tentativas de modifica√ß√£o n√£o autorizadas
        const originalStructure = {
            adminPanel: document.getElementById('adminPanel') !== null,
            propertyForm: document.getElementById('propertyForm') !== null,
            uploadPreview: document.getElementById('uploadPreview') !== null,
            pdfUploadPreview: document.getElementById('pdfUploadPreview') !== null
        };
        
        // Monitorar elementos cr√≠ticos
        const criticalElements = [
            'adminPanel', 'propertyForm', 'uploadPreview', 
            'pdfUploadPreview', 'existingImagesSection', 'newImagesSection'
        ];
        
        let violations = [];
        criticalElements.forEach(elementId => {
            const element = document.getElementById(elementId);
            if (!element) {
                violations.push(`Elemento cr√≠tico ${elementId} ausente`);
                console.error(`‚ùå VIOLA√á√ÉO DA DIRETRIZ: ${elementId} removido!`);
            }
        });
        
        if (violations.length > 0) {
            console.error('üö® VIOLA√á√ïES DETECTADAS:', violations);
            alert('ATEN√á√ÉO: Estrutura do sistema comprometida. Restaure o backup original.');
        } else {
            console.log('‚úÖ Estrutura constitucional preservada');
            
            // Executar verifica√ß√£o de conformidade
            CONSTITUTIONAL_GUIDELINE.complianceCheck();
        }
        
    } catch (error) {
        console.error('‚ùå Erro na verifica√ß√£o constitucional:', error);
    }
    
    console.log('‚úÖ Diretriz Constitucional verificada e aplicada\n');
}

// ========== MONITOR CONSTITUCIONAL SIMPLES (DENTRO DO PAINEL ADMIN) ==========
function createAdminMonitor() {
    console.log('üîß Criando monitor dentro do painel admin...');
    
    // Encontrar o painel admin
    const adminPanel = document.getElementById('adminPanel');
    if (!adminPanel) {
        console.error('‚ùå Painel admin n√£o encontrado');
        return;
    }
    
    // Verificar se j√° existe monitor
    if (document.getElementById('adminMonitor')) {
        return;
    }
    
    // Criar container do monitor (estilo console F12)
    const monitorContainer = document.createElement('div');
    monitorContainer.id = 'adminMonitor';
    monitorContainer.style.cssText = `
        margin-top: 20px;
        border-top: 1px solid #dee2e6;
        padding-top: 15px;
        font-family: 'Monaco', 'Consolas', monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        background: #f8f9fa;
        border-radius: 5px;
        padding: 10px;
        display: none; /* Inicialmente oculto */
    `;
    
    // T√≠tulo do monitor
    const monitorTitle = document.createElement('div');
    monitorTitle.style.cssText = `
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 1px solid #ddd;
    `;
    
    const titleText = document.createElement('span');
    titleText.textContent = 'üìã Monitor do Sistema';
    titleText.style.fontWeight = '600';
    titleText.style.color = '#2c3e50';
    
    const toggleBtn = document.createElement('button');
    toggleBtn.innerHTML = '‚àí';
    toggleBtn.style.cssText = `
        background: #6c757d;
        color: white;
        border: none;
        width: 20px;
        height: 20px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 14px;
        line-height: 1;
    `;
    toggleBtn.onclick = function() {
        const logsArea = document.getElementById('monitorLogsArea');
        if (logsArea.style.display === 'none') {
            logsArea.style.display = 'block';
            this.innerHTML = '‚àí';
        } else {
            logsArea.style.display = 'none';
            this.innerHTML = '+';
        }
    };
    
    monitorTitle.appendChild(titleText);
    monitorTitle.appendChild(toggleBtn);
    monitorContainer.appendChild(monitorTitle);
    
    // √Årea de logs
    const logsArea = document.createElement('div');
    logsArea.id = 'monitorLogsArea';
    logsArea.style.cssText = `
        max-height: 150px;
        overflow-y: auto;
        font-size: 11px;
        line-height: 1.3;
        background: white;
        padding: 8px;
        border-radius: 3px;
        border: 1px solid #e9ecef;
    `;
    
    monitorContainer.appendChild(logsArea);
    
    // Status bar
    const statusBar = document.createElement('div');
    statusBar.id = 'monitorStatusBar';
    statusBar.style.cssText = `
        margin-top: 8px;
        padding-top: 5px;
        border-top: 1px solid #ddd;
        font-size: 10px;
        color: #6c757d;
        text-align: right;
    `;
    statusBar.textContent = 'Pronto';
    
    monitorContainer.appendChild(statusBar);
    
    // Adicionar ao painel admin (ap√≥s a lista de im√≥veis)
    const propertyList = document.getElementById('propertyList');
    if (propertyList && propertyList.parentNode) {
        propertyList.parentNode.insertBefore(monitorContainer, propertyList.nextSibling);
    } else {
        adminPanel.appendChild(monitorContainer);
    }
    
    console.log('‚úÖ Monitor criado dentro do painel admin');
    return monitorContainer;
}

// ========== SISTEMA DE LOGS SIMPLES ==========
const SystemMonitor = {
    logs: [],
    maxLogs: 50,
    
    // Adicionar log
    log: function(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = { time: timestamp, message: message, type: type };
        
        // Adicionar √† mem√≥ria
        this.logs.push(logEntry);
        if (this.logs.length > this.maxLogs) {
            this.logs.shift(); // Remove o mais antigo
        }
        
        // Atualizar display se monitor vis√≠vel
        this.updateDisplay();
        
        // Tamb√©m logar no console real
        const consoleMsg = `[${timestamp}] ${message}`;
        if (type === 'error') console.error(consoleMsg);
        else if (type === 'warn') console.warn(consoleMsg);
        else console.log(consoleMsg);
    },
    
    // Atualizar display
    // NO SystemMonitor, substitua a fun√ß√£o updateDisplay:
updateDisplay: function() {
    const logsArea = document.getElementById('monitorLogsArea');
    const statusBar = document.getElementById('monitorStatusBar');
    
    if (!logsArea || !statusBar) return;
    
    // Limpar e recriar logs
    logsArea.innerHTML = '';
    
    this.logs.forEach(log => {
        const logLine = document.createElement('div');
        logLine.style.cssText = `
            margin-bottom: 2px;
            padding: 2px 4px;
            border-radius: 2px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            ${log.type === 'error' ? 'background: #fee; color: #c7254e;' : ''}
            ${log.type === 'warn' ? 'background: #fff3cd; color: #856404;' : ''}
            ${log.type === 'success' ? 'background: #d4edda; color: #155724;' : ''}
        `;
        
        logLine.innerHTML = `<span style="color: #6c757d;">[${log.time}]</span> ${log.message}`;
        logsArea.appendChild(logLine);
    });
    
    // Auto-scroll
    logsArea.scrollTop = logsArea.scrollHeight;
    
    // CORRE√á√ÉO: Usar this.logs para pegar timestamp
    const lastLog = this.logs[this.logs.length - 1];
    if (lastLog) {
        statusBar.textContent = `√öltima: ${lastLog.time} | Total: ${this.logs.length} logs`;
    } else {
        statusBar.textContent = 'Pronto | Total: 0 logs';
    }
},
    
    // Verifica√ß√£o r√°pida do sistema
    quickCheck: function() {
        this.log('üîç Verifica√ß√£o r√°pida do sistema...');
        
        // Verificar elementos essenciais
        const essentials = ['adminPanel', 'propertyForm', 'uploadPreview', 'pdfUploadPreview'];
        essentials.forEach(id => {
            if (document.getElementById(id)) {
                this.log(`‚úÖ ${id} encontrado`, 'success');
            } else {
                this.log(`‚ùå ${id} AUSENTE`, 'error');
            }
        });
        
        // Verificar bot√µes de exclus√£o
        const deleteButtons = document.querySelectorAll('.delete-image-btn');
        if (deleteButtons.length > 0) {
            this.log(`‚úÖ ${deleteButtons.length} bot√µes de exclus√£o funcionais`, 'success');
        }
        
        this.log('‚úÖ Verifica√ß√£o completa');
    },
    
    // Limpar logs
    clear: function() {
        this.logs = [];
        this.updateDisplay();
        this.log('üßπ Logs limpos');
    }
};

// ========== INTEGRA√á√ÉO COM O SISTEMA ==========
function setupAdminMonitor() {
    // Criar monitor quando admin abrir
    const adminPanel = document.getElementById('adminPanel');
    if (adminPanel && adminPanel.style.display === 'block') {
        createAdminMonitor();
        
        // Mostrar monitor
        const monitor = document.getElementById('adminMonitor');
        if (monitor) {
            monitor.style.display = 'block';
            SystemMonitor.log('üü¢ Monitor do sistema ativado');
            SystemMonitor.quickCheck();
        }
    }
}

// ========== SUBSTITUIR A FUN√á√ÉO toggleAdminPanel ==========
const originalToggleAdminPanel = toggleAdminPanel;
toggleAdminPanel = function() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        originalToggleAdminPanel();
        
        // Ap√≥s abrir painel, configurar monitor
        setTimeout(() => {
            setupAdminMonitor();
        }, 300);
    } else {
        alert("Senha incorreta!");
    }
};

// ========== MONITORAR EVENTOS DO SISTEMA ==========
function monitorSystemEvents() {
    // Monitorar fun√ß√£o handleFiles
    const originalHandleFiles = handleFiles;
    if (originalHandleFiles) {
        handleFiles = function(files) {
            SystemMonitor.log(`üì∏ ${files.length} arquivo(s) para upload`);
            return originalHandleFiles.apply(this, arguments);
        };
    }
    
    // Monitorar edi√ß√£o
    const originalEditProperty = editProperty;
    if (originalEditProperty) {
        editProperty = function(id) {
            SystemMonitor.log(`üè† Editando im√≥vel ID: ${id}`);
            return originalEditProperty.apply(this, arguments);
        };
    }
    
    // Monitorar salvamento
    const originalSaveProperty = saveProperty;
    if (originalSaveProperty) {
        saveProperty = function(propertyData) {
            SystemMonitor.log(`üíæ Salvando: "${propertyData.title.substring(0, 30)}..."`);
            return originalSaveProperty.apply(this, arguments);
        };
    }
    
    // Monitorar exclus√£o
    const originalDeleteProperty = deleteProperty;
    if (originalDeleteProperty) {
        deleteProperty = function(id) {
            SystemMonitor.log(`üóëÔ∏è Excluindo im√≥vel ID: ${id}`);
            return originalDeleteProperty.apply(this, arguments);
        };
    }
    
    SystemMonitor.log('‚úÖ Monitoramento de eventos configurado');
}

// ========== ATUALIZAR enforceConstitutionalGuideline ==========
function enforceConstitutionalGuideline() {
    // Apenas inicializar monitoramento
    setTimeout(() => {
        if (typeof setupAdminMonitor === 'function') {
            setupAdminMonitor();
        }
        if (typeof monitorSystemEvents === 'function') {
            monitorSystemEvents();
        }
    }, 1000);
}

// ========== ADICIONAR BOT√ÉO DE CONTROLE NO PAINEL ==========
function addMonitorControls() {
    const adminPanel = document.getElementById('adminPanel');
    if (!adminPanel) return;
    
    // Criar barra de controles
    const controlsBar = document.createElement('div');
    controlsBar.style.cssText = `
        display: flex;
        gap: 8px;
        margin: 10px 0;
        padding: 8px;
        background: #f8f9fa;
        border-radius: 5px;
        border: 1px solid #dee2e6;
    `;
    
    // Bot√£o Verificar
    const checkBtn = document.createElement('button');
    checkBtn.innerHTML = 'üîç Verificar Sistema';
    checkBtn.style.cssText = `
        padding: 6px 12px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    `;
    checkBtn.onclick = () => SystemMonitor.quickCheck();
    
    // Bot√£o Limpar
    const clearBtn = document.createElement('button');
    clearBtn.innerHTML = 'üßπ Limpar Logs';
    clearBtn.style.cssText = `
        padding: 6px 12px;
        background: #95a5a6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    `;
    clearBtn.onclick = () => SystemMonitor.clear();
    
    controlsBar.appendChild(checkBtn);
    controlsBar.appendChild(clearBtn);
    
    // Adicionar ap√≥s o t√≠tulo do painel
    const panelTitle = adminPanel.querySelector('h3');
    if (panelTitle) {
        panelTitle.parentNode.insertBefore(controlsBar, panelTitle.nextSibling);
    } else {
        adminPanel.insertBefore(controlsBar, adminPanel.firstChild);
    }
}

// ========== INICIALIZAR QUANDO ADMIN ABRIR ==========
// Monitorar quando o painel ficar vis√≠vel
const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            const adminPanel = document.getElementById('adminPanel');
            if (adminPanel && adminPanel.style.display === 'block') {
                setTimeout(() => {
                    setupAdminMonitor();
                    addMonitorControls();
                }, 500);
            }
        }
    });
});

// ========== CONFIGURA√á√ÉO SUPABASE ==========
//REMOVIDO       
// ========== FUN√á√ÉO PARA CARREGAR E EXIBIR IM√ìVEIS ==========
async function initializeProperties() {
    console.log('üîç Inicializando sistema de im√≥veis...');
    
    // Tentar carregar do Supabase primeiro
    try {
        console.log('üì° Tentando carregar do Supabase...');
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=*&order=created_at.desc`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            console.log(`‚úÖ ${data.length} im√≥veis carregados do Supabase`);
            
            // Processar os dados
            properties = Array.isArray(data) ? data : [];
            
            // Garantir que todos os campos estejam corretos
            properties = properties.map(property => {
                // Se images estiver vazio, usar imagem padr√£o
                if (!property.images || property.images === 'EMPTY' || property.images.trim() === '') {
                    property.images = "https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                
                // Garantir que pdfs seja uma string v√°lida
                if (!property.pdfs || property.pdfs === 'null' || property.pdfs === 'undefined') {
                    property.pdfs = '';
                }
                
                return property;
            });
            
        } else {
            throw new Error('Supabase n√£o dispon√≠vel');
        }
        
    } catch (error) {
        console.log('‚ö†Ô∏è Supabase n√£o acess√≠vel:', error.message);
        console.log('üîÑ Carregando dados locais...');
        
        // Carregar do localStorage
        const localData = localStorage.getItem('weberlessa_properties');
        if (localData) {
            properties = JSON.parse(localData);
            console.log(`üìÅ ${properties.length} im√≥veis carregados do localStorage`);
        } else {
            // Usar dados iniciais
            properties = getInitialProperties();
            console.log(`üéØ ${properties.length} im√≥veis de exemplo carregados`);
            
            // Salvar no localStorage para refer√™ncia futura
            localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
        }
    }
    
    // VERIFICA√á√ÉO CR√çTICA: Mostrar debug dos dados
    console.log('üìä DEBUG - Total de im√≥veis carregados:', properties.length);
    if (properties.length > 0) {
        console.log('üìã Lista de im√≥veis carregados:');
        properties.forEach((p, i) => {
            console.log(`${i + 1}. ${p.title} - ${p.price} (ID: ${p.id})`);
        });
    } else {
        console.error('‚ùå NENHUM IM√ìVEL CARREGADO!');
        // Adicionar um im√≥vel de exemplo se estiver vazio
        properties = getInitialProperties();
        console.log('‚ûï Adicionados im√≥veis de exemplo:', properties.length);
    }
    
    // Renderizar os im√≥veis
    renderProperties();
    
    // Configurar filtros
    setupFilters();
    
    console.log('‚úÖ Sistema de im√≥veis inicializado com sucesso!');
}

// ========== NOVA FUN√á√ÉO: MOSTRAR PREVIEW DE NOVAS IMAGENS ==========
// ========== CORRE√á√ÉO DA FUN√á√ÉO showNewImagePreview() ==========
// ========== FUN√á√ÉO showNewImagePreview() ATUALIZADA ==========
function showNewImagePreview() {
    console.log('üîç showNewImagePreview() chamada com', selectedFiles.length, 'arquivos');
    
    const preview = document.getElementById('uploadPreview');
    if (!preview) {
        console.error('‚ùå Elemento uploadPreview n√£o encontrado!');
        return;
    }
    
    // Verificar se j√° existe se√ß√£o de novas imagens
    let newImagesSection = document.getElementById('newImagesSection');
    
    if (!newImagesSection) {
        console.log('‚ö†Ô∏è Se√ß√£o de novas imagens n√£o encontrada, criando...');
        const existingSection = document.getElementById('existingImagesSection');
        if (existingSection) {
            // Criar ap√≥s a se√ß√£o existente
            newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            existingSection.parentNode.insertBefore(newImagesSection, existingSection.nextSibling);
        } else {
            // Criar na √°rea principal
            newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
        }
    }
    
    // Se ainda n√£o encontrou a se√ß√£o, sair
    if (!newImagesSection) {
        console.error('‚ùå N√£o foi poss√≠vel criar se√ß√£o de novas imagens');
        return;
    }
    
    // LIMPAR APENAS O CONTE√öDO DA SE√á√ÉO DE NOVAS (n√£o a se√ß√£o inteira)
    const header = newImagesSection.querySelector('p');
    if (header) {
        // Manter o cabe√ßalho e limpar o resto
        newImagesSection.innerHTML = '';
        newImagesSection.appendChild(header);
    } else {
        newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
    }

    if (selectedFiles.length === 0) {
        newImagesSection.innerHTML += '<p style="color: #666; text-align: center; padding: 1rem;">Nenhuma nova foto selecionada</p>';
        return;
    }

    console.log('üé® Renderizando', selectedFiles.length, 'NOVAS imagens');
    
    // Container para as novas imagens
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.gap = '10px';
    newContainer.style.marginBottom = '1rem';
    
    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';

        if (file.type.startsWith('image/')) {
            const imageUrl = URL.createObjectURL(file);
            
            fileItem.innerHTML = `
                <img src="${imageUrl}" 
                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px dashed #3498db;"
                     onload="URL.revokeObjectURL(this.src)" 
                     onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                <!-- BOT√ÉO "X" NO CANTO SUPERIOR DIREITO -->
                <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                        style="background: #3498db;" 
                        title="Remover esta foto">√ó</button>
                <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                    ${file.name.substring(0, 12)}${file.name.length > 12 ? '...' : ''}
                </div>
            `;
            
        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f8ff; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                     display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; 
                     border: 2px dashed #3498db;">
                    <i class="fas fa-video" style="font-size: 2rem; color: #3498db;"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">
                        ${file.name.substring(0, 12)}${file.name.length > 12 ? '...' : ''}
                    </p>
                    <!-- BOT√ÉO "X" NO CANTO SUPERIOR DIREITO -->
                    <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                            style="background: #3498db;" 
                            title="Remover este v√≠deo">√ó</button>
                </div>
                <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; color: #666;">
                    ${(file.size / 1024 / 1024).toFixed(1)} MB
                </div>
            `;
        }
        
        newContainer.appendChild(fileItem);
    });
    
    newImagesSection.appendChild(newContainer);
    console.log('‚úÖ Se√ß√£o de novas imagens atualizada');
}

// ========== NOVA FUN√á√ÉO: REMOVER NOVA IMAGEM/VIDEO ==========
function removeNewFile(index) {
    console.log('üóëÔ∏è Tentando remover novo arquivo no √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja remover este arquivo da lista de novos?')) {
        selectedFiles.splice(index, 1);
        console.log('üóëÔ∏è Arquivo removido. Arquivos novos restantes:', selectedFiles.length);
        showNewImagePreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.files = dataTransfer.files;
            console.log('üì∏ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}

// ========== SISTEMA DE EXCLUS√ÉO DE PDFs INDIVIDUAIS ==========
function showPdfPreview() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'pdf-file-item';
        fileItem.innerHTML = `
            <i class="fas fa-file-pdf" style="color: #e74c3c; font-size: 1.2rem;"></i>
            <div style="flex: 1;">
                <div style="font-weight: 500;">${file.name}</div>
                <div style="font-size: 0.8rem; color: #666;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
            </div>
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">√ó</button>
        `;
        preview.appendChild(fileItem);
    });
}

function removePdfFile(index) {
    if (confirm('Tem certeza que deseja excluir este PDF?')) {
        selectedPdfFiles.splice(index, 1);
        showPdfPreviewWithDelete(); // Usar fun√ß√£o com bot√£o "X"
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('pdfFileInput').files = dataTransfer.files;
    }
}

// ========== RENDERIZAR IM√ìVEIS CORRIGIDO ==========
// ========== ATUALIZAR A FUN√á√ÉO renderProperties() ==========
// Substitua a fun√ß√£o renderProperties existente por esta vers√£o:
function renderProperties(filter = 'todos') {
    const container = document.getElementById('properties-container');
    if (!container) {
        console.error('‚ùå Container de propriedades n√£o encontrado!');
        return;
    }
    
    container.innerHTML = '';
    
    const filteredProperties = filter === 'todos' ? properties : properties.filter(p => {
        if (filter === 'Residencial') return p.type === 'residencial';
        if (filter === 'Comercial') return p.type === 'comercial';
        if (filter === 'Rural') return p.type === 'rural';
        if (filter === 'Minha Casa Minha Vida') return p.badge === 'MCMV';
        return true;
    });
    
    if (filteredProperties.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Nenhum im√≥vel encontrado para este filtro.</p>';
        return;
    }
    
    console.log(`üé® Renderizando ${filteredProperties.length} im√≥veis...`);
    
    filteredProperties.forEach(property => {
        const features = Array.isArray(property.features) ? property.features : (property.features ? property.features.split(',') : []);
        
        // USAR A NOVA GALERIA DE IMAGENS
        const propertyGalleryHTML = createPropertyGallery(property);
        
        const card = `
            <div class="property-card">
                ${propertyGalleryHTML}
                <div class="property-content">
                    <div class="property-price">${property.price}</div>
                    <h3 class="property-title">${property.title}</h3>
                    <div class="property-location"><i class="fas fa-map-marker-alt"></i> ${property.location}</div>
                    <p>${property.description}</p>
                    <div class="property-features">
                        ${features.map(f => `<span class="feature-tag ${property.rural ? 'rural-tag' : ''}">${f.trim()}</span>`).join('')}
                    </div>
                    <button class="contact-btn" onclick="contactAgent(${property.id})">
                        <i class="fab fa-whatsapp"></i> Entrar em Contato
                    </button>
                </div>
            </div>
        `;
        container.innerHTML += card;
    });
}
        
// ========== FUN√á√ÉO toggleAdminPanel() CORRIGIDA ==========
function toggleAdminPanel() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        const panel = document.getElementById('adminPanel');
        if (panel) {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                // LIMPAR FORMUL√ÅRIO AO ABRIR PAINEL
                cancelEdit(); // Chama a fun√ß√£o que limpa tudo
                loadPropertyList();
                
                // GARANTIR QUE O UPLOAD FUNCIONE
                setTimeout(() => {
                    setupUploadSystem();
                    setupPdfUploadSystem();
                }, 300);
            }
        }
    } else {
        alert("Senha incorreta!");
    }
}
        
// ========== SISTEMA DE DOCUMENTOS PDF ==========
let currentPdfPropertyId = null;
// Mostrar modal de PDF
function showPdfModal(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;

    currentPdfPropertyId = propertyId;
    const modal = document.getElementById('pdfModal');
    const title = document.getElementById('pdfModalTitle');
    const preview = document.getElementById('pdfPreview');
    
    if (title) {
        title.innerHTML = `<i class="fas fa-file-pdf"></i> Documentos - ${property.title}`;
    }
    
    if (preview) {
        if (property.pdfs && property.pdfs.length > 0) {
            const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
            preview.innerHTML = `
                <p><strong>${pdfUrls.length} documento(s) dispon√≠vel(is):</strong></p>
                ${pdfUrls.map((url, index) => `
                    <div class="pdf-file-item">
                        <i class="fas fa-file-pdf" style="color: #e74c3c;"></i>
                        <span>Documento ${index + 1}</span>
                    </div>
                `).join('')}
            `;
        } else {
            preview.innerHTML = '<p>Nenhum documento dispon√≠vel para este im√≥vel.</p>';
        }
    }
    
    // Resetar senha
    const passwordInput = document.getElementById('pdfPassword');
    if (passwordInput) passwordInput.value = '';
    
    modal.style.display = 'flex';
}

// Fechar modal
function closePdfModal() {
    const modal = document.getElementById('pdfModal');
    modal.style.display = 'none';
    currentPdfPropertyId = null;
}

// Acessar documentos com senha
function accessPdfDocuments() {
    const passwordInput = document.getElementById('pdfPassword');
    const password = passwordInput ? passwordInput.value : '';
    
    if (password !== PDF_PASSWORD) {
        alert('‚ùå Senha incorreta! Solicite a senha ao corretor.');
        return;
    }
    
    const property = properties.find(p => p.id === currentPdfPropertyId);
    if (!property || !property.pdfs) {
        alert('‚ùå Nenhum documento dispon√≠vel para este im√≥vel.');
        return;
    }
    
    // Abrir todos os PDFs em novas abas
    const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
    pdfUrls.forEach(url => {
        window.open(url, '_blank');
    });
    
    closePdfModal();
    alert('‚úÖ Documentos abertos com sucesso!');
}
        
// ========== CORRE√á√ÉO DO SISTEMA DE UPLOAD DE PDFs ==========
function setupPdfUploadSystem() {
    const pdfUploadArea = document.getElementById('pdfUploadArea');
    const pdfFileInput = document.getElementById('pdfFileInput');
    const pdfPreview = document.getElementById('pdfUploadPreview');

    if (pdfUploadArea && pdfFileInput) {
        // Drag and drop para PDFs
        pdfUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = 'var(--primary)';
            pdfUploadArea.style.background = '#f0f8ff';
        });

        pdfUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
        });

        pdfUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
            
            const files = Array.from(e.dataTransfer.files).filter(file => 
                file.type === 'application/pdf'
            );
            
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });

        // CORRE√á√ÉO: Click para selecionar - evitar propaga√ß√£o de eventos
        pdfUploadArea.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('üìÅ Click no upload area de PDFs');
            pdfFileInput.click();
        });

        // CORRE√á√ÉO: Lidar com mudan√ßa no input de arquivo
        pdfFileInput.addEventListener('change', (e) => {
            console.log('üìÑ Input de arquivo PDF alterado:', e.target.files.length, 'arquivos');
            const files = Array.from(e.target.files).filter(file => 
                file.type === 'application/pdf'
            );
            console.log('üìÑ PDFs filtrados:', files.length);
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });
        
        // CORRE√á√ÉO: Prevenir comportamento padr√£o do input
        pdfFileInput.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    } else {
        console.error('‚ùå Elementos do upload de PDFs n√£o encontrados:', {
            pdfUploadArea: !!pdfUploadArea,
            pdfFileInput: !!pdfFileInput,
            pdfPreview: !!pdfPreview
        });
    }
}

// ========== CORRE√á√ÉO DA FUN√á√ÉO HANDLE PDF FILES ==========
function handlePdfFiles(files) {
    console.log('üìÑ Processando novos PDFs:', files);
    
    const newFiles = Array.from(files);
    
    // CORRE√á√ÉO: Contar apenas novos PDFs, n√£o os existentes
    const currentNewPdfCount = selectedPdfFiles.length;
    const totalAfterAdd = currentNewPdfCount + newFiles.length;
    
    // Limitar a 5 arquivos PDF no total (novos)
    if (totalAfterAdd > 5) {
        alert('‚ö†Ô∏è M√°ximo de 5 novos arquivos PDF permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (10MB max para PDFs)
    for (const file of newFiles) {
        if (file.size > 10 * 1024 * 1024) {
            alert(`‚ö†Ô∏è O arquivo PDF "${file.name}" √© muito grande! M√°ximo: 10MB`);
            return;
        }
    }
    
    // CORRE√á√ÉO: Adicionar novos PDFs √† lista existente
    selectedPdfFiles = [...selectedPdfFiles, ...newFiles];
    console.log('üìÑ PDFs selecionados ap√≥s adi√ß√£o:', selectedPdfFiles.length);
    
    // CORRE√á√ÉO: Mostrar apenas novos PDFs na se√ß√£o apropriada
    showNewPdfPreview();
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
    document.getElementById('pdfFileInput').files = dataTransfer.files;
    console.log('üìÑ Input file atualizado');
}

// ========== FUN√á√ÉO CR√çTICA: VERIFICAR E CRIAR CAMPO PDFs NO SUPABASE ==========
async function ensurePdfFieldExists() {
    try {
        console.log('üîç Verificando se o campo pdfs existe no Supabase...');
        
        // Primeiro, tentar verificar a estrutura da tabela
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=pdfs&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.status === 400) {
            console.log('‚ö†Ô∏è Campo pdfs n√£o existe ou tem problemas. Tentando criar...');
            
            // Se n√£o existir, tentar adicionar um im√≥vel com o campo pdfs
            const testData = {
                title: "Teste PDF Field",
                price: "R$ 0,00",
                location: "Teste",
                description: "Teste do campo PDF",
                features: "Teste",
                type: "residencial",
                has_video: false,
                badge: "Novo",
                rural: false,
                created_at: new Date().toISOString(),
                pdfs: "" // Campo vazio para criar a estrutura
            };
            
            const createResponse = await fetch(`${SUPABASE_URL}/rest/v1/properties`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify(testData)
            });
            
            if (createResponse.ok) {
                console.log('‚úÖ Campo pdfs criado com sucesso!');
                
                // Excluir o registro de teste
                const testData = await createResponse.json();
                if (testData && testData[0] && testData[0].id) {
                    await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${testData[0].id}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    console.log('‚úÖ Registro de teste removido');
                }
            }
        } else if (response.ok) {
            console.log('‚úÖ Campo pdfs j√° existe no Supabase!');
        }
        
    } catch (error) {
        console.error('‚ùå Erro ao verificar campo pdfs:', error);
    }
}
        
// ========== CORRE√á√ÉO URGENTE: FUN√á√ÉO DE UPLOAD DE PDFs ==========
async function uploadPdfFile(file) {
    try {
        console.log('üì§ Iniciando upload de PDF:', file.name);
        
        // Sanitizar nome do arquivo
        const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
        const fileName = `pdf_${Date.now()}_${safeName}`;
        
        console.log('üìÅ Nome do arquivo para upload:', fileName);
        
        // Criar FormData
        const formData = new FormData();
        formData.append('file', file, fileName);
        
        // DEBUG: Mostrar headers
        console.log('üì§ Headers da requisi√ß√£o:', {
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'apikey': SUPABASE_KEY
        });
        
        // Fazer upload para o storage
        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, 
            {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );
        
        console.log('üìä Status da resposta:', response.status);
        console.log('üìä Status OK?', response.ok);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro detalhado no upload do PDF:', {
                status: response.status,
                statusText: response.statusText,
                error: errorText
            });
            
            // Tentar alternativa: usar bucket p√∫blico
            const altResponse = await fetch(
                `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`, 
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'apikey': SUPABASE_KEY
                    },
                    body: formData
                }
            );
            
            if (altResponse.ok) {
                const altResult = await altResponse.json();
                const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
                console.log('‚úÖ PDF upload alternativo conclu√≠do:', publicUrl);
                return publicUrl;
            } else {
                const altError = await altResponse.text();
                console.error('‚ùå Erro no upload alternativo:', altError);
                throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
            }
        }

        const result = await response.json();
        console.log('üìÑ Resultado do upload:', result);
        
        // Construir URL p√∫blica correta
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('‚úÖ PDF upload conclu√≠do com sucesso!');
        console.log('üîó URL p√∫blica:', publicUrl);
        
        // Verificar se a URL √© acess√≠vel
        try {
            const testResponse = await fetch(publicUrl, { method: 'HEAD' });
            console.log('üîç Teste de acesso √† URL:', testResponse.ok);
        } catch (testError) {
            console.log('‚ö†Ô∏è URL pode n√£o estar acess√≠vel publicamente');
        }
        
        return publicUrl;
        
    } catch (error) {
        console.error('‚ùå Erro cr√≠tico no upload do PDF:', error);
        console.error('üìÑ Detalhes do arquivo:', {
            name: file.name,
            type: file.type,
            size: file.size,
            lastModified: file.lastModified
        });
        return null;
    }
}

// ========== EXCLUIR PDF EXISTENTE DO IM√ìVEL ==========
async function deleteExistingPdf(propertyId, pdfIndex) {
    if (!confirm('Tem certeza que deseja excluir este documento PDF? Esta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.pdfs) return;

    try {
        // Separar as URLs dos PDFs
        const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
        
        // Remover o PDF selecionado
        if (pdfIndex >= 0 && pdfIndex < pdfUrls.length) {
            const pdfToDelete = pdfUrls[pdfIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = pdfToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('‚úÖ PDF exclu√≠do do Supabase Storage:', fileName);
                    } else {
                        console.log('‚ö†Ô∏è N√£o foi poss√≠vel excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('‚ö†Ô∏è Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            pdfUrls.splice(pdfIndex, 1);
            
            // Atualizar a propriedade
            property.pdfs = pdfUrls.length > 0 ? pdfUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ pdfs: property.pdfs })
            });

            if (response.ok) {
                console.log('‚úÖ PDF exclu√≠do com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualiza√ß√£o
                editProperty(propertyId);
                alert('‚úÖ Documento PDF exclu√≠do com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro ao excluir PDF:', error);
        alert('‚ùå Erro ao excluir o documento PDF. Tente novamente.');
    }
}

// ========== MOSTRAR PREVIEW DE PDFs COM BOT√ïES "X" ==========
// ========== FUN√á√ÉO showPdfPreviewWithDelete() ==========
function showPdfPreviewWithDelete() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    // Para NOVOS PDFs (ainda n√£o salvos)
    const newSection = document.createElement('div');
    newSection.id = 'newPdfsSection';
    newSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
    
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.gap = '10px';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.marginBottom = '1rem';
    
    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';
        
        fileItem.innerHTML = `
            <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                 display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
            </div>
            <!-- BOT√ÉO "X" NO CANTO SUPERIOR DIREITO -->
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">√ó</button>
            <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                ${(file.size / 1024 / 1024).toFixed(2)} MB
            </div>
        `;
        newContainer.appendChild(fileItem);
    });
    
    newSection.appendChild(newContainer);
    preview.appendChild(newSection);
}
        
// ========== NOVA FUN√á√ÉO: MOSTRAR PREVIEW DE NOVOS PDFs ==========
// ========== FUN√á√ÉO showNewPdfPreview() RESTAURADA ==========
function showNewPdfPreview() {
    console.log('üìÑ showNewPdfPreview() - Renderizando NOVOS PDFs');
    
    let newPdfsSection = document.getElementById('newPdfsSection');
    
    if (!newPdfsSection) {
        console.log('‚ö†Ô∏è Se√ß√£o de novos PDFs n√£o encontrada, criando...');
        const pdfPreview = document.getElementById('pdfUploadPreview');
        if (pdfPreview) {
            // Verificar se j√° existe se√ß√£o de novos PDFs
            let existingNewSection = document.getElementById('newPdfsSection');
            if (!existingNewSection) {
                existingNewSection = document.createElement('div');
                existingNewSection.id = 'newPdfsSection';
                existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
                pdfPreview.appendChild(existingNewSection);
            }
            newPdfsSection = existingNewSection;
        } else {
            return;
        }
    }
    
    // Limpar apenas a se√ß√£o de novos PDFs (mant√©m o t√≠tulo)
    const existingTitle = newPdfsSection.querySelector('p');
    newPdfsSection.innerHTML = '';
    if (existingTitle) {
        newPdfsSection.appendChild(existingTitle);
    } else {
        newPdfsSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
    }

    if (selectedPdfFiles.length === 0) {
        newPdfsSection.innerHTML += '<p style="color: #666; text-align: center;">Nenhum novo PDF selecionado</p>';
        return;
    }

    console.log('üé® Renderizando preview de', selectedPdfFiles.length, 'novos PDFs');
    
    // Container para os novos PDFs
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.gap = '10px';
    newContainer.style.flexWrap = 'wrap';
    newContainer.style.marginBottom = '1rem';
    
    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.style.position = 'relative';
        fileItem.style.margin = '5px';
        
        fileItem.innerHTML = `
            <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; 
                 display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
            </div>
            <!-- BOT√ÉO "X" NO CANTO SUPERIOR DIREITO -->
            <button class="delete-image-btn" onclick="removeNewPdfFile(${index})" 
                    title="Excluir este PDF">√ó</button>
            <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">
                ${(file.size / 1024 / 1024).toFixed(2)} MB
            </div>
        `;
        newContainer.appendChild(fileItem);
    });
    
    newPdfsSection.appendChild(newContainer);
    console.log('‚úÖ Novos PDFs renderizados com bot√£o "X"');
}
        
// ========== NOVA FUN√á√ÉO: REMOVER PDF NOVO ==========
// ========== FUN√á√ÉO removeNewPdfFile() ==========
function removeNewPdfFile(index) {
    console.log('üóëÔ∏è Tentando remover novo PDF no √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja remover este PDF da lista de novos documentos?')) {
        selectedPdfFiles.splice(index, 1);
        console.log('üóëÔ∏è PDF removido. PDFs novos restantes:', selectedPdfFiles.length);
        showNewPdfPreview(); // Usar a fun√ß√£o corrigida
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        const pdfFileInput = document.getElementById('pdfFileInput');
        if (pdfFileInput) {
            pdfFileInput.files = dataTransfer.files;
            console.log('üìÑ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}
        
// ========== CORRE√á√ÉO DA FUN√á√ÉO EDIT PROPERTY PARA FOTOS ==========
// ========== FUN√á√ÉO editProperty() COMPLETA E CORRIGIDA ==========
function editProperty(id) {
    const property = properties.find(p => p.id === id);
    if (!property) return;

    editingPropertyId = id;
    
    // Preencher formul√°rio
    document.getElementById('propTitle').value = property.title || '';
    document.getElementById('propPrice').value = property.price || '';
    document.getElementById('propLocation').value = property.location || '';
    document.getElementById('propDescription').value = property.description || '';
    
    const features = Array.isArray(property.features) 
        ? property.features 
        : (property.features || '');
    document.getElementById('propFeatures').value = Array.isArray(features) ? features.join(', ') : features;
    
    document.getElementById('propType').value = property.type || 'residencial';
    document.getElementById('propBadge').value = property.badge || 'Novo';
    
    document.getElementById('propHasVideo').checked = property.has_video || false;
    
    // Atualizar t√≠tulo do formul√°rio
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Editar Im√≥vel';
    }
    
    // Atualizar texto do bot√£o
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Im√≥vel';
    }
    
    // Mostrar bot√£o cancelar
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'block';
    }
    
    // CORRE√á√ÉO: Inicializar arrays vazios mas manter refer√™ncia para adi√ß√µes futuras
    selectedFiles = [];
    
    // CORRE√á√ÉO: Mostrar imagens existentes se houver - COM SEPARA√á√ÉO ENTRE EXISTENTES E NOVAS
    const preview = document.getElementById('uploadPreview');
    if (preview) {
        preview.innerHTML = '';
        
        if (property.images && property.images.length > 0 && property.images !== 'EMPTY') {
            const existingImages = property.images.split(',').filter(img => img.trim() !== '');
            
            // CORRE√á√ÉO: Criar uma √°rea separada para imagens existentes
            preview.innerHTML = '<div id="existingImagesSection">';
            preview.innerHTML += '<p style="color: var(--success); margin-bottom: 1rem;">üì∏ Fotos atuais do im√≥vel (clique no X para excluir):</p>';
            
            // Container para imagens existentes
            const existingContainer = document.createElement('div');
            existingContainer.style.display = 'flex';
            existingContainer.style.gap = '10px';
            existingContainer.style.flexWrap = 'wrap';
            existingContainer.style.marginBottom = '1.5rem';
            
            existingImages.forEach((imgUrl, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'image-preview-container';
                imgContainer.innerHTML = `
                    <img src="${imgUrl}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid var(--success);"
                         onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                    <button class="delete-image-btn" onclick="deleteExistingImage(${property.id}, ${index})" 
                            title="Excluir esta foto">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Foto ${index + 1}</div>
                `;
                existingContainer.appendChild(imgContainer);
            });
            
            preview.appendChild(existingContainer);
            preview.innerHTML += '</div>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novas imagens
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
            
            // Armazenar URLs das imagens existentes para refer√™ncia futura
            property.existingImageUrls = existingImages;
            
        } else {
            preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma foto cadastrada</p>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novas imagens mesmo quando n√£o h√° existentes
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
        }
    }
    
    // CORRE√á√ÉO: Mostrar PDFs existentes se houver - COM SEPARA√á√ÉO ENTRE EXISTENTES E NOVOS
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '';
        
        // CORRE√á√ÉO: Verificar se h√° PDFs de forma segura
        const hasPdfs = property.pdfs && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined' &&
                       property.pdfs.trim() !== '';
        
        console.log('üìÑ Editando im√≥vel - Tem PDFs?', hasPdfs, 'PDFs:', property.pdfs);
        
        if (hasPdfs) {
            const existingPdfs = property.pdfs.split(',').filter(url => url.trim() !== '');
            
            // CORRE√á√ÉO: Criar uma √°rea separada para PDFs existentes
            pdfPreview.innerHTML = '<div id="existingPdfsSection">';
            pdfPreview.innerHTML += '<p style="color: var(--success); margin-bottom: 1rem;">üìÑ Documentos atuais do im√≥vel (clique no X para excluir):</p>';
            
            const existingPdfContainer = document.createElement('div');
            existingPdfContainer.style.display = 'flex';
            existingPdfContainer.style.gap = '10px';
            existingPdfContainer.style.flexWrap = 'wrap';
            existingPdfContainer.style.marginBottom = '1.5rem';
            
            existingPdfs.forEach((pdfUrl, index) => {
                // Extrair nome do arquivo da URL
                const fileName = pdfUrl.split('/').pop() || `Documento ${index + 1}`;
                
                const pdfContainer = document.createElement('div');
                pdfContainer.className = 'image-preview-container';
                pdfContainer.innerHTML = `
                    <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                        <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                        <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${fileName}</p>
                    </div>
                    <button class="delete-image-btn" onclick="deleteExistingPdf(${property.id}, ${index})" 
                            title="Excluir este documento">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Doc ${index + 1}</div>
                `;
                existingPdfContainer.appendChild(pdfContainer);
            });
            
            pdfPreview.appendChild(existingPdfContainer);
            pdfPreview.innerHTML += '</div>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novos PDFs
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
            
            // Armazenar URLs dos PDFs existentes para refer√™ncia futura
            property.existingPdfUrls = existingPdfs;
            
        } else {
            pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum documento PDF cadastrado</p>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novos PDFs mesmo quando n√£o h√° existentes
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #3498db; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
        }
    }
    
    // ========== CORRE√á√ÉO CR√çTICA: REATIVAR UPLOAD DE FOTOS ==========
    setTimeout(() => {
        console.log('üîÑ REATIVANDO UPLOAD DE FOTOS para edi√ß√£o...');
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        if (uploadArea && fileInput) {
            console.log('‚úÖ Elementos de upload encontrados');
            
            // 1. CLONAR E SUBSTITUIR OS ELEMENTOS (remove listeners antigos)
            const newUploadArea = uploadArea.cloneNode(true);
            const newFileInput = fileInput.cloneNode(true);
            
            // Substituir no DOM
            uploadArea.parentNode.replaceChild(newUploadArea, uploadArea);
            fileInput.parentNode.replaceChild(newFileInput, fileInput);
            
            // 2. OBTER NOVAS REFER√äNCIAS
            const updatedUploadArea = document.getElementById('uploadArea');
            const updatedFileInput = document.getElementById('fileInput');
            
            if (updatedUploadArea && updatedFileInput) {
                console.log('‚úÖ Elementos clonados com sucesso');
                
                // 3. REAPLICAR OS EVENT LISTENERS
                
                // Drag over
                updatedUploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = 'var(--primary)';
                    this.style.background = '#f0f8ff';
                    console.log('üì∏ Drag over ativo (edi√ß√£o)');
                });

                // Drag leave
                updatedUploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = '#ddd';
                    this.style.background = '';
                });

                // Drop
                updatedUploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.style.borderColor = '#ddd';
                    this.style.background = '';
                    
                    if (e.dataTransfer.files.length > 0) {
                        console.log('üì∏ Arquivos arrastados na edi√ß√£o:', e.dataTransfer.files.length);
                        handleFiles(e.dataTransfer.files);
                    }
                });

                // Click para selecionar
                updatedUploadArea.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üì∏ Click na √°rea de upload (edi√ß√£o)');
                    updatedFileInput.click();
                });

                // Mudan√ßa no input
                updatedFileInput.addEventListener('change', function(e) {
                    console.log('üì∏ Input file alterado (edi√ß√£o):', e.target.files.length);
                    if (e.target.files.length > 0) {
                        handleFiles(e.target.files);
                    }
                });

                // Prevenir comportamento padr√£o
                updatedFileInput.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
                
                // 4. GARANTIR QUE EST√Å CLIC√ÅVEL E VIS√çVEL
                updatedUploadArea.style.cursor = 'pointer';
                updatedUploadArea.style.pointerEvents = 'auto';
                updatedUploadArea.style.opacity = '1';
                
                // 5. ADICIONAR FEEDBACK VISUAL
                updatedUploadArea.addEventListener('mouseenter', function() {
                    this.style.borderColor = 'var(--primary)';
                    this.style.boxShadow = '0 0 10px rgba(52, 152, 219, 0.3)';
                });
                
                updatedUploadArea.addEventListener('mouseleave', function() {
                    this.style.borderColor = '#ddd';
                    this.style.boxShadow = 'none';
                });
                
                console.log('‚úÖ Upload de fotos REATIVADO para edi√ß√£o - PRONTO PARA USO!');
            }
        } else {
            console.error('‚ùå Elementos de upload n√£o encontrados ap√≥s edi√ß√£o');
        }
        
        // TAMB√âM REATIVAR UPLOAD DE PDFs
        console.log('üîÑ Reativando upload de PDFs...');
        const pdfUploadArea = document.getElementById('pdfUploadArea');
        const pdfFileInput = document.getElementById('pdfFileInput');
        
        if (pdfUploadArea && pdfFileInput) {
            pdfUploadArea.style.cursor = 'pointer';
            pdfUploadArea.style.pointerEvents = 'auto';
            console.log('‚úÖ Upload de PDFs reativado');
        }
        
    }, 500); // Esperar 500ms para o DOM atualizar completamente
    
    // Rolar at√© o formul√°rio
    document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
    
    alert("Im√≥vel carregado para edi√ß√£o! Modifique os campos e clique em 'Atualizar Im√≥vel' para salvar.");
}
        
// ========== EXCLUIR FOTO EXISTENTE DO IM√ìVEL ==========
async function deleteExistingImage(propertyId, imageIndex) {
    if (!confirm('Tem certeza que deseja excluir esta foto? Esta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.images) return;

    try {
        // Separar as URLs das imagens
        const imageUrls = property.images.split(',').filter(url => url.trim() !== '');
        
        // Remover a imagem selecionada
        if (imageIndex >= 0 && imageIndex < imageUrls.length) {
            const imageToDelete = imageUrls[imageIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = imageToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('‚úÖ Imagem exclu√≠da do Supabase Storage:', fileName);
                    } else {
                        console.log('‚ö†Ô∏è N√£o foi poss√≠vel excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('‚ö†Ô∏è Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            imageUrls.splice(imageIndex, 1);
            
            // Atualizar a propriedade
            property.images = imageUrls.length > 0 ? imageUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ images: property.images })
            });

            if (response.ok) {
                console.log('‚úÖ Imagem exclu√≠da com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualiza√ß√£o
                editProperty(propertyId);
                alert('‚úÖ Foto exclu√≠da com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro ao excluir imagem:', error);
        alert('‚ùå Erro ao excluir a foto. Tente novamente.');
    }
}

// ========== FUN√á√ÉO PARA DELETAR IM√ìVEL ==========
function deleteProperty(id) {
    if (!confirm('Tem certeza que deseja excluir este im√≥vel? Esta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }

    try {
        // Remover do array local
        const index = properties.findIndex(p => p.id === id);
        if (index !== -1) {
            properties.splice(index, 1);
            
            // Atualizar localStorage
            localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
            
            // Atualizar Supabase
            fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${id}`, {
                method: 'DELETE',
                headers: {
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`
                }
            }).then(response => {
                if (response.ok) {
                    console.log('‚úÖ Im√≥vel exclu√≠do do Supabase');
                }
            }).catch(error => {
                console.log('‚ö†Ô∏è Erro ao excluir do Supabase, mas continuando...', error);
            });
            
            // Recarregar a lista
            loadPropertyList();
            renderProperties();
            
            alert('‚úÖ Im√≥vel exclu√≠do com sucesso!');
        }
    } catch (error) {
        console.error('‚ùå Erro ao excluir im√≥vel:', error);
        alert('‚ùå Erro ao excluir o im√≥vel. Tente novamente.');
    }
}
        
// ========== FUN√á√ÉO AUXILIAR PARA EXCLUIR DO STORAGE ==========
async function deleteFromStorage(imageUrl) {
    try {
        // Extrair o nome do arquivo da URL
        const fileName = imageUrl.split('/').pop();
        if (!fileName || fileName === 'EMPTY') return false;

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                }
            }
        );

        return response.ok;
    } catch (error) {
        console.error('‚ùå Erro ao excluir do storage:', error);
        return false;
    }
}
// ========== FUN√á√ÉO setupUploadSystem() CORRIGIDA ==========
// ========== SISTEMA DE UPLOAD ROBUSTO - COMPAT√çVEL COM PROBLEMAS LOCAIS ==========
function setupUploadSystem() {
    console.log('üîß Configurando sistema de upload ROBUSTO...');
    
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');

    if (!uploadArea || !fileInput) {
        console.error('‚ùå Elementos de upload n√£o encontrados!');
        return;
    }

    // ESTRAT√âGIA 1: M√öLTIPLOS M√âTODOS DE CLICK (defesa em profundidade)
    const setupClickMethods = () => {
        console.log('üõ°Ô∏è Configurando m√∫ltiplos m√©todos de click...');
        
        // M√©todo A: onclick tradicional
        uploadArea.onclick = function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('üéØ M√©todo A (onclick) acionado');
            fileInput.click();
        };
        
        // M√©todo B: addEventListener
        uploadArea.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('üéØ M√©todo B (addEventListener) acionado');
            fileInput.click();
        }, true); // true = useCapture phase
        
        // M√©todo C: mousedown (para browsers problem√°ticos)
        uploadArea.addEventListener('mousedown', function(e) {
            if (e.button === 0) { // Bot√£o esquerdo
                console.log('üéØ M√©todo C (mousedown) acionado');
                setTimeout(() => fileInput.click(), 10);
            }
        });
        
        // M√©todo D: touch para dispositivos touch
        uploadArea.addEventListener('touchstart', function(e) {
            e.preventDefault();
            console.log('üéØ M√©todo D (touch) acionado');
            fileInput.click();
        });
        
        console.log('‚úÖ 4 m√©todos de click configurados');
    };

    // ESTRAT√âGIA 2: SISTEMA DE FALLBACK AUTOM√ÅTICO
    let clickAttempts = 0;
    const maxAttempts = 3;
    
    const setupFallbackSystem = () => {
        console.log('üîÑ Configurando sistema de fallback...');
        
        // Monitorar se o click est√° funcionando
        const checkClickFunctionality = () => {
            clickAttempts++;
            console.log(`üìä Tentativa de click #${clickAttempts}`);
            
            if (clickAttempts >= maxAttempts) {
                console.warn('‚ö†Ô∏è M√∫ltiplas falhas de click detectadas');
                activateEmergencyMode();
            }
        };
        
        // Modo de emerg√™ncia para click persistente
        const activateEmergencyMode = () => {
            console.log('üö® ATIVANDO MODO DE EMERG√äNCIA PARA UPLOAD');
            
            // Substituir completamente a √°rea de upload
            const emergencyHTML = `
                <div id="uploadEmergency" style="
                    border: 3px solid #e74c3c; 
                    border-radius: 10px; 
                    padding: 30px; 
                    text-align: center;
                    background: #fff5f5;
                    cursor: pointer;
                    margin: 1rem 0;">
                    <i class="fas fa-exclamation-triangle" style="color: #e74c3c; font-size: 2rem;"></i>
                    <h4 style="color: #e74c3c; margin: 1rem 0;">MODO DE EMERG√äNCIA ATIVADO</h4>
                    <p style="color: #666; margin-bottom: 1rem;">
                        Clique AQUI para selecionar fotos<br>
                        <small>(Sistema detectou problemas no click normal)</small>
                    </p>
                    <button onclick="document.getElementById('fileInput').click()" 
                            style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-upload"></i> CLIQUE AQUI PARA UPLOAD
                    </button>
                </div>
            `;
            
            uploadArea.insertAdjacentHTML('afterend', emergencyHTML);
            
            // Tamb√©m adicionar click direto no bot√£o de emerg√™ncia
            document.getElementById('uploadEmergency').addEventListener('click', function() {
                console.log('üéØ CLICK DE EMERG√äNCIA FUNCIONANDO');
                fileInput.click();
            });
        };
        
        // Adicionar verifica√ß√£o em cada click
        uploadArea.addEventListener('click', checkClickFunctionality);
        console.log('‚úÖ Sistema de fallback configurado');
    };

    // ESTRAT√âGIA 3: DIAGN√ìSTICO AUTOM√ÅTICO
    const runDiagnostic = () => {
        console.log('üîç EXECUTANDO DIAGN√ìSTICO DO SISTEMA DE UPLOAD');
        
        const diagnostic = {
            userAgent: navigator.userAgent,
            isFirefox: navigator.userAgent.includes('Firefox'),
            isChrome: navigator.userAgent.includes('Chrome'),
            platform: navigator.platform,
            cookiesEnabled: navigator.cookieEnabled,
            javaScriptEnabled: true,
            // Verificar event listeners
            hasOnClick: !!uploadArea.onclick,
            hasAddEventListener: true, // Assumimos que sim
            // Verificar estilos
            cursorStyle: uploadArea.style.cursor,
            pointerEvents: uploadArea.style.pointerEvents,
            // Verificar posi√ß√£o/z-index
            position: window.getComputedStyle(uploadArea).position,
            zIndex: window.getComputedStyle(uploadArea).zIndex
        };
        
        console.table(diagnostic);
        
        // Sugest√µes baseadas no diagn√≥stico
        if (diagnostic.isFirefox) {
            console.log('üí° SUGEST√ÉO PARA FIREFOX: about:config -> dom.event.clipboardevents.enabled = true');
        }
        
        if (diagnostic.cursorStyle !== 'pointer') {
            console.log('üí° AJUSTANDO cursor para pointer');
            uploadArea.style.cursor = 'pointer';
        }
        
        console.log('‚úÖ Diagn√≥stico completo');
    };

    // ESTRAT√âGIA 4: LOG DETALHADO PARA DEBUG
    const setupDetailedLogging = () => {
        console.log('üìù Configurando logging detalhado...');
        
        // Log de todos os eventos na √°rea de upload
        const events = ['click', 'mousedown', 'mouseup', 'touchstart', 'dragenter', 'dragover', 'dragleave', 'drop'];
        
        events.forEach(eventType => {
            uploadArea.addEventListener(eventType, (e) => {
                console.log(`üñ±Ô∏è Evento "${eventType}" na uploadArea:`, {
                    type: e.type,
                    time: e.timeStamp,
                    coordinates: { x: e.clientX, y: e.clientY },
                    target: e.target.id,
                    defaultPrevented: e.defaultPrevented
                });
            });
        });
        
        // Log detalhado do change no input
        fileInput.addEventListener('change', (e) => {
            console.log('üìÅ EVENTO CHANGE NO FILE INPUT:', {
                files: e.target.files.length,
                fileNames: Array.from(e.target.files).map(f => f.name),
                fileSizes: Array.from(e.target.files).map(f => `${(f.size/1024/1024).toFixed(2)}MB`),
                timestamp: new Date().toISOString()
            });
            
            // Verificar se handleFiles ser√° chamada
            setTimeout(() => {
                if (selectedFiles.length === 0 && e.target.files.length > 0) {
                    console.warn('‚ö†Ô∏è Arquivos selecionados mas handleFiles n√£o foi chamada!');
                    console.warn('üí° For√ßando chamada de handleFiles...');
                    handleFiles(e.target.files);
                }
            }, 100);
        });
        
        console.log('‚úÖ Logging detalhado configurado');
    };

    // EXECUTAR TODAS AS ESTRAT√âGIAS
    setupClickMethods();
    setupFallbackSystem();
    runDiagnostic();
    setupDetailedLogging();
    
    // CONFIGURA√á√ÉO DRAG & DROP (j√° funciona 100%)
    setupDragAndDrop();
    
    console.log('‚úÖ Sistema de upload ROBUSTO configurado');
    console.log('üí° DICA: Se o click ainda n√£o funcionar, use Drag & Drop (funciona 100%)');
}

// Fun√ß√£o auxiliar para drag & drop
function setupDragAndDrop() {
    const uploadArea = document.getElementById('uploadArea');
    
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = 'var(--primary)';
        uploadArea.style.background = '#f0f8ff';
    });

    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '';
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        uploadArea.style.borderColor = '#ddd';
        uploadArea.style.background = '';
        
        if (e.dataTransfer.files.length > 0) {
            console.log('üì∏ Arquivos arrastados via Drag & Drop:', e.dataTransfer.files.length);
            handleFiles(e.dataTransfer.files);
        }
    });
}

// ========== SOLU√á√ÉO DEFINITIVA PARA SEU PROBLEMA LOCAL ==========
// Adicione este c√≥digo para contornar problemas espec√≠ficos da sua m√°quina

// 1. LIMPAR CACHE E RECONFIGURAR AO CARREGAR
window.addEventListener('load', function() {
    console.log('üßπ LIMPANDO CACHE DE UPLOAD AO CARREGAR...');
    
    // For√ßar reconex√£o dos event listeners
    setTimeout(() => {
        if (typeof setupUploadSystem === 'function') {
            setupUploadSystem();
        }
    }, 1000);
});

// 2. BOT√ÉO DE FOR√áA BRUTA (emerg√™ncia)

// Adicionar bot√£o de emerg√™ncia no painel admin

// Executar ap√≥s carregar

// ========== FUN√á√ÉO handleFiles() COMPLETA E CORRIGIDA ==========
function handleFiles(files) {
    console.log('üì∏ Arquivos recebidos no handleFiles:', files.length);
    
    const newFiles = Array.from(files);
    
    // Verificar se h√° arquivos v√°lidos
    const validFiles = newFiles.filter(file => 
        file.type.startsWith('image/') || file.type.startsWith('video/')
    );
    
    if (validFiles.length === 0) {
        alert('‚ö†Ô∏è Por favor, selecione apenas imagens ou v√≠deos!');
        return;
    }
    
    // Contar arquivos atuais
    const currentCount = selectedFiles.length;
    const totalAfterAdd = currentCount + validFiles.length;
    
    // Limitar a 10 arquivos no total
    if (totalAfterAdd > 10) {
        alert('‚ö†Ô∏è M√°ximo de 10 arquivos permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (5MB max)
    for (const file of validFiles) {
        if (file.size > 5 * 1024 * 1024) {
            alert(`‚ö†Ô∏è O arquivo "${file.name}" √© muito grande! M√°ximo: 5MB`);
            return;
        }
    }
    
    // Adicionar arquivos √† lista
    validFiles.forEach(file => {
        selectedFiles.push(file);
    });
    
    console.log('üì∏ Total de arquivos selecionados:', selectedFiles.length);
    
    // ‚úÖ CORRE√á√ÉO CR√çTICA: Chamar showNewImagePreview() para mostrar as fotos
    setTimeout(() => {
        console.log('üîÑ Chamando showNewImagePreview()...');
        if (typeof showNewImagePreview === 'function') {
            showNewImagePreview();
            console.log('‚úÖ showNewImagePreview() executada com sucesso');
        } else {
            console.error('‚ùå showNewImagePreview() n√£o √© uma fun√ß√£o!');
            // Fallback: usar showPreview() se existir
            if (typeof showPreview === 'function') {
                showPreview();
            }
        }
    }, 100);
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedFiles.forEach(file => dataTransfer.items.add(file));
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        fileInput.files = dataTransfer.files;
        console.log('üì∏ Input file atualizado');
    }
}
        
// ========== UPLOAD PARA SUPABASE ==========
async function uploadFile(file) {
    try {
        console.log('üì§ Iniciando upload:', file.name);
        
        const fileName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );

        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro no upload:', errorText);
            throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        
        // URL CORRETA para acesso p√∫blico
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('‚úÖ Upload conclu√≠do:', publicUrl);
        return publicUrl;
        
    } catch (error) {
        console.error('‚ùå Erro cr√≠tico no upload:', error);
        return null;
    }
}

// ========== FUN√á√ÉO cancelEdit() COMPLETA E CORRIGIDA ==========
function cancelEdit() {
    console.log('‚ùå Cancelando edi√ß√£o...');
    
    editingPropertyId = null;
    
    // 1. LIMPAR FORMUL√ÅRIO COMPLETAMENTE
    const form = document.getElementById('propertyForm');
    if (form) {
        form.reset(); // Isso limpa inputs, textareas, selects
        
        // Limpar manualmente campos que form.reset() n√£o limpa completamente
        document.getElementById('propTitle').value = '';
        document.getElementById('propPrice').value = '';
        document.getElementById('propLocation').value = '';
        document.getElementById('propDescription').value = ''; // CORRE√á√ÉO CR√çTICA
        document.getElementById('propFeatures').value = '';
        document.getElementById('propType').selectedIndex = 0;
        document.getElementById('propBadge').selectedIndex = 0;
        document.getElementById('propHasVideo').checked = false;
    }
    
    // 2. ATUALIZAR T√çTULO
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Adicionar Novo Im√≥vel';
    }
    
    // 3. ATUALIZAR BOT√ÉO
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site';
    }
    
    // 4. ESCONDER BOT√ÉO CANCELAR
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'none';
    }
    
    // 5. LIMPAR ARQUIVOS SELECIONADOS
    selectedFiles = [];
    selectedPdfFiles = [];
    
    // 6. LIMPAR PREVIEWS DE IMAGENS
    const preview = document.getElementById('uploadPreview');
    if (preview) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
    }
    
    // 7. LIMPAR PREVIEWS DE PDFs
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
    }
    
    // 8. LIMPAR INPUTS DE ARQUIVO
    const fileInput = document.getElementById('fileInput');
    if (fileInput) {
        fileInput.value = '';
    }
    
    const pdfFileInput = document.getElementById('pdfFileInput');
    if (pdfFileInput) {
        pdfFileInput.value = '';
    }
    
    // 9. RECONFIGURAR SISTEMAS DE UPLOAD
    setTimeout(() => {
        setupUploadSystem(); // Reconfigurar click
        setupPdfUploadSystem(); // Reconfigurar PDFs
    }, 100);
    
    console.log('‚úÖ Edi√ß√£o cancelada - Formul√°rio completamente limpo');
}

// ========== FUN√á√ÉO resetPdfUploadSystem() ==========
function resetPdfUploadSystem() {
    console.log('üîÑ Resetando sistema de upload de PDFs...');
    
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
    }
    
    const pdfFileInput = document.getElementById('pdfFileInput');
    if (pdfFileInput) {
        pdfFileInput.value = '';
    }
    
    console.log('‚úÖ Sistema de PDFs resetado');
}
        
// ========== CORRE√á√ÉO DA FUN√á√ÉO SALVAR PROPRIEDADE PARA IMAGENS ==========
async function saveProperty(propertyData) {
    try {
        console.log('üíæ Iniciando processo de salvamento...');
        console.log('üìã Dados do im√≥vel:', propertyData);
        console.log('üì∏ NOVAS Imagens selecionadas:', selectedFiles.length);
        console.log('üìÑ NOVOS PDFs selecionados:', selectedPdfFiles.length);

        const dataToSave = {
            title: propertyData.title,
            price: propertyData.price,
            location: propertyData.location,
            description: propertyData.description,
            features: Array.isArray(propertyData.features) ? propertyData.features.join(', ') : propertyData.features,
            type: propertyData.type,
            has_video: propertyData.has_video,
            badge: propertyData.badge,
            rural: propertyData.rural,
            created_at: propertyData.created_at || new Date().toISOString()
        };

        // Garantir que o campo pdfs existe antes de continuar
        await ensurePdfFieldExists();

        // CORRE√á√ÉO: Upload das NOVAS imagens se houver
        if (selectedFiles.length > 0) {
            console.log(`üì∏ Fazendo upload de ${selectedFiles.length} NOVAS imagens...`);
            let uploadedFiles = [];
            
            for (const file of selectedFiles) {
                console.log(`‚¨ÜÔ∏è Enviando NOVA imagem/v√≠deo: ${file.name}`);
                const fileUrl = await uploadFile(file);
                if (fileUrl) {
                    uploadedFiles.push(fileUrl);
                    console.log(`‚úÖ NOVA imagem/v√≠deo enviada: ${fileUrl}`);
                } else {
                   console.log(`‚ùå Falha no upload do NOVO arquivo: ${file.name}`);
                }
            }
            
            if (uploadedFiles.length > 0) {
                // CORRE√á√ÉO: Combinar imagens existentes com novas
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.images && existingProperty.images !== 'EMPTY') {
                    const existingImages = existingProperty.images.split(',').filter(img => img.trim() !== '');
                    dataToSave.images = [...existingImages, ...uploadedFiles].join(', ');
                    console.log('üñºÔ∏è Imagens combinadas (existentes + novas):', dataToSave.images);
                    console.log('üî¢ Total de imagens:', existingImages.length + uploadedFiles.length);
                } else {
                    dataToSave.images = uploadedFiles.join(', ');
                    console.log('üñºÔ∏è Apenas NOVAS imagens:', dataToSave.images);
                    console.log('üî¢ N√∫mero de NOVAS imagens:', uploadedFiles.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter imagens existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.images) {
                dataToSave.images = existingProperty.images;
                console.log('üîÑ Mantendo imagens existentes:', dataToSave.images);
            } else {
                dataToSave.images = '';
                console.log('üîÑ Campo images ser√° vazio');
            }
        }

        // CORRE√á√ÉO: Upload dos NOVOS PDFs se houver
        if (selectedPdfFiles.length > 0) {
            console.log(`üìÑ Fazendo upload de ${selectedPdfFiles.length} NOVOS PDFs...`);
            let uploadedPdfs = [];
            
            for (const file of selectedPdfFiles) {
                console.log(`‚¨ÜÔ∏è Enviando NOVO PDF: ${file.name}`);
                console.log(`üìä Tamanho do NOVO PDF: ${(file.size / 1024).toFixed(2)} KB`);
                
                const fileUrl = await uploadPdfFile(file);
                if (fileUrl) {
                    uploadedPdfs.push(fileUrl);
                    console.log(`‚úÖ NOVO PDF enviado com sucesso: ${fileUrl}`);
                } else {
                    console.log(`‚ùå Falha cr√≠tica no upload do NOVO PDF: ${file.name}`);
                }
            }
            
            if (uploadedPdfs.length > 0) {
                // CORRE√á√ÉO: Combinar PDFs existentes com novos
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                    const existingPdfs = existingProperty.pdfs.split(',').filter(url => url.trim() !== '');
                    dataToSave.pdfs = [...existingPdfs, ...uploadedPdfs].join(', ');
                    console.log('üìÑ PDFs combinados (existentes + novos):', dataToSave.pdfs);
                    console.log('üî¢ Total de PDFs:', existingPdfs.length + uploadedPdfs.length);
                } else {
                    dataToSave.pdfs = uploadedPdfs.join(', ');
                    console.log('üìÑ Apenas NOVOS PDFs:', dataToSave.pdfs);
                    console.log('üî¢ N√∫mero de NOVOS PDFs:', uploadedPdfs.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter PDFs existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                dataToSave.pdfs = existingProperty.pdfs;
                console.log('üîÑ Mantendo PDFs existentes:', dataToSave.pdfs);
            } else {
                dataToSave.pdfs = '';
                console.log('üîÑ Campo pdfs ser√° vazio');
            }
        } else {
            // Garantir que pdfs seja uma string vazia se n√£o houver PDFs
            dataToSave.pdfs = '';
            console.log('üìÑ Nenhum PDF selecionado, campo ser√° vazio');
        }
        
        console.log('üì§ Dados completos para salvar no Supabase:', JSON.stringify(dataToSave, null, 2));
        
        // Determinar URL e m√©todo
        const url = editingPropertyId
            ? `${SUPABASE_URL}/rest/v1/properties?id=eq.${editingPropertyId}`
            : `${SUPABASE_URL}/rest/v1/properties`;

        const method = editingPropertyId ? 'PATCH' : 'POST';

        console.log(`üåê Fazendo requisi√ß√£o: ${method} ${url}`);

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Prefer': 'return=representation'
            },
            body: JSON.stringify(dataToSave)
        });

        console.log('üìä Status da resposta do Supabase:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro na resposta do Supabase:', errorText);
            throw new Error(`Erro ao salvar: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('‚úÖ Salvo com sucesso no Supabase:', result);
        
        // CORRE√á√ÉO: Limpar apenas os NOVOS arquivos selecionados ap√≥s salvar
        selectedFiles = [];
        selectedPdfFiles = [];
        
        // Recarregar os dados do Supabase
        await initializeProperties();
        
        // CORRE√á√ÉO: Fechar o painel de edi√ß√£o ap√≥s salvar
        cancelEdit();
        
        alert("‚úÖ Im√≥vel atualizado com sucesso!\n\nüì∏ Fotos existentes foram mantidas e novas fotos foram adicionadas.\nüìÑ PDFs existentes foram mantidos e novos PDFs foram adicionados.");
        return true;

    } catch (error) {
        console.error('‚ùå Erro cr√≠tico ao salvar no Supabase:', error);
        console.log('üîÑ Tentando salvar localmente como fallback...');
        return saveToLocalStorage(propertyData);
    }
}

// ========== FORMUL√ÅRIO CORRIGIDO ==========
function setupForm() {
    const form = document.getElementById('propertyForm');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const propertyData = {
            title: document.getElementById('propTitle').value,
            price: document.getElementById('propPrice').value,
            location: document.getElementById('propLocation').value,
            description: document.getElementById('propDescription').value,
            features: document.getElementById('propFeatures').value.split(',').map(f => f.trim()).filter(f => f !== ''),
            type: document.getElementById('propType').value,
            has_video: document.getElementById('propHasVideo').checked,
            badge: document.getElementById('propBadge').value,
            rural: document.getElementById('propType').value === 'rural',
            created_at: new Date().toISOString()
        };

        if (!propertyData.title || !propertyData.price || !propertyData.location) {
            alert('‚ùå Preencha T√≠tulo, Pre√ßo e Localiza√ß√£o!');
            return;
        }

        const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitBtn.disabled = true;

        try {
            const success = await saveProperty(propertyData);
            
            if (success) {
                alert("‚úÖ Im√≥vel salvo com sucesso!");
            } else {
                alert("‚ùå Erro ao salvar o im√≥vel!");
            }

            this.reset();
            cancelEdit();
            selectedFiles = [];
            selectedPdfFiles = [];
            showNewImagePreview();
            showNewPdfPreview();

        } catch (error) {
            alert("‚ùå Erro: " + error.message);
        } finally {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });
}
        
// ========== TESTAR CONEX√ÉO SUPABASE ==========
//REMOVIDO
// ========== TESTAR ACESSO √ÄS IMAGENS ==========
// REMOVIDO
// ========== FUN√á√ïES DE PREVIEW FALTANTES ==========
function showPreview() {
    // Esta fun√ß√£o agora √© apenas um wrapper para a nova fun√ß√£o
    console.log('üì∏ showPreview() chamada, usando showNewImagePreview()...');
    showNewImagePreview();
}

// Fun√ß√£o auxiliar para mostrar preview b√°sico (compatibilidade)
function showBasicPreview() {
    const preview = document.getElementById('uploadPreview');
    if (!preview) return;
    
    preview.innerHTML = '';
    
    if (selectedFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
        return;
    }

    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'position: relative; display: inline-block; margin: 5px;';
        
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                fileItem.innerHTML = `
                    <img src="${e.target.result}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid #ddd;">
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; line-height: 1; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">${file.name}</div>
                `;
                preview.appendChild(fileItem);
            };
            reader.readAsDataURL(file);
        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                    <i class="fas fa-video" style="font-size: 2rem; color: var(--primary);"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">√ó</button>
                </div>
            `;
            preview.appendChild(fileItem);
        }
    });
}

// Fun√ß√£o para remover arquivo (compatibilidade)
function removeFile(index) {
    console.log('üóëÔ∏è removeFile() chamado para √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja excluir este arquivo?')) {
        selectedFiles.splice(index, 1);
        console.log('üóëÔ∏è Arquivo removido. Arquivos restantes:', selectedFiles.length);
        showBasicPreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.files = dataTransfer.files;
            console.log('üì∏ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}

// ========== TESTE DE CONEX√ÉO SUPABASE DETALHADO ==========
async function testSupabaseDetailed() {
    console.log('üîç Testando conex√£o com Supabase...');
    
    try {
        // Teste 1: Acesso b√°sico
        const test1 = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=id&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        console.log('Teste 1 - Status:', test1.status, test1.ok ? '‚úÖ OK' : '‚ùå FALHOU');
        
        // Teste 2: Storage
        const test2 = await fetch(`${SUPABASE_URL}/storage/v1/bucket/properties`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        console.log('Teste 2 - Storage:', test2.status, test2.ok ? '‚úÖ OK' : '‚ùå FALHOU');
        
        // Teste 3: Ping
        const test3 = await fetch(`${SUPABASE_URL}/rest/v1/`, {
            method: 'HEAD',
            headers: {
                'apikey': SUPABASE_KEY
            }
        });
        console.log('Teste 3 - Ping:', test3.status, test3.ok ? '‚úÖ OK' : '‚ùå FALHOU');
        
        return test1.ok;
        
    } catch (error) {
        console.error('‚ùå Erro detalhado na conex√£o:', error);
        return false;
    }
}

<!-- Remover TODO o bloco DOMContentLoaded -->
<!-- Adicionar script main.js -->
<script src="js/main.js" defer></script>
<script>
    // Inicializa√ß√£o com fallback seguro
    document.addEventListener('DOMContentLoaded', async function() {
        if (typeof initializeWeberLessaSystem === 'function') {
            await initializeWeberLessaSystem();
        } else {
            // Fallback: usar inicializa√ß√£o original
            console.log('‚ö†Ô∏è Usando inicializa√ß√£o de fallback');
            
            // Inicializar propriedades se dispon√≠vel
            if (typeof initializeProperties === 'function') {
                await initializeProperties();
            }
            
            // Configurar formul√°rios
            if (typeof setupForm === 'function') {
                setupForm();
            }
            
            // Configurar upload
            if (typeof setupUploadSystem === 'function') {
                setupUploadSystem();
            }
        }
    });
        
    </script>
    <script src="js/modules/utils.js"></script>
    <script src="js/modules/properties.js"></script>
    <script src="js/modules/gallery.js"></script>
    <script>
    console.log('üîç TESTE: SUPABASE_URL existe?', typeof SUPABASE_URL);
    if (SUPABASE_URL) {
        console.log('‚úÖ SUPABASE_URL:', SUPABASE_URL);
    }
</script>
</body>
</html>
