<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBER LESSA CORRETOR & CONSULTORIA DE IM√ìVEIS - CRECI: 654/AL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #2980b9;
            --accent: #3498db;
            --gold: #f39c12;
            --green: #27ae60;
            --text: #2c3e50;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%);
            min-height: 100vh;
        }

/* ========== HEADER PREMIUM ========== */
.header {
    background: linear-gradient(135deg, #0c2d48 0%, #1a5276 100%);
    padding: 1rem 0;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #d4af37 0%, #ffd700 50%, #d4af37 100%);
}

.header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* Logo Container */
.logo-container {
    display: flex;
    align-items: center;
    gap: 25px;
}

/* Logo WL */
.logo {
    position: relative;
    width: 80px;
    height: 80px;
    background: linear-gradient(145deg, #1a5276, #0c2d48);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(212, 175, 55, 0.3);
    transition: transform 0.3s ease;
}

.logo:hover {
    transform: scale(1.05);
}

.logo-wl {
    font-family: 'Georgia', serif;
    font-size: 2.5rem;
    font-weight: bold;
    background: linear-gradient(135deg, #ffffff, #d4af37);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: 2px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.logo-badge {
    position: absolute;
    bottom: -8px;
    right: -8px;
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, #d4af37, #b8941f);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0c2d48;
    font-size: 0.9rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    border: 2px solid #ffffff;
}

/* Logo Text */
.logo-text {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.name-container {
    display: flex;
    align-items: center;
    gap: 20px;
}

.brand-name {
    display: flex;
    flex-direction: column;
    line-height: 1;
    margin: 0;
}

.first-name {
    font-family: 'Georgia', serif;
    font-size: 2.2rem;
    font-weight: bold;
    color: #ffffff;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.last-name {
    font-family: 'Georgia', serif;
    font-size: 1.8rem;
    font-weight: normal;
    color: #d4af37;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: -5px;
}

.professional-badge {
    background: rgba(212, 175, 55, 0.1);
    padding: 6px 15px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid rgba(212, 175, 55, 0.3);
    backdrop-filter: blur(10px);
}

.professional-badge i {
    color: #d4af37;
    font-size: 0.9rem;
}

.professional-badge span {
    color: #ffffff;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 1px;
}

/* Credentials Container */
.credentials-container {
    display: flex;
    align-items: center;
    gap: 25px;
    background: rgba(255, 255, 255, 0.05);
    padding: 15px 25px;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

.creci-badge {
    display: flex;
    align-items: center;
    gap: 12px;
}

.creci-badge i {
    font-size: 1.5rem;
    color: #d4af37;
    background: rgba(212, 175, 55, 0.1);
    padding: 10px;
    border-radius: 50%;
}

.creci-info {
    display: flex;
    flex-direction: column;
}

.creci-label {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.creci-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ffffff;
    font-family: 'Courier New', monospace;
    letter-spacing: 1px;
}

.divider {
    width: 1px;
    height: 40px;
    background: linear-gradient(180deg, 
        transparent 0%, 
        rgba(212, 175, 55, 0.5) 50%, 
        transparent 100%);
}

.specialty-container {
    flex: 1;
}

.specialty-badge {
    display: flex;
    align-items: center;
    gap: 15px;
}

.specialty-badge i {
    font-size: 1.8rem;
    color: #ffffff;
    background: linear-gradient(135deg, #1a5276, #2980b9);
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.specialty-text {
    display: flex;
    flex-direction: column;
}

.specialty-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #ffffff;
    margin: 0;
    letter-spacing: 0.5px;
}

.specialty-subtitle {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    margin: 0;
    font-weight: 500;
    letter-spacing: 1px;
    text-transform: uppercase;
}

/* Responsividade */
@media (max-width: 1024px) {
    .header-content {
        padding: 0 1.5rem;
    }
    
    .first-name {
        font-size: 1.8rem;
    }
    
    .last-name {
        font-size: 1.5rem;
    }
    
    .credentials-container {
        padding: 12px 20px;
        gap: 20px;
    }
    
    .creci-number {
        font-size: 1.3rem;
    }
    
    .specialty-title {
        font-size: 1.1rem;
    }
}

@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .logo-container {
        flex-direction: column;
        text-align: center;
        gap: 20px;
    }
    
    .name-container {
        flex-direction: column;
        gap: 10px;
    }
    
    .credentials-container {
        flex-direction: column;
        gap: 15px;
        padding: 20px;
    }
    
    .divider {
        width: 100%;
        height: 1px;
        background: linear-gradient(90deg, 
            transparent 0%, 
            rgba(212, 175, 55, 0.5) 50%, 
            transparent 100%);
    }
    
    .specialty-badge {
        justify-content: center;
    }
}
            
        /* Header e Navega√ß√£o */
        .header {
            background: rgba(255, 255, 255, 0.98);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .logo-text h1 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 0.2rem;
        }
        
        .logo-text p {
            color: var(--secondary);
            font-size: 1rem;
            font-weight: 500;
        }
        
        .contact-info {
            text-align: right;
        }
        
        .contact-info .phone {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.3rem;
        }
        
        .contact-info .address {
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(26, 82, 118, 0.8), rgba(41, 128, 185, 0.8)), url('https://images.unsplash.com/photo-1544984243-ec57ea16fe25?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            padding: 4rem 1rem;
        }
        
        .hero h1 {
            font-size: 2.8rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .cta-button {
            display: inline-block;
            background: var(--gold);
            color: white;
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }
        
        /* Servi√ßos Section */
        .services {
            background: white;
            padding: 4rem 1rem;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .section-title p {
            color: var(--dark);
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .service-card {
            background: var(--light);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .service-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .service-card h3 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .service-card p {
            color: var(--dark);
        }
        
        /* Im√≥veis Section */
        .properties {
            padding: 4rem 1rem;
            background: #f8f9fa;
        }
        
        .filters {
            background: white;
            padding: 1.5rem;
            margin: 0 auto 2rem;
            max-width: 1200px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .filter-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-btn {
            background: var(--light);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .property-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .property-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .property-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .rural-image {
            background: linear-gradient(45deg, var(--green), #2ecc71);
        }
        
        .property-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--gold);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .rural-badge {
            background: var(--green);
        }
        
        .property-content {
            padding: 1.5rem;
        }
        
        .property-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .property-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .property-location {
            color: #666;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .property-features {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .feature-tag {
            background: var(--accent);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .rural-tag {
            background: var(--green);
        }
        
        .contact-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .contact-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 119, 182, 0.3);
        }
        
        .video-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Sobre Section */
        .about {
            background: white;
            padding: 4rem 1rem;
        }
        
        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
            align-items: center;
        }
        
        .about-text h2 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }
        
        .about-text p {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.7;
        }
        
        .about-image {
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            height: 400px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 3rem 1rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-section h3 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--gold);
        }
        
        .footer-section p, .footer-section a {
            color: #bbb;
            margin-bottom: 0.8rem;
            display: block;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 1rem;
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .social-icon:hover {
            background: var(--accent);
            transform: translateY(-3px);
        }
        
        .copyright {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: #999;
        }
        
        /* ========== ESTILOS DO PAINEL ADMIN ========== */
        .admin-panel {
            background: #f8f9fa;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
            border-radius: 10px;
            display: none;
        }
        
        .admin-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 1.2rem;
        }
        
        .property-item {
            background: #f5f5f5;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
        }

        .pdf-access {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--primary);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .pdf-access:hover {
             background: white;
             transform: scale(1.1);
             box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .pdf-modal {
             display: none;
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0,0,0,0.8);
             z-index: 1000;
             align-items: center;
             justify-content: center;
        }

        .pdf-modal-content {
              background: white;
              padding: 2rem;
              border-radius: 10px;
              max-width: 400px;
              width: 90%;
              text-align: center;
        }

        .pdf-preview {
              margin: 1rem 0;
              padding: 1rem;
              background: #f8f9fa;
              border-radius: 5px;
        }

        .pdf-file-item {
              display: flex;
              align-items: center;
              gap: 10px;
              padding: 0.5rem;
              margin: 0.5rem 0;
              background: white;
              border-radius: 5px;
              border: 1px solid #ddd;
        }

        .pdf-password-input {
              width: 100%;
              padding: 0.8rem;
              margin: 1rem 0;
              border: 1px solid #ddd;
              border-radius: 5px;
              font-size: 1rem;
        }

       // ========== ADICIONAR CSS PARA OS ELEMENTOS DE UPLOAD ==========
        // Adicione este CSS no estilo existente
        // ========== ADICIONAR ESTILOS CSS ==========
        const additionalCSS = `
        /* ========== DIFERENCIA√á√ÉO ENTRE PDFs EXISTENTES E NOVOS ========== */
        #existingPdfsSection .image-preview-container {
            border: 2px solid var(--success);
        }
        
        #existingPdfsSection .delete-image-btn {
            background: #e74c3c;
        }
        
        #newPdfsSection .pdf-file-item {
            border: 2px dashed #3498db;
            background: #f8faff;
        }
        
        #newPdfsSection .delete-image-btn {
            background: #3498db;
        }
        
        #newPdfsSection .delete-image-btn:hover {
            background: #2980b9;
        }
        
        /* ========== SEPARA√á√ÉO VISUAL ========== */
        #existingPdfsSection {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
        }
        
        #newPdfsSection {
            margin-top: 1rem;
            padding-top: 1.5rem;
        }
        `;
        
        // Adicionar o CSS ao documento
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);`
        /* ========== CORRE√á√ÉO PARA ELEMENTOS DE UPLOAD ========== */
        #pdfUploadArea * {
            pointer-events: none;
        }
        
        #pdfUploadArea {
            pointer-events: auto;
        }
        
        .delete-image-btn {
            pointer-events: auto;
        }
        
        .image-preview-container {
            pointer-events: auto;
        }
        
        /* ========== ESTILO PARA PDF PREVIEW ========== */
        .pdf-file-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .pdf-file-item:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        `;
        
        // Adicionar o CSS ao documento
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);

        // ========== ADICIONAR ESTILOS CSS ==========
        const additionalCSS = `
        /* ========== DIFERENCIA√á√ÉO ENTRE FOTOS EXISTENTES E NOVAS ========== */
        #existingImagesSection .image-preview-container {
            border: 2px solid var(--success);
        }
        
        #existingImagesSection .delete-image-btn {
            background: #e74c3c;
        }
        
        #newImagesSection .image-preview-container {
            border: 2px dashed #3498db;
        }
        
        #newImagesSection .delete-image-btn {
            background: #3498db;
        }
        
        #newImagesSection .delete-image-btn:hover {
            background: #2980b9;
        }
        
        /* ========== DIFERENCIA√á√ÉO ENTRE PDFs EXISTENTES E NOVOS ========== */
        #existingPdfsSection .image-preview-container {
            border: 2px solid var(--success);
        }
        
        #existingPdfsSection .delete-image-btn {
            background: #e74c3c;
        }
        
        #newPdfsSection .pdf-file-item {
            border: 2px dashed #3498db;
            background: #f8faff;
        }
        
        #newPdfsSection .delete-image-btn {
            background: #3498db;
        }
        
        #newPdfsSection .delete-image-btn:hover {
            background: #2980b9;
        }
        
        /* ========== SEPARA√á√ÉO VISUAL ========== */
        #existingImagesSection {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
        }
        
        #newImagesSection {
            margin-top: 1rem;
            padding-top: 1.5rem;
        }
        
        #existingPdfsSection {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
        }
        
        #newPdfsSection {
            margin-top: 1rem;
            padding-top: 1.5rem;
        }
        
        /* ========== MELHOR VISUALIZA√á√ÉO DOS CONTAINERS ========== */
        #existingImagesSection > div,
        #newImagesSection > div,
        #existingPdfsSection > div,
        #newPdfsSection > div {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        `;
        
        // Adicionar o CSS ao documento
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);
        
        /* ========== NOVOS ESTILOS PARA EXCLUS√ÉO DE FOTOS ========== */
        .image-preview-container {
            position: relative;
            display: inline-block;
            margin: 5px;
        }
        
        .delete-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .delete-image-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .image-count {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .about-content {
                grid-template-columns: 1fr;
            }
            
            .property-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                flex-direction: column;
                align-items: center;
            }
            
            .filter-btn {
                width: 100%;
                max-width: 250px;
            }
            
            .property-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
         }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <!-- Logo WL com design premium -->
                <div class="logo">
                    <span class="logo-wl">WL</span>
                    <div class="logo-badge">
                        <i class="fas fa-key"></i>
                    </div>
                </div>
                
                <!-- Texto da marca com hierarquia profissional -->
                <div class="logo-text">
                    <div class="name-container">
                        <h1 class="brand-name">
                            <span class="first-name">WEBER</span>
                            <span class="last-name">LESSA</span>
                        </h1>
                        <div class="professional-badge">
                            <i class="fas fa-award"></i>
                            <span>CRECI CERTIFICADO</span>
                        </div>
                    </div>
                    
                    <div class="credentials-container">
                        <div class="creci-badge">
                            <i class="fas fa-shield-alt"></i>
                            <div class="creci-info">
                                <span class="creci-label">CRECI</span>
                                <span class="creci-number">654/AL</span>
                            </div>
                        </div>
                     </div>
               </div>
            <div class="contact-info">
                <div class="phone">
                   <i class="fas fa-phone"></i> (82) 9.9604-4513<!-- class="social-icons"><a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></p> -->
                </div>
                <div class="address">
                    <i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa
                    <div 
                    </i> Pra√ßa S√£o Vicente, 09
                    </div>    
                    <div 
                    </i> Centro, Macei√≥-AL
                    </div>    
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Encontre seu im√≥vel dos sonhos em Macei√≥</h1>
        <p>Na orla mais bonita do Brasil, com a expertise de quem entende do mercado imobili√°rio alagoano</p>
        <a href="#properties" class="cta-button">
            <i class="fas fa-home"></i> Ver Im√≥veis
        </a>
    </section>

    <!-- Servi√ßos Section -->
    <section class="services">
        <div class="section-title">
            <h2>Nossos Servi√ßos Especializados</h2>
            <p>Oferecemos solu√ß√µes completas para suas necessidades imobili√°rias</p>
        </div>
        <div class="services-grid">
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-users"></i>
                </div>
                <h3>Equipe de Corretagem</h3>
                <p>Venda de lotes, im√≥veis residenciais, comerciais, s√≠tios, incorpora√ß√µes, consultoria, avalia√ß√£o de im√≥veis, ch√°caras e fazendas com equipe qualificada.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-building"></i>
                </div>
                <h3>Incorpora√ß√£o Imobili√°ria</h3>
                <p>Desenvolvemos empreendimentos de alto padr√£o com qualidade e inova√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Financiamento Facilitado</h3>
                <p>Linhas banc√°rias com boleto facilitado e condi√ß√µes especiais para sua aquisi√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-gavel"></i>
                </div>
                <h3>Regulariza√ß√£o de Im√≥veis</h3>
                <p>Usucapi√£o, heran√ßa, invent√°rio e toda documenta√ß√£o necess√°ria para regulariza√ß√£o.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-heart"></i>
                </div>
                <h3>Minha Casa Minha Vida</h3>
                <p>Acesso facilitado ao programa governamental para realiza√ß√£o do sonho da casa pr√≥pria.</p>
            </div>
            <div class="service-card">
                <div class="service-icon">
                    <i class="fas fa-tractor"></i>
                </div>
                <h3>Propriedades Rurais</h3>
                <p>Especialistas em s√≠tios, ch√°caras e fazendas com documenta√ß√£o completa e regularizada.</p>
            </div>
        </div>
    </section>

    <!-- Im√≥veis Section -->
    <section class="properties" id="properties">
        <div class="section-title">
            <h2>Im√≥veis em Destaque</h2>
            <p>Confira nossas melhores oportunidades em Macei√≥ e regi√£o</p>
        </div>
        
        <div class="filters">
            <h3>Filtrar por:</h3>
            <div class="filter-options">
                <button class="filter-btn active">Todos</button>
                <button class="filter-btn">Residencial</button>
                <button class="filter-btn">Comercial</button>
                <button class="filter-btn">Rural</button>
                <button class="filter-btn">Minha Casa Minha Vida</button>
            </div>
        </div>
        
        <div class="property-grid" id="properties-container">
            <!-- Os im√≥veis ser√£o carregados aqui via JavaScript -->
        </div>
    </section>

    <!-- Sobre Section -->
    <section class="about">
        <div class="about-content">
            <div class="about-text">
                <h2>Sobre a Weber Lessa</h2>
                <p>Com mais de 30 anos de experi√™ncia no mercado imobili√°rio de Macei√≥, com forma√ß√£o Jur√≠dica e especializa√ß√£o em Direito Imobili√°rio a empresa Weber Lessa Corretor & Consultor - CRECI: 654/AL, se consolidou como refer√™ncia em solu√ß√µes imobili√°rias completas e personalizadas.</p>
                <p>Nossa equipe especializada atua em todas as fases do processo: desde a assessoria na compra e venda, passando pela regulariza√ß√£o documental, at√© o financiamento e incorpora√ß√£o de empreendimentos.</p>
                <p>Localizada no Empresarial Sizi & Neusa, no cora√ß√£o de Macei√≥, estamos prontos para ajudar voc√™ a realizar o sonho do im√≥vel pr√≥prio com seguran√ßa, transpar√™ncia e expertise.</p>
            </div>
            <div class="about-image">
                <div>
                    <i class="fas fa-building"></i>
                    <p>Empresarial Sizi & Neusa</p>
                    <p>Sede Weber Lessa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Weber Lessa</h3>
                <p>Correto & Consultor com tradi√ß√£o e qualidade no mercado imobili√°rio de Macei√≥ desde 1995.</p>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contato</h3>
                <p><i class="fas fa-phone"></i> (82) 9.9604-4513</p>
                <p><i class="fas fa-map-marker-alt"></i> Empresarial Sizi & Neusa</p>
                <p>Pra√ßa S√£o Vicente, 09 - Centro</p>
                <p>Macei√≥ - AL, 57020-420</p>
                <p><i class="fas fa-clock"></i> Segunda a Sexta: 8h √†s 18h</p>
            </div>
            <div class="footer-section">
                <h3>Links R√°pidos</h3>
                <a href="#properties">Im√≥veis</a>
                <a href="#services">Servi√ßos</a>
                <a href="#about">Sobre N√≥s</a>
                <a href="#contact">Contato</a>
            </div>
            <div class="footer-section">
                <h3>Especialidades</h3>
                <a href="#">Venda de Im√≥veis</a>
                <a href="#">Aluguel de Im√≥veis</a>
                <a href="#">Propriedades Rurais</a>
                <a href="#">Incorpora√ß√£o</a>
                <a href="#">Financiamento</a>
                <a href="#">Regulariza√ß√£o</a>
                <a href="#">Minha Casa Minha Vida</a>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2025 Weber Lessa Corretor & Consultor - CRECI: 654/AL. Todos os direitos reservados.</p>
        </div>
    </footer>

<!-- ========== PAINEL DE ADMINISTRA√á√ÉO ATUALIZADO ========== -->
<section class="admin-panel" id="adminPanel">
    <h3 style="text-align: center; color: var(--primary); margin-bottom: 1.5rem;">
        <i class="fas fa-cog"></i> Painel do Corretor - Weber Lessa
    </h3>
    
    <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <h4 id="formTitle">Adicionar Novo Im√≥vel</h4>
        <form id="propertyForm">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>T√≠tulo do Im√≥vel *</strong></label>
                    <input type="text" id="propTitle" placeholder="Ex: Apartamento Vista Mar" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
                <div>
                    <label><strong>Pre√ßo *</strong></label>
                    <input type="text" id="propPrice" placeholder="Ex: R$ 450.000" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Localiza√ß√£o *</strong></label>
                <input type="text" id="propLocation" placeholder="Ex: Ponta Verde, Macei√≥-AL" required style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Descri√ß√£o</strong></label>
                <textarea id="propDescription" placeholder="Descreva o im√≥vel..." style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%; height: 100px;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label><strong>Caracter√≠sticas (separadas por v√≠rgula)</strong></label>
                <input type="text" id="propFeatures" placeholder="Ex: 2 Quartos, 1 Vaga, Piscina, Varanda" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                <small style="color: #666;">Separe por v√≠rgulas</small>
            </div>

            <!-- ========== SE√á√ÉO UPLOAD DE PDFs ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Documentos PDF do Im√≥vel</strong></label>
                
                <div id="pdfUploadArea" style="border: 2px dashed #95a5a6; border-radius: 10px; padding: 1.5rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-file-pdf" style="font-size: 2rem; color: #95a5a6; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1rem; color: #555;">Clique ou arraste documentos PDF aqui</p>
                    <p style="margin: 0; font-size: 0.8rem; color: #888;">
                        <i class="fas fa-file-pdf"></i> Documentos t√©cnicos e legais
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; color: #999;">M√°ximo: 5 arquivos ‚Ä¢ 10MB cada</p>
                </div>
                
                <input type="file" id="pdfFileInput" multiple accept=".pdf,application/pdf" style="display: none;">
                
                <div id="pdfUploadPreview" style="margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <!-- ========== SE√á√ÉO UPLOAD DE FOTOS/VIDEOS ========== -->
            <div style="margin-bottom: 1.5rem;">
                <label><strong>Fotos e V√≠deos do Im√≥vel</strong></label>
                
                <div id="uploadArea" style="border: 2px dashed #ddd; border-radius: 10px; padding: 2rem; text-align: center; margin: 1rem 0; cursor: pointer; transition: all 0.3s ease; background: #fafafa;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2.5rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p style="margin: 0.5rem 0; font-size: 1.1rem; color: #555;">Clique ou arraste fotos e v√≠deos aqui</p>
                    <p style="margin: 0; font-size: 0.9rem; color: #888;">
                        <i class="fas fa-image"></i> Fotos (JPG, PNG) ‚Ä¢ 
                        <i class="fas fa-video"></i> V√≠deos (MP4)
                    </p>
                    <p style="margin: 0.5rem 0 0; font-size: 0.8rem; color: #999;">M√°ximo: 10 arquivos ‚Ä¢ 5MB cada</p>
                </div>
                
                <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                
                <div id="uploadPreview" style="display: flex; gap: 10px; flex-wrap: wrap; margin: 1rem 0; min-height: 60px;"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                <div>
                    <label><strong>Tipo do Im√≥vel</strong></label>
                    <select id="propType" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="residencial">Residencial</option>
                        <option value="comercial">Comercial</option>
                        <option value="rural">Rural</option>
                    </select>
                </div>
                <div>
                    <label><strong>Destaque</strong></label>
                    <select id="propBadge" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                        <option value="Novo">Novo</option>
                        <option value="Destaque">Destaque</option>
                        <option value="Luxo">Luxo</option>
                        <option value="MCMV">Minha Casa Minha Vida</option>
                        <option value="Fazenda">Fazenda</option>
                        <option value="Ch√°cara">Ch√°cara</option>
                    </select>
                </div>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem;">
                    <input type="checkbox" id="propHasVideo"> 
                    <span><strong>Este im√≥vel tem v√≠deo?</strong></span>
                </label>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <button type="submit" style="background: var(--success); color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; flex: 1; font-size: 1.1rem;">
                    <i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site
                </button>
                <button type="button" id="cancelEditBtn" onclick="cancelEdit()" style="background: #95a5a6; color: white; padding: 1rem 2rem; border: none; border-radius: 5px; cursor: pointer; display: none;">
                    <i class="fas fa-times"></i> Cancelar Edi√ß√£o
                </button>
            </div>
        </form>
        
        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
            <h4>Gerenciar Im√≥veis Existentes</h4>
            <p><small>Total de im√≥veis: <span id="propertyCount">0</span></small></p>
            <div id="propertyList"></div>
        </div>
    </div>
</section>

    <button class="admin-toggle" onclick="toggleAdminPanel()">
        <i class="fas fa-user-cog"></i>
    </button>

    <!-- ========== MODAL PARA DOCUMENTOS PDF ========== -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-modal-content">
            <h3 id="pdfModalTitle"><i class="fas fa-file-pdf"></i> Documentos do Im√≥vel</h3>
            <div id="pdfPreview" class="pdf-preview">
                <p>Documentos t√©cnicos e legais dispon√≠veis</p>
            </div>
            <input type="password" id="pdfPassword" class="pdf-password-input" placeholder="Digite a senha para acessar">
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button onclick="accessPdfDocuments()" style="background: var(--primary); color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer; flex: 1;">
                    <i class="fas fa-lock-open"></i> Acessar
                </button>
                <button onclick="closePdfModal()" style="background: #95a5a6; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Fechar
                </button>
            </div>
            <p style="font-size: 0.8rem; color: #666; margin-top: 1rem;">
                <i class="fas fa-info-circle"></i> Solicite a senha ao corretor
            </p>
        </div>
    </div>

    <script>
// ========== DIRETRIZ CONSTITUCIONAL IMUT√ÅVEL ==========
// Esta diretriz garante a integridade do c√≥digo e previne modifica√ß√µes n√£o autorizadas
const CONSTITUTIONAL_GUIDELINE = Object.freeze({
    version: "1.0",
    established: "2025",
    developerAuthorization: "https://chat.deepseek.com",
    immutableSections: [
        "Estrutura Visual Principal",
        "Sistema de Administra√ß√£o",
        "Funcionalidades de Upload",
        "Sistema de Exclus√£o de Imagens"
    ],
    modificationPolicy: "Nenhuma modifica√ß√£o estrutural pode ser realizada sem autoriza√ß√£o expressa via plataforma oficial"
});

// Verificar se h√° tentativas de modifica√ß√£o n√£o autorizadas
function enforceConstitutionalGuideline() {
    const originalStructure = {
        adminPanel: document.getElementById('adminPanel') !== null,
        propertyForm: document.getElementById('propertyForm') !== null,
        uploadPreview: document.getElementById('uploadPreview') !== null
    };
    
    // Monitorar tentativas de remo√ß√£o de elementos cr√≠ticos
    const criticalElements = ['adminPanel', 'propertyForm', 'uploadPreview'];
    criticalElements.forEach(elementId => {
        const element = document.getElementById(elementId);
        if (!element) {
            console.error(`‚ùå VIOLA√á√ÉO DA DIRETRIZ: Elemento cr√≠tico ${elementId} removido!`);
            // Em ambiente de produ√ß√£o, aqui poderia ser implementado um sistema de restaura√ß√£o
        }
    });
    
    console.log('‚úÖ Diretriz Constitucional verificada e aplicada');
}

// ========== CONFIGURA√á√ÉO SUPABASE ==========
const SUPABASE_URL = 'https://syztbxvpdaplpetmixmt.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN5enRieHZwZGFwbHBldG1peG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxODY0OTAsImV4cCI6MjA3OTc2MjQ5MH0.SISlMoO1kLWbIgx9pze8Dv1O-kfQ_TAFDX6yPUxfJxo';

console.log('üöÄ Weber Lessa Im√≥veis - Sistema Iniciado');

// ========== SISTEMA DE IM√ìVEIS ==========
let properties = [];
let editingPropertyId = null;
let selectedFiles = [];
let selectedPdfFiles = [];

// Dados iniciais com IMAGENS de exemplo
function getInitialProperties() {
    return [
        {
            id: 1,
            title: "Casa 2Qtos - Forene",
            price: "R$ 180.000",
            location: "Resid√™ncia Conj. Portal do Renascer, Forene",
            description: "Casa a 100m do CEASA; - Medindo 6,60m frente X 19m lado; - 125,40m¬≤ de √°rea total; -Somente um √∫nico dono; - 02 Quartos, Sala; - Cozinha; - 02 Banheiros; - Varanda; - 02 Vagas de garagem; - √Ågua de Po√ßo Artesiano;",
            features: ["02 Quartos", "Sala", "Cozinha", "02 Banheiros", "Varanda", "02 Vagas de carro"],
            type: "residencial",
            has_video: true,
            badge: "Destaque",
            rural: false,
            images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            created_at: new Date().toISOString()
        },
        {
            id: 2,
            title: "Apartamento 4Qtos (178m¬≤) - Ponta Verde",
            price: "R$ 1.500.000",
            location: "Rua Saleiro Pit√£o, Ponta Verde - Macei√≥/AL",
            description: "Apartamento amplo, super claro e arejado, im√≥vel diferenciado com 178m¬≤ de √°rea privativa, oferecendo conforto, espa√ßo e alto padr√£o de acabamento. 4 Qtos, sendo 03 su√≠tes, sala ampla com varanda, cozinha, depend√™ncia de empregada, √°rea de servi√ßo, 02 vagas de garagem no subsolo.",
            features: ["4Qtos s/ 3 su√≠tes", "Sala ampla com varanda", "Cozinha", "√Årea de servi√ßo", "DCE", "02 vagas de garagem"],
            type: "residencial",
            has_video: false,
            badge: "Luxo",
            rural: false,
            images: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            created_at: new Date().toISOString()
        }
    ];
}

// ========== CORRE√á√ÉO DO CARREGAMENTO DE IM√ìVEIS ==========
async function loadProperties() {
    try {
        console.log('üì° Carregando im√≥veis do Supabase...');
        
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=*`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            properties = Array.isArray(data) ? data : [];
            console.log(`‚úÖ ${properties.length} im√≥veis carregados do Supabase`);
            
            // CORRE√á√ÉO CR√çTICA: Garantir que todos os campos sejam tratados corretamente
            properties = properties.map(property => {
                // Se images estiver vazio, usar imagens padr√£o
                if (!property.images || property.images === 'EMPTY' || property.images.trim() === '') {
                    property.images = "https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                
                // CORRE√á√ÉO: Garantir que pdfs seja sempre uma string v√°lida
                if (!property.pdfs || property.pdfs === 'null' || property.pdfs === 'undefined') {
                    property.pdfs = '';
                }
                
                return property;
            });
            
        } else {
            console.log('‚ö†Ô∏è Supabase n√£o acess√≠vel, usando dados locais');
            throw new Error('Supabase n√£o dispon√≠vel');
        }
        
    } catch (error) {
        console.log('üîÑ Carregando dados locais...', error);
        const localData = localStorage.getItem('weberlessa_properties');
        properties = localData ? JSON.parse(localData) : getInitialProperties();
    }
    
    renderProperties();
    checkPdfData();
    debugPropertyData();
}

// ========== SISTEMA DE EXCLUS√ÉO DE FOTOS INDIVIDUAIS ==========
// ========== NOVA FUN√á√ÉO: MOSTRAR PREVIEW DE NOVAS IMAGENS ==========
function showNewImagePreview() {
    const newImagesSection = document.getElementById('newImagesSection');
    if (!newImagesSection) {
        console.log('‚ö†Ô∏è Se√ß√£o de novas imagens n√£o encontrada, criando...');
        const preview = document.getElementById('uploadPreview');
        if (preview) {
            // Verificar se j√° existe se√ß√£o de novas imagens
            let existingNewSection = document.getElementById('newImagesSection');
            if (!existingNewSection) {
                existingNewSection = document.createElement('div');
                existingNewSection.id = 'newImagesSection';
                existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
                preview.appendChild(existingNewSection);
            }
            existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            newImagesSection = existingNewSection;
        } else {
            return;
        }
    }
    
    // Limpar apenas a se√ß√£o de novas imagens
    const existingContent = newImagesSection.innerHTML.split('<p')[0];
    newImagesSection.innerHTML = existingContent + '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';

    if (selectedFiles.length === 0) {
        newImagesSection.innerHTML += '<p style="color: #666; text-align: center;">Nenhuma nova foto selecionada</p>';
        return;
    }

    console.log('üé® Renderizando preview de', selectedFiles.length, 'novas imagens');
    
    // Container para novas imagens
    const newContainer = document.createElement('div');
    newContainer.style.display = 'flex';
    newContainer.style.gap = '10px';
    newContainer.style.flexWrap = 'wrap';
    
    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';

        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                fileItem.innerHTML = `
                    <img src="${e.target.result}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px dashed #3498db;">
                    <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                            style="background: #3498db;" 
                            title="Remover esta foto da lista de novas">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">${file.name}</div>
                `;
                newContainer.appendChild(fileItem);
                newImagesSection.appendChild(newContainer);
            };
            reader.readAsDataURL(file);

        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f8ff; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; border: 2px dashed #3498db;">
                    <i class="fas fa-video" style="font-size: 2rem; color: #3498db;"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
                    <button class="delete-image-btn" onclick="removeNewFile(${index})" 
                            style="background: #3498db;" 
                            title="Remover este v√≠deo da lista de novos">√ó</button>
                </div>
            `;
            newContainer.appendChild(fileItem);
            newImagesSection.appendChild(newContainer);
        }
    });
}

// ========== NOVA FUN√á√ÉO: REMOVER NOVA IMAGEM/VIDEO ==========
function removeNewFile(index) {
    console.log('üóëÔ∏è Tentando remover novo arquivo no √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja remover este arquivo da lista de novos?')) {
        selectedFiles.splice(index, 1);
        console.log('üóëÔ∏è Arquivo removido. Arquivos novos restantes:', selectedFiles.length);
        showNewImagePreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.files = dataTransfer.files;
            console.log('üì∏ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}


// ========== SISTEMA DE EXCLUS√ÉO DE PDFs INDIVIDUAIS ==========
function showPdfPreview() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'pdf-file-item';
        fileItem.innerHTML = `
            <i class="fas fa-file-pdf" style="color: #e74c3c; font-size: 1.2rem;"></i>
            <div style="flex: 1;">
                <div style="font-weight: 500;">${file.name}</div>
                <div style="font-size: 0.8rem; color: #666;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
            </div>
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">√ó</button>
        `;
        preview.appendChild(fileItem);
    });
}

function removePdfFile(index) {
    if (confirm('Tem certeza que deseja excluir este PDF?')) {
        selectedPdfFiles.splice(index, 1);
        showPdfPreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('pdfFileInput').files = dataTransfer.files;
    }
}

// ========== RENDERIZAR IM√ìVEIS CORRIGIDO ==========
function renderProperties(filter = 'todos') {
    const container = document.getElementById('properties-container');
    if (!container) {
        console.error('‚ùå Container de propriedades n√£o encontrado!');
        return;
    }
    
    container.innerHTML = '';
    
    const filteredProperties = filter === 'todos' ? properties : properties.filter(p => {
        if (filter === 'Residencial') return p.type === 'residencial';
        if (filter === 'Comercial') return p.type === 'comercial';
        if (filter === 'Rural') return p.type === 'rural';
        if (filter === 'Minha Casa Minha Vida') return p.badge === 'MCMV';
        return true;
    });
    
    if (filteredProperties.length === 0) {
        container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #666;">Nenhum im√≥vel encontrado para este filtro.</p>';
        return;
    }
    
    console.log(`üé® Renderizando ${filteredProperties.length} im√≥veis...`);
    
    filteredProperties.forEach(property => {
        const features = Array.isArray(property.features) ? property.features : (property.features ? property.features.split(',') : []);
        
        // DEBUG: Verificar imagens
        const hasImages = property.images && property.images.length > 0 && property.images !== 'EMPTY';
        const imageUrls = hasImages ? property.images.split(',').filter(url => url.trim() !== '') : [];
        const firstImageUrl = imageUrls.length > 0 ? imageUrls[0] : 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80';
        
        // CORRE√á√ÉO CR√çTICA: Verificar PDFs de forma segura
        const hasPdfs = property.pdfs && 
                       property.pdfs.length > 0 && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined';
        
        console.log(`üìã Im√≥vel: ${property.title}`);
        console.log(`üñºÔ∏è Tem imagens: ${hasImages}`);
        console.log(`üìÑ Tem PDFs: ${hasPdfs}`);
        console.log(`üîó PDFs URLs: ${property.pdfs}`);
        
        // CORRE√á√ÉO: has_video em vez de hasVideo
        const hasVideo = property.has_video !== undefined ? property.has_video : property.hasVideo;
        
        const card = `
            <div class="property-card">
                <div class="property-image ${property.rural ? 'rural-image' : ''}" style="position: relative; height: 250px; background: ${hasImages ? 'none' : 'linear-gradient(45deg, var(--accent), var(--secondary))'};">
                    <img src="${firstImageUrl}" 
                         style="width: 100%; height: 100%; object-fit: cover;"
                         alt="${property.title}"
                         onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                    ${property.badge ? `<div class="property-badge ${property.rural ? 'rural-badge' : ''}">${property.badge}</div>` : ''}
                    ${hasVideo ? `<div class="video-indicator"><i class="fas fa-video"></i> TEM V√çDEO</div>` : ''}
                    ${hasImages ? `<div class="image-count">üì∏ ${imageUrls.length}</div>` : ''}
                    
                    <!-- BOT√ÉO DISCRETO PARA PDF - CORRIGIDO -->
                    ${hasPdfs ? `<button class="pdf-access" onclick="showPdfModal(${property.id})" title="Documentos do im√≥vel">
                        <i class="fas fa-file-pdf"></i>
                    </button>` : ''}
                </div>
                <div class="property-content">
                    <div class="property-price">${property.price}</div>
                    <h3 class="property-title">${property.title}</h3>
                    <div class="property-location"><i class="fas fa-map-marker-alt"></i> ${property.location}</div>
                    <p>${property.description}</p>
                    <div class="property-features">
                        ${features.map(f => `<span class="feature-tag ${property.rural ? 'rural-tag' : ''}">${f.trim()}</span>`).join('')}
                    </div>
                    <button class="contact-btn" onclick="contactAgent(${property.id})">
                        <i class="fab fa-whatsapp"></i> Entrar em Contato
                    </button>
                </div>
            </div>
        `;
        container.innerHTML += card;
    });
}        

// ========== CORRE√á√ÉO DO DEBUG DOS DADOS ==========
function debugPropertyData() {
    console.log('üêõ DEBUG - Dados dos Im√≥veis:');
    properties.forEach((property, index) => {
        console.log(`--- Im√≥vel ${index + 1} ---`);
        console.log('T√≠tulo:', property.title);
        console.log('ID:', property.id);
        console.log('PDFs:', property.pdfs);
        console.log('Tipo de PDFs:', typeof property.pdfs);
        console.log('Tem PDFs?', property.pdfs && property.pdfs !== 'EMPTY' && property.pdfs.trim() !== '');
        console.log('---------------');
    });
}

function checkPdfData() {
    console.log('üîç Verificando dados dos PDFs...');
    properties.forEach((property, index) => {
        console.log(`Im√≥vel ${index + 1}: ${property.title}`);
        console.log(`PDFs:`, property.pdfs);
        console.log(`Tem PDFs:`, property.pdfs && property.pdfs !== 'EMPTY' && property.pdfs.trim() !== '');
    });
}
        
// ========== SALVAR NO LOCALSTORAGE ==========
function saveToLocalStorage(propertyData) {
    try {
        console.log('üíæ Salvando no localStorage...');
        
        // Se estiver editando, atualizar o im√≥vel existente
        if (editingPropertyId) {
            const index = properties.findIndex(p => p.id === editingPropertyId);
            if (index !== -1) {
                // Manter o ID original e adicionar URLs das imagens
                propertyData.id = editingPropertyId;
                if (selectedFiles.length > 0) {
                    // Em modo local, usar URLs de imagens de exemplo
                    propertyData.images = "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80";
                }
                properties[index] = { ...properties[index], ...propertyData };
            }
        } else {
            // Novo im√≥vel
            const newId = properties.length > 0 ? Math.max(...properties.map(p => p.id)) + 1 : 1;
            const newProperty = {
                id: newId,
                ...propertyData,
                images: "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80,https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
            };
            properties.push(newProperty);
        }
        
        localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
        renderProperties();
        loadPropertyList();
        
        console.log('‚úÖ Salvo no localStorage com sucesso!');
        return true;
        
    } catch (error) {
        console.error('‚ùå Erro ao salvar no localStorage:', error);
        return false;
    }
}
        
// ========== SISTEMA DO PAINEL ADMIN ==========
const ADMIN_PASSWORD = "weber123";

function toggleAdminPanel() {
    const password = prompt("Digite a senha de acesso ao painel:");
    if (password === ADMIN_PASSWORD) {
        const panel = document.getElementById('adminPanel');
        if (panel) {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            if (panel.style.display === 'block') {
                loadPropertyList();
            }
        }
    } else {
        alert("Senha incorreta!");
    }
}

function loadPropertyList() {
    const container = document.getElementById('propertyList');
    const countElement = document.getElementById('propertyCount');
    
    if (!container) return;
    
    container.innerHTML = '';
    if (countElement) countElement.textContent = properties.length;
    
    if (properties.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum im√≥vel cadastrado.</p>';
        return;
    }
    
    properties.forEach(property => {
        const features = Array.isArray(property.features) 
            ? property.features 
            : (property.features ? property.features.split(',') : []);
            
        const item = document.createElement('div');
        item.className = 'property-item';
        item.innerHTML = `
            <div style="flex: 1;">
                <strong style="color: var(--primary);">${property.title}</strong><br>
                <small>${property.price} - ${property.location}</small>
                <div style="margin-top: 0.5rem;">
                    ${features.map(f => 
                        `<span style="background: var(--accent); color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem; margin-right: 0.3rem; display: inline-block; margin-bottom: 0.3rem;">${f.trim()}</span>`
                    ).join('')}
                </div>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button onclick="editProperty(${property.id})" style="background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button onclick="deleteProperty(${property.id})" style="background: #e74c3c; color: white; border: none; padding: 0.5rem 1rem; border-radius: 3px; cursor: pointer; display: flex; align-items: center; gap: 0.3rem;">
                    <i class="fas fa-trash"></i> Excluir
                </button>
            </div>
        `;
        container.appendChild(item);
    });
}
        
// ========== SISTEMA DE DOCUMENTOS PDF ==========
let currentPdfPropertyId = null;
const PDF_PASSWORD = "doc123"; // Senha simples para documentos

// Mostrar modal de PDF
function showPdfModal(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;

    currentPdfPropertyId = propertyId;
    const modal = document.getElementById('pdfModal');
    const title = document.getElementById('pdfModalTitle');
    const preview = document.getElementById('pdfPreview');
    
    if (title) {
        title.innerHTML = `<i class="fas fa-file-pdf"></i> Documentos - ${property.title}`;
    }
    
    if (preview) {
        if (property.pdfs && property.pdfs.length > 0) {
            const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
            preview.innerHTML = `
                <p><strong>${pdfUrls.length} documento(s) dispon√≠vel(is):</strong></p>
                ${pdfUrls.map((url, index) => `
                    <div class="pdf-file-item">
                        <i class="fas fa-file-pdf" style="color: #e74c3c;"></i>
                        <span>Documento ${index + 1}</span>
                    </div>
                `).join('')}
            `;
        } else {
            preview.innerHTML = '<p>Nenhum documento dispon√≠vel para este im√≥vel.</p>';
        }
    }
    
    // Resetar senha
    const passwordInput = document.getElementById('pdfPassword');
    if (passwordInput) passwordInput.value = '';
    
    modal.style.display = 'flex';
}

// Fechar modal
function closePdfModal() {
    const modal = document.getElementById('pdfModal');
    modal.style.display = 'none';
    currentPdfPropertyId = null;
}

// Acessar documentos com senha
function accessPdfDocuments() {
    const passwordInput = document.getElementById('pdfPassword');
    const password = passwordInput ? passwordInput.value : '';
    
    if (password !== PDF_PASSWORD) {
        alert('‚ùå Senha incorreta! Solicite a senha ao corretor.');
        return;
    }
    
    const property = properties.find(p => p.id === currentPdfPropertyId);
    if (!property || !property.pdfs) {
        alert('‚ùå Nenhum documento dispon√≠vel para este im√≥vel.');
        return;
    }
    
    // Abrir todos os PDFs em novas abas
    const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
    pdfUrls.forEach(url => {
        window.open(url, '_blank');
    });
    
    closePdfModal();
    alert('‚úÖ Documentos abertos com sucesso!');
}
        
// ========== CORRE√á√ÉO DO SISTEMA DE UPLOAD DE PDFs ==========
function setupPdfUploadSystem() {
    const pdfUploadArea = document.getElementById('pdfUploadArea');
    const pdfFileInput = document.getElementById('pdfFileInput');
    const pdfPreview = document.getElementById('pdfUploadPreview');

    if (pdfUploadArea && pdfFileInput) {
        // Drag and drop para PDFs
        pdfUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = 'var(--primary)';
            pdfUploadArea.style.background = '#f0f8ff';
        });

        pdfUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
        });

        pdfUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            pdfUploadArea.style.borderColor = '#ddd';
            pdfUploadArea.style.background = '';
            
            const files = Array.from(e.dataTransfer.files).filter(file => 
                file.type === 'application/pdf'
            );
            
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });

        // CORRE√á√ÉO: Click para selecionar - evitar propaga√ß√£o de eventos
        pdfUploadArea.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('üìÅ Click no upload area de PDFs');
            pdfFileInput.click();
        });

        // CORRE√á√ÉO: Lidar com mudan√ßa no input de arquivo
        pdfFileInput.addEventListener('change', (e) => {
            console.log('üìÑ Input de arquivo PDF alterado:', e.target.files.length, 'arquivos');
            const files = Array.from(e.target.files).filter(file => 
                file.type === 'application/pdf'
            );
            console.log('üìÑ PDFs filtrados:', files.length);
            if (files.length > 0) {
                handlePdfFiles(files);
            }
        });
        
        // CORRE√á√ÉO: Prevenir comportamento padr√£o do input
        pdfFileInput.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    } else {
        console.error('‚ùå Elementos do upload de PDFs n√£o encontrados:', {
            pdfUploadArea: !!pdfUploadArea,
            pdfFileInput: !!pdfFileInput,
            pdfPreview: !!pdfPreview
        });
    }
}

// ========== CORRE√á√ÉO DA FUN√á√ÉO HANDLE PDF FILES ==========
function handlePdfFiles(files) {
    console.log('üìÑ Processando novos PDFs:', files);
    
    const newFiles = Array.from(files);
    
    // CORRE√á√ÉO: Contar apenas novos PDFs, n√£o os existentes
    const currentNewPdfCount = selectedPdfFiles.length;
    const totalAfterAdd = currentNewPdfCount + newFiles.length;
    
    // Limitar a 5 arquivos PDF no total (novos)
    if (totalAfterAdd > 5) {
        alert('‚ö†Ô∏è M√°ximo de 5 novos arquivos PDF permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (10MB max para PDFs)
    for (const file of newFiles) {
        if (file.size > 10 * 1024 * 1024) {
            alert(`‚ö†Ô∏è O arquivo PDF "${file.name}" √© muito grande! M√°ximo: 10MB`);
            return;
        }
    }
    
    // CORRE√á√ÉO: Adicionar novos PDFs √† lista existente
    selectedPdfFiles = [...selectedPdfFiles, ...newFiles];
    console.log('üìÑ PDFs selecionados ap√≥s adi√ß√£o:', selectedPdfFiles.length);
    
    // CORRE√á√ÉO: Mostrar apenas novos PDFs na se√ß√£o apropriada
    showNewPdfPreview();
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
    document.getElementById('pdfFileInput').files = dataTransfer.files;
    console.log('üìÑ Input file atualizado');
}

// ========== FUN√á√ÉO CR√çTICA: VERIFICAR E CRIAR CAMPO PDFs NO SUPABASE ==========
async function ensurePdfFieldExists() {
    try {
        console.log('üîç Verificando se o campo pdfs existe no Supabase...');
        
        // Primeiro, tentar verificar a estrutura da tabela
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=pdfs&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        if (response.status === 400) {
            console.log('‚ö†Ô∏è Campo pdfs n√£o existe ou tem problemas. Tentando criar...');
            
            // Se n√£o existir, tentar adicionar um im√≥vel com o campo pdfs
            const testData = {
                title: "Teste PDF Field",
                price: "R$ 0,00",
                location: "Teste",
                description: "Teste do campo PDF",
                features: "Teste",
                type: "residencial",
                has_video: false,
                badge: "Novo",
                rural: false,
                created_at: new Date().toISOString(),
                pdfs: "" // Campo vazio para criar a estrutura
            };
            
            const createResponse = await fetch(`${SUPABASE_URL}/rest/v1/properties`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify(testData)
            });
            
            if (createResponse.ok) {
                console.log('‚úÖ Campo pdfs criado com sucesso!');
                
                // Excluir o registro de teste
                const testData = await createResponse.json();
                if (testData && testData[0] && testData[0].id) {
                    await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${testData[0].id}`, {
                        method: 'DELETE',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    });
                    console.log('‚úÖ Registro de teste removido');
                }
            }
        } else if (response.ok) {
            console.log('‚úÖ Campo pdfs j√° existe no Supabase!');
        }
        
    } catch (error) {
        console.error('‚ùå Erro ao verificar campo pdfs:', error);
    }
}
        
// ========== CORRE√á√ÉO URGENTE: FUN√á√ÉO DE UPLOAD DE PDFs ==========
async function uploadPdfFile(file) {
    try {
        console.log('üì§ Iniciando upload de PDF:', file.name);
        
        // Sanitizar nome do arquivo
        const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
        const fileName = `pdf_${Date.now()}_${safeName}`;
        
        console.log('üìÅ Nome do arquivo para upload:', fileName);
        
        // Criar FormData
        const formData = new FormData();
        formData.append('file', file, fileName);
        
        // DEBUG: Mostrar headers
        console.log('üì§ Headers da requisi√ß√£o:', {
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'apikey': SUPABASE_KEY
        });
        
        // Fazer upload para o storage
        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, 
            {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );
        
        console.log('üìä Status da resposta:', response.status);
        console.log('üìä Status OK?', response.ok);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro detalhado no upload do PDF:', {
                status: response.status,
                statusText: response.statusText,
                error: errorText
            });
            
            // Tentar alternativa: usar bucket p√∫blico
            const altResponse = await fetch(
                `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`, 
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'apikey': SUPABASE_KEY
                    },
                    body: formData
                }
            );
            
            if (altResponse.ok) {
                const altResult = await altResponse.json();
                const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
                console.log('‚úÖ PDF upload alternativo conclu√≠do:', publicUrl);
                return publicUrl;
            } else {
                const altError = await altResponse.text();
                console.error('‚ùå Erro no upload alternativo:', altError);
                throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
            }
        }

        const result = await response.json();
        console.log('üìÑ Resultado do upload:', result);
        
        // Construir URL p√∫blica correta
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('‚úÖ PDF upload conclu√≠do com sucesso!');
        console.log('üîó URL p√∫blica:', publicUrl);
        
        // Verificar se a URL √© acess√≠vel
        try {
            const testResponse = await fetch(publicUrl, { method: 'HEAD' });
            console.log('üîç Teste de acesso √† URL:', testResponse.ok);
        } catch (testError) {
            console.log('‚ö†Ô∏è URL pode n√£o estar acess√≠vel publicamente');
        }
        
        return publicUrl;
        
    } catch (error) {
        console.error('‚ùå Erro cr√≠tico no upload do PDF:', error);
        console.error('üìÑ Detalhes do arquivo:', {
            name: file.name,
            type: file.type,
            size: file.size,
            lastModified: file.lastModified
        });
        return null;
    }
}

// ========== EXCLUIR PDF EXISTENTE DO IM√ìVEL ==========
async function deleteExistingPdf(propertyId, pdfIndex) {
    if (!confirm('Tem certeza que deseja excluir este documento PDF? Esta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.pdfs) return;

    try {
        // Separar as URLs dos PDFs
        const pdfUrls = property.pdfs.split(',').filter(url => url.trim() !== '');
        
        // Remover o PDF selecionado
        if (pdfIndex >= 0 && pdfIndex < pdfUrls.length) {
            const pdfToDelete = pdfUrls[pdfIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = pdfToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('‚úÖ PDF exclu√≠do do Supabase Storage:', fileName);
                    } else {
                        console.log('‚ö†Ô∏è N√£o foi poss√≠vel excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('‚ö†Ô∏è Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            pdfUrls.splice(pdfIndex, 1);
            
            // Atualizar a propriedade
            property.pdfs = pdfUrls.length > 0 ? pdfUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ pdfs: property.pdfs })
            });

            if (response.ok) {
                console.log('‚úÖ PDF exclu√≠do com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualiza√ß√£o
                editProperty(propertyId);
                alert('‚úÖ Documento PDF exclu√≠do com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro ao excluir PDF:', error);
        alert('‚ùå Erro ao excluir o documento PDF. Tente novamente.');
    }
}

// ========== MOSTRAR PREVIEW DE PDFs COM BOT√ïES "X" ==========
function showPdfPreview() {
    const preview = document.getElementById('pdfUploadPreview');
    if (!preview) return;

    preview.innerHTML = '';

    if (selectedPdfFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
        return;
    }

    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'image-preview-container';
        fileItem.innerHTML = `
            <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
            </div>
            <button class="delete-image-btn" onclick="removePdfFile(${index})" title="Excluir este PDF">√ó</button>
            <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
        `;
        preview.appendChild(fileItem);
    });
}
        
// ========== CORRE√á√ÉO DA FUN√á√ÉO SHOW PDF PREVIEW ==========
// ========== NOVA FUN√á√ÉO: MOSTRAR PREVIEW DE NOVOS PDFs ==========
function showNewPdfPreview() {
    const newPdfsSection = document.getElementById('newPdfsSection');
    if (!newPdfsSection) {
        console.log('‚ö†Ô∏è Se√ß√£o de novos PDFs n√£o encontrada, criando...');
        const pdfPreview = document.getElementById('pdfUploadPreview');
        if (pdfPreview) {
            // Verificar se j√° existe se√ß√£o de novos PDFs
            let existingNewSection = document.getElementById('newPdfsSection');
            if (!existingNewSection) {
                existingNewSection = document.createElement('div');
                existingNewSection.id = 'newPdfsSection';
                existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
                pdfPreview.appendChild(existingNewSection);
            }
            existingNewSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
            newPdfsSection = existingNewSection;
        } else {
            return;
        }
    }
    
    // Limpar apenas a se√ß√£o de novos PDFs
    const existingContent = newPdfsSection.innerHTML.split('<p')[0];
    newPdfsSection.innerHTML = existingContent + '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';

    if (selectedPdfFiles.length === 0) {
        newPdfsSection.innerHTML += '<p style="color: #666; text-align: center;">Nenhum novo PDF selecionado</p>';
        return;
    }

    console.log('üé® Renderizando preview de', selectedPdfFiles.length, 'novos PDFs');
    
    selectedPdfFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'pdf-file-item';
        fileItem.innerHTML = `
            <i class="fas fa-file-pdf" style="color: #3498db; font-size: 1.2rem;"></i>
            <div style="flex: 1;">
                <div style="font-weight: 500;">${file.name}</div>
                <div style="font-size: 0.8rem; color: #666;">${(file.size / 1024 / 1024).toFixed(2)} MB</div>
            </div>
            <button class="delete-image-btn" onclick="removeNewPdfFile(${index})" 
                    style="background: #3498db;" 
                    title="Remover este PDF da lista de novos">√ó</button>
        `;
        newPdfsSection.appendChild(fileItem);
    });
}
// ========== REMOVER PDF DA LISTA DE UPLOAD ==========
// ========== CORRE√á√ÉO DA FUN√á√ÉO REMOVER PDF ==========
function removePdfFile(index) {
    console.log('üóëÔ∏è Tentando remover PDF no √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja excluir este PDF?')) {
        selectedPdfFiles.splice(index, 1);
        console.log('üóëÔ∏è PDF removido. PDFs restantes:', selectedPdfFiles.length);
        showPdfPreview();
        
        // CORRE√á√ÉO: Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        const pdfFileInput = document.getElementById('pdfFileInput');
        if (pdfFileInput) {
            pdfFileInput.files = dataTransfer.files;
            console.log('üìÑ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}

// ========== NOVA FUN√á√ÉO: REMOVER PDF NOVO ==========
function removeNewPdfFile(index) {
    console.log('üóëÔ∏è Tentando remover novo PDF no √≠ndice:', index);
    
    if (confirm('Tem certeza que deseja remover este PDF da lista de novos documentos?')) {
        selectedPdfFiles.splice(index, 1);
        console.log('üóëÔ∏è PDF removido. PDFs novos restantes:', selectedPdfFiles.length);
        showNewPdfPreview();
        
        // Atualizar input file
        const dataTransfer = new DataTransfer();
        selectedPdfFiles.forEach(file => dataTransfer.items.add(file));
        const pdfFileInput = document.getElementById('pdfFileInput');
        if (pdfFileInput) {
            pdfFileInput.files = dataTransfer.files;
            console.log('üìÑ Input file atualizado ap√≥s remo√ß√£o');
        }
    }
}
        
// ========== EDITAR IM√ìVEL CORRIGIDO COM EXCLUS√ÉO DE FOTOS EXISTENTES ==========
// ========== CORRE√á√ÉO DA FUN√á√ÉO EDITAR PROPRIEDADE ==========
// ========== CORRE√á√ÉO DA FUN√á√ÉO EDIT PROPERTY ==========
// ========== CORRE√á√ÉO DA FUN√á√ÉO EDIT PROPERTY PARA FOTOS ==========
function editProperty(id) {
    const property = properties.find(p => p.id === id);
    if (!property) return;

    editingPropertyId = id;
    
    // Preencher formul√°rio
    document.getElementById('propTitle').value = property.title || '';
    document.getElementById('propPrice').value = property.price || '';
    document.getElementById('propLocation').value = property.location || '';
    document.getElementById('propDescription').value = property.description || '';
    
    const features = Array.isArray(property.features) 
        ? property.features 
        : (property.features || '');
    document.getElementById('propFeatures').value = Array.isArray(features) ? features.join(', ') : features;
    
    document.getElementById('propType').value = property.type || 'residencial';
    document.getElementById('propBadge').value = property.badge || 'Novo';
    
    document.getElementById('propHasVideo').checked = property.has_video || false;
    
    // Atualizar t√≠tulo do formul√°rio
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Editar Im√≥vel';
    }
    
    // Atualizar texto do bot√£o
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Im√≥vel';
    }
    
    // Mostrar bot√£o cancelar
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'block';
    }
    
    // CORRE√á√ÉO: Inicializar arrays vazios mas manter refer√™ncia para adi√ß√µes futuras
    selectedFiles = [];
    
    // CORRE√á√ÉO: Mostrar imagens existentes se houver - COM SEPARA√á√ÉO ENTRE EXISTENTES E NOVAS
    const preview = document.getElementById('uploadPreview');
    if (preview) {
        preview.innerHTML = '';
        
        if (property.images && property.images.length > 0 && property.images !== 'EMPTY') {
            const existingImages = property.images.split(',').filter(img => img.trim() !== '');
            
            // CORRE√á√ÉO: Criar uma √°rea separada para imagens existentes
            preview.innerHTML = '<div id="existingImagesSection">';
            preview.innerHTML += '<p style="color: #666; margin-bottom: 1rem;">üì∏ Fotos atuais do im√≥vel (clique no X para excluir):</p>';
            
            // Container para imagens existentes
            const existingContainer = document.createElement('div');
            existingContainer.style.display = 'flex';
            existingContainer.style.gap = '10px';
            existingContainer.style.flexWrap = 'wrap';
            existingContainer.style.marginBottom = '1.5rem';
            
            existingImages.forEach((imgUrl, index) => {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'image-preview-container';
                imgContainer.innerHTML = `
                    <img src="${imgUrl}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid var(--success);"
                         onerror="this.src='https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'">
                    <button class="delete-image-btn" onclick="deleteExistingImage(${property.id}, ${index})" 
                            title="Excluir esta foto">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Foto ${index + 1}</div>
                `;
                existingContainer.appendChild(imgContainer);
            });
            
            preview.appendChild(existingContainer);
            preview.innerHTML += '</div>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novas imagens
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
            
            // Armazenar URLs das imagens existentes para refer√™ncia futura
            property.existingImageUrls = existingImages;
            
        } else {
            preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhuma foto cadastrada</p>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novas imagens mesmo quando n√£o h√° existentes
            const newImagesSection = document.createElement('div');
            newImagesSection.id = 'newImagesSection';
            newImagesSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üì∏ Novas fotos a serem adicionadas:</p>';
            preview.appendChild(newImagesSection);
        }
    }
    
    // CORRE√á√ÉO: Mostrar PDFs existentes se houver - COM SEPARA√á√ÉO ENTRE EXISTENTES E NOVOS
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) {
        pdfPreview.innerHTML = '';
        
        // CORRE√á√ÉO: Verificar se h√° PDFs de forma segura
        const hasPdfs = property.pdfs && 
                       property.pdfs !== 'EMPTY' && 
                       property.pdfs !== 'null' && 
                       property.pdfs !== 'undefined' &&
                       property.pdfs.trim() !== '';
        
        console.log('üìÑ Editando im√≥vel - Tem PDFs?', hasPdfs, 'PDFs:', property.pdfs);
        
        if (hasPdfs) {
            const existingPdfs = property.pdfs.split(',').filter(url => url.trim() !== '');
            
            // CORRE√á√ÉO: Criar uma √°rea separada para PDFs existentes
            pdfPreview.innerHTML = '<div id="existingPdfsSection">';
            pdfPreview.innerHTML += '<p style="color: #666; margin-bottom: 1rem;">üìÑ Documentos atuais do im√≥vel (clique no X para excluir):</p>';
            
            const existingPdfContainer = document.createElement('div');
            existingPdfContainer.style.display = 'flex';
            existingPdfContainer.style.gap = '10px';
            existingPdfContainer.style.flexWrap = 'wrap';
            existingPdfContainer.style.marginBottom = '1.5rem';
            
            existingPdfs.forEach((pdfUrl, index) => {
                // Extrair nome do arquivo da URL
                const fileName = pdfUrl.split('/').pop() || `Documento ${index + 1}`;
                
                const pdfContainer = document.createElement('div');
                pdfContainer.className = 'image-preview-container';
                pdfContainer.innerHTML = `
                    <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                        <i class="fas fa-file-pdf" style="font-size: 2rem; color: #e74c3c;"></i>
                        <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${fileName}</p>
                    </div>
                    <button class="delete-image-btn" onclick="deleteExistingPdf(${property.id}, ${index})" 
                            title="Excluir este documento">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">Doc ${index + 1}</div>
                `;
                existingPdfContainer.appendChild(pdfContainer);
            });
            
            pdfPreview.appendChild(existingPdfContainer);
            pdfPreview.innerHTML += '</div>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novos PDFs
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
            
            // Armazenar URLs dos PDFs existentes para refer√™ncia futura
            property.existingPdfUrls = existingPdfs;
            
        } else {
            pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum documento PDF cadastrado</p>';
            
            // CORRE√á√ÉO: Adicionar se√ß√£o para novos PDFs mesmo quando n√£o h√° existentes
            const newPdfsSection = document.createElement('div');
            newPdfsSection.id = 'newPdfsSection';
            newPdfsSection.innerHTML = '<p style="color: #666; margin: 1.5rem 0 1rem;">üìÑ Novos documentos a serem adicionados:</p>';
            pdfPreview.appendChild(newPdfsSection);
        }
    }
    
    // Rolar at√© o formul√°rio
    document.getElementById('adminPanel').scrollIntoView({ behavior: 'smooth' });
    
    alert("Im√≥vel carregado para edi√ß√£o! Modifique os campos e clique em 'Atualizar Im√≥vel' para salvar.");
}

// ========== CORRE√á√ÉO DA FUN√á√ÉO HANDLE FILES ==========
function handleFiles(files) {
    console.log('üì∏ Processando NOVAS imagens:', files);
    
    const newFiles = Array.from(files);
    
    // CORRE√á√ÉO: Contar apenas novas imagens, n√£o as existentes
    const currentNewFileCount = selectedFiles.length;
    const totalAfterAdd = currentNewFileCount + newFiles.length;
    
    // Limitar a 10 arquivos no total (novos)
    if (totalAfterAdd > 10) {
        alert('‚ö†Ô∏è M√°ximo de 10 novos arquivos permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (5MB max)
    for (const file of newFiles) {
        if (file.size > 5 * 1024 * 1024) {
            alert(`‚ö†Ô∏è O arquivo "${file.name}" √© muito grande! M√°ximo: 5MB`);
            return;
        }
    }
    
    // CORRE√á√ÉO: Adicionar novas imagens √† lista existente
    selectedFiles = [...selectedFiles, ...newFiles];
    console.log('üì∏ Imagens selecionadas ap√≥s adi√ß√£o:', selectedFiles.length);
    
    // CORRE√á√ÉO: Mostrar apenas novas imagens na se√ß√£o apropriada
    showNewImagePreview();
    
    // Atualizar input file
    const dataTransfer = new DataTransfer();
    selectedFiles.forEach(file => dataTransfer.items.add(file));
    document.getElementById('fileInput').files = dataTransfer.files;
    console.log('üì∏ Input file de imagens atualizado');
}
        
// ========== CORRE√á√ÉO DA FUN√á√ÉO CANCELAR EDI√á√ÉO ==========
function cancelEdit() {
    editingPropertyId = null;
    const form = document.getElementById('propertyForm');
    if (form) form.reset();
    
    // Resetar t√≠tulo do formul√°rio
    const formTitle = document.getElementById('formTitle');
    if (formTitle) {
        formTitle.textContent = 'Adicionar Novo Im√≥vel';
    }
    
    // Resetar bot√£o
    const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Im√≥vel ao Site';
    }
    
    // Esconder bot√£o cancelar
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (cancelBtn) {
        cancelBtn.style.display = 'none';
    }
    
    // CORRE√á√ÉO: Limpar completamente os arquivos selecionados
    selectedFiles = [];
    selectedPdfFiles = [];
    
    // CORRE√á√ÉO: Limpar os previews
    const preview = document.getElementById('uploadPreview');
    if (preview) preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
    
    const pdfPreview = document.getElementById('pdfUploadPreview');
    if (pdfPreview) pdfPreview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum PDF selecionado</p>';
    
    // CORRE√á√ÉO: Limpar inputs de arquivo
    const fileInput = document.getElementById('fileInput');
    if (fileInput) fileInput.value = '';
    
    const pdfFileInput = document.getElementById('pdfFileInput');
    if (pdfFileInput) pdfFileInput.value = '';
    
    console.log('‚úÖ Edi√ß√£o cancelada');
}
        
// ========== EXCLUIR FOTO EXISTENTE DO IM√ìVEL ==========
async function deleteExistingImage(propertyId, imageIndex) {
    if (!confirm('Tem certeza que deseja excluir esta foto? Esta a√ß√£o n√£o pode ser desfeita.')) {
        return;
    }

    const property = properties.find(p => p.id === propertyId);
    if (!property || !property.images) return;

    try {
        // Separar as URLs das imagens
        const imageUrls = property.images.split(',').filter(url => url.trim() !== '');
        
        // Remover a imagem selecionada
        if (imageIndex >= 0 && imageIndex < imageUrls.length) {
            const imageToDelete = imageUrls[imageIndex];
            
            // Tentar excluir do Supabase Storage
            try {
                // Extrair o nome do arquivo da URL
                const fileName = imageToDelete.split('/').pop();
                if (fileName && fileName !== 'EMPTY') {
                    const response = await fetch(
                        `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'apikey': SUPABASE_KEY
                            }
                        }
                    );
                    
                    if (response.ok) {
                        console.log('‚úÖ Imagem exclu√≠da do Supabase Storage:', fileName);
                    } else {
                        console.log('‚ö†Ô∏è N√£o foi poss√≠vel excluir do Supabase Storage');
                    }
                }
            } catch (storageError) {
                console.log('‚ö†Ô∏è Erro ao excluir do storage, continuando...', storageError);
            }
            
            // Remover da lista local
            imageUrls.splice(imageIndex, 1);
            
            // Atualizar a propriedade
            property.images = imageUrls.length > 0 ? imageUrls.join(', ') : 'EMPTY';
            
            // Salvar no Supabase
            const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?id=eq.${propertyId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': SUPABASE_KEY,
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'Prefer': 'return=representation'
                },
                body: JSON.stringify({ images: property.images })
            });

            if (response.ok) {
                console.log('‚úÖ Imagem exclu√≠da com sucesso!');
                
                // Atualizar localmente
                const index = properties.findIndex(p => p.id === propertyId);
                if (index !== -1) {
                    properties[index] = property;
                    localStorage.setItem('weberlessa_properties', JSON.stringify(properties));
                }
                
                // Recarregar a visualiza√ß√£o
                editProperty(propertyId);
                alert('‚úÖ Foto exclu√≠da com sucesso!');
            } else {
                throw new Error('Erro ao atualizar no Supabase');
            }
        }
    } catch (error) {
        console.error('‚ùå Erro ao excluir imagem:', error);
        alert('‚ùå Erro ao excluir a foto. Tente novamente.');
    }
}

// ========== FUN√á√ÉO AUXILIAR PARA EXCLUIR DO STORAGE ==========
async function deleteFromStorage(imageUrl) {
    try {
        // Extrair o nome do arquivo da URL
        const fileName = imageUrl.split('/').pop();
        if (!fileName || fileName === 'EMPTY') return false;

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                }
            }
        );

        return response.ok;
    } catch (error) {
        console.error('‚ùå Erro ao excluir do storage:', error);
        return false;
    }
}

// ========== SISTEMA DE UPLOAD ==========
function setupUploadSystem() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const uploadPreview = document.getElementById('uploadPreview');

    if (uploadArea && fileInput) {
        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary)';
            uploadArea.style.background = '#f0f8ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ddd';
            uploadArea.style.background = '';
            
            if (e.dataTransfer.files.length > 0) {
                handleFiles(e.dataTransfer.files);
            }
        });

        // Click para selecionar
        uploadArea.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
    }
}

function handleFiles(files) {
    const newFiles = Array.from(files);
    
    // Limitar a 10 arquivos
    if (selectedFiles.length + newFiles.length > 10) {
        alert('‚ö†Ô∏è M√°ximo de 10 arquivos permitidos!');
        return;
    }
    
    // Verificar tamanho dos arquivos (5MB max)
    for (const file of newFiles) {
        if (file.size > 5 * 1024 * 1024) {
            alert(`‚ö†Ô∏è O arquivo "${file.name}" √© muito grande! M√°ximo: 5MB`);
            return;
        }
    }
    
    selectedFiles = [...selectedFiles, ...newFiles];
    showPreview();
}

function showPreview() {
    const preview = document.getElementById('uploadPreview');
    if (!preview) return;
    preview.innerHTML = '';
    
    if (selectedFiles.length === 0) {
        preview.innerHTML = '<p style="color: #666; text-align: center;">Nenhum arquivo selecionado</p>';
        return;
    }

    selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.style.cssText = 'position: relative; display: inline-block; margin: 5px;';
        
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (e) => {
                fileItem.innerHTML = `
                    <img src="${e.target.result}" 
                         style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px; border: 2px solid #ddd;">
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; line-height: 1; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">√ó</button>
                    <div style="font-size: 0.7rem; text-align: center; margin-top: 5px; max-width: 100px; word-break: break-all;">${file.name}</div>
                `;
                preview.appendChild(fileItem);
            };
            reader.readAsDataURL(file);
        } else if (file.type.startsWith('video/')) {
            fileItem.innerHTML = `
                <div style="background: #f0f0f0; padding: 1rem; border-radius: 5px; text-align: center; width: 100px; height: 120px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;">
                    <i class="fas fa-video" style="font-size: 2rem; color: var(--primary);"></i>
                    <p style="margin: 0.5rem 0 0; font-size: 0.7rem; word-break: break-all;">${file.name}</p>
                    <button onclick="removeFile(${index})" 
                            style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">√ó</button>
                </div>
            `;
            preview.appendChild(fileItem);
        }
    });
}        
        
// ========== UPLOAD PARA SUPABASE ==========
async function uploadFile(file) {
    try {
        console.log('üì§ Iniciando upload:', file.name);
        
        const fileName = `${Date.now()}_${file.name.replace(/\s+/g, '_')}`;
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch(
            `${SUPABASE_URL}/storage/v1/object/properties/${fileName}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_KEY}`,
                    'apikey': SUPABASE_KEY
                },
                body: formData
            }
        );

        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro no upload:', errorText);
            throw new Error(`Upload falhou: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        
        // URL CORRETA para acesso p√∫blico
        const publicUrl = `${SUPABASE_URL}/storage/v1/object/public/properties/${fileName}`;
        
        console.log('‚úÖ Upload conclu√≠do:', publicUrl);
        return publicUrl;
        
    } catch (error) {
        console.error('‚ùå Erro cr√≠tico no upload:', error);
        return null;
    }
}

// ========== CORRE√á√ÉO DA FUN√á√ÉO SALVAR PROPRIEDADE PARA IMAGENS ==========
async function saveProperty(propertyData) {
    try {
        console.log('üíæ Iniciando processo de salvamento...');
        console.log('üìã Dados do im√≥vel:', propertyData);
        console.log('üì∏ NOVAS Imagens selecionadas:', selectedFiles.length);
        console.log('üìÑ NOVOS PDFs selecionados:', selectedPdfFiles.length);

        const dataToSave = {
            title: propertyData.title,
            price: propertyData.price,
            location: propertyData.location,
            description: propertyData.description,
            features: Array.isArray(propertyData.features) ? propertyData.features.join(', ') : propertyData.features,
            type: propertyData.type,
            has_video: propertyData.has_video,
            badge: propertyData.badge,
            rural: propertyData.rural,
            created_at: propertyData.created_at || new Date().toISOString()
        };

        // Garantir que o campo pdfs existe antes de continuar
        await ensurePdfFieldExists();

        // CORRE√á√ÉO: Upload das NOVAS imagens se houver
        if (selectedFiles.length > 0) {
            console.log(`üì∏ Fazendo upload de ${selectedFiles.length} NOVAS imagens...`);
            let uploadedFiles = [];
            
            for (const file of selectedFiles) {
                console.log(`‚¨ÜÔ∏è Enviando NOVA imagem/v√≠deo: ${file.name}`);
                const fileUrl = await uploadFile(file);
                if (fileUrl) {
                    uploadedFiles.push(fileUrl);
                    console.log(`‚úÖ NOVA imagem/v√≠deo enviada: ${fileUrl}`);
                } else {
                    console.log(`‚ùå Falha no upload do NOVO arquivo: ${file.name}`);
                }
            }
            
            if (uploadedFiles.length > 0) {
                // CORRE√á√ÉO: Combinar imagens existentes com novas
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.images && existingProperty.images !== 'EMPTY') {
                    const existingImages = existingProperty.images.split(',').filter(img => img.trim() !== '');
                    dataToSave.images = [...existingImages, ...uploadedFiles].join(', ');
                    console.log('üñºÔ∏è Imagens combinadas (existentes + novas):', dataToSave.images);
                    console.log('üî¢ Total de imagens:', existingImages.length + uploadedFiles.length);
                } else {
                    dataToSave.images = uploadedFiles.join(', ');
                    console.log('üñºÔ∏è Apenas NOVAS imagens:', dataToSave.images);
                    console.log('üî¢ N√∫mero de NOVAS imagens:', uploadedFiles.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter imagens existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.images) {
                dataToSave.images = existingProperty.images;
                console.log('üîÑ Mantendo imagens existentes:', dataToSave.images);
            } else {
                dataToSave.images = '';
                console.log('üîÑ Campo images ser√° vazio');
            }
        }

        // CORRE√á√ÉO: Upload dos NOVOS PDFs se houver
        if (selectedPdfFiles.length > 0) {
            console.log(`üìÑ Fazendo upload de ${selectedPdfFiles.length} NOVOS PDFs...`);
            let uploadedPdfs = [];
            
            for (const file of selectedPdfFiles) {
                console.log(`‚¨ÜÔ∏è Enviando NOVO PDF: ${file.name}`);
                console.log(`üìä Tamanho do NOVO PDF: ${(file.size / 1024).toFixed(2)} KB`);
                
                const fileUrl = await uploadPdfFile(file);
                if (fileUrl) {
                    uploadedPdfs.push(fileUrl);
                    console.log(`‚úÖ NOVO PDF enviado com sucesso: ${fileUrl}`);
                } else {
                    console.log(`‚ùå Falha cr√≠tica no upload do NOVO PDF: ${file.name}`);
                }
            }
            
            if (uploadedPdfs.length > 0) {
                // CORRE√á√ÉO: Combinar PDFs existentes com novos
                const existingProperty = properties.find(p => p.id === editingPropertyId);
                if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                    const existingPdfs = existingProperty.pdfs.split(',').filter(url => url.trim() !== '');
                    dataToSave.pdfs = [...existingPdfs, ...uploadedPdfs].join(', ');
                    console.log('üìÑ PDFs combinados (existentes + novos):', dataToSave.pdfs);
                    console.log('üî¢ Total de PDFs:', existingPdfs.length + uploadedPdfs.length);
                } else {
                    dataToSave.pdfs = uploadedPdfs.join(', ');
                    console.log('üìÑ Apenas NOVOS PDFs:', dataToSave.pdfs);
                    console.log('üî¢ N√∫mero de NOVOS PDFs:', uploadedPdfs.length);
                }
            }
        } else if (editingPropertyId) {
            // Manter PDFs existentes ao editar
            const existingProperty = properties.find(p => p.id === editingPropertyId);
            if (existingProperty && existingProperty.pdfs && existingProperty.pdfs !== 'EMPTY') {
                dataToSave.pdfs = existingProperty.pdfs;
                console.log('üîÑ Mantendo PDFs existentes:', dataToSave.pdfs);
            } else {
                dataToSave.pdfs = '';
                console.log('üîÑ Campo pdfs ser√° vazio');
            }
        } else {
            // Garantir que pdfs seja uma string vazia se n√£o houver PDFs
            dataToSave.pdfs = '';
            console.log('üìÑ Nenhum PDF selecionado, campo ser√° vazio');
        }
        
        console.log('üì§ Dados completos para salvar no Supabase:', JSON.stringify(dataToSave, null, 2));
        
        // Determinar URL e m√©todo
        const url = editingPropertyId
            ? `${SUPABASE_URL}/rest/v1/properties?id=eq.${editingPropertyId}`
            : `${SUPABASE_URL}/rest/v1/properties`;

        const method = editingPropertyId ? 'PATCH' : 'POST';

        console.log(`üåê Fazendo requisi√ß√£o: ${method} ${url}`);

        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`,
                'Prefer': 'return=representation'
            },
            body: JSON.stringify(dataToSave)
        });

        console.log('üìä Status da resposta do Supabase:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('‚ùå Erro na resposta do Supabase:', errorText);
            throw new Error(`Erro ao salvar: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        console.log('‚úÖ Salvo com sucesso no Supabase:', result);
        
        // CORRE√á√ÉO: Limpar apenas os NOVOS arquivos selecionados ap√≥s salvar
        selectedFiles = [];
        selectedPdfFiles = [];
        
        // Recarregar os dados do Supabase
        await loadProperties();
        
        // CORRE√á√ÉO: Fechar o painel de edi√ß√£o ap√≥s salvar
        cancelEdit();
        
        alert("‚úÖ Im√≥vel atualizado com sucesso!\n\nüì∏ Fotos existentes foram mantidas e novas fotos foram adicionadas.\nüìÑ PDFs existentes foram mantidos e novos PDFs foram adicionados.");
        return true;

    } catch (error) {
        console.error('‚ùå Erro cr√≠tico ao salvar no Supabase:', error);
        console.log('üîÑ Tentando salvar localmente como fallback...');
        return saveToLocalStorage(propertyData);
    }
}

// ========== FORMUL√ÅRIO CORRIGIDO ==========
function setupForm() {
    const form = document.getElementById('propertyForm');
    if (!form) return;

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const propertyData = {
            title: document.getElementById('propTitle').value,
            price: document.getElementById('propPrice').value,
            location: document.getElementById('propLocation').value,
            description: document.getElementById('propDescription').value,
            features: document.getElementById('propFeatures').value.split(',').map(f => f.trim()).filter(f => f !== ''),
            type: document.getElementById('propType').value,
            has_video: document.getElementById('propHasVideo').checked,
            badge: document.getElementById('propBadge').value,
            rural: document.getElementById('propType').value === 'rural',
            created_at: new Date().toISOString()
        };

        if (!propertyData.title || !propertyData.price || !propertyData.location) {
            alert('‚ùå Preencha T√≠tulo, Pre√ßo e Localiza√ß√£o!');
            return;
        }

        const submitBtn = document.querySelector('#propertyForm button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
        submitBtn.disabled = true;

        try {
            const success = await saveProperty(propertyData);
            
            if (success) {
                alert("‚úÖ Im√≥vel salvo com sucesso!");
            } else {
                alert("‚ùå Erro ao salvar o im√≥vel!");
            }

            this.reset();
            cancelEdit();
            selectedFiles = [];
            selectedPdfFiles = [];
            showPreview();
            showPdfPreview();

        } catch (error) {
            alert("‚ùå Erro: " + error.message);
        } finally {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });
}

// ========== FUN√á√ïES DE INTERA√á√ÉO ==========
function contactAgent(id) {
    const property = properties.find(p => p.id === id);
    if (property) {
        const message = `Ol√°! Tenho interesse no im√≥vel: ${property.title} - ${property.price}`;
        const whatsappURL = `https://wa.me/5582996044513?text=${encodeURIComponent(message)}`;
        window.open(whatsappURL, '_blank');
    }
}

function viewProperty(id) {
    const property = properties.find(p => p.id === id);
    if (property) {
        alert(`üè† ${property.title}\n\nüí∞ ${property.price}\nüìç ${property.location}\n\n${property.description}`);
    }
}

// ========== TESTAR CONEX√ÉO SUPABASE ==========
async function testSupabaseConnection() {
    try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/properties?select=id&limit=1`, {
            headers: {
                'apikey': SUPABASE_KEY,
                'Authorization': `Bearer ${SUPABASE_KEY}`
            }
        });
        
        return response.ok;
    } catch (error) {
        return false;
    }
}

// ========== TESTAR ACESSO √ÄS IMAGENS ==========
async function testImageAccess() {
    console.log('üîç Testando acesso √†s imagens...');
    
    // URLs das suas imagens no Supabase
    const testImages = [
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341618532_thumbnail3.jpeg',
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341628860_thumbnail2.jpeg',
        'https://syztbxvpdaplpetmixmt.supabase.co/storage/v1/object/public/properties/1764341634876_thumbnail1.jpeg'
    ];
    
    for (const imgUrl of testImages) {
        try {
            const response = await fetch(imgUrl);
            if (response.ok) {
                console.log(`‚úÖ Imagem acess√≠vel: ${imgUrl}`);
            } else {
                console.log(`‚ùå Imagem n√£o acess√≠vel: ${imgUrl} - Status: ${response.status}`);
            }
        } catch (error) {
            console.log(`‚ùå Erro ao acessar imagem: ${imgUrl} - ${error.message}`);
        }
    }
}
        
// ========== INICIALIZA√á√ÉO CORRIGIDA ==========
// ========== ADICIONAR DEBUG NA INICIALIZA√á√ÉO ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Sistema Weber Lessa Iniciado');
   
    // Aplicar diretriz constitucional
    enforceConstitutionalGuideline();
    
    // Testar conex√£o com Supabase
    const supabaseOk = await testSupabaseConnection();
    
    if (!supabaseOk) {
        console.log('‚ö†Ô∏è Supabase n√£o dispon√≠vel, usando modo local');
    } else {
        console.log('‚úÖ Supabase conectado com sucesso!');
        
        // Verificar se o campo pdfs existe no Supabase
        await ensurePdfFieldExists();
    }
    
    // Carregar propriedades
    await loadProperties();
    
    // Configurar formul√°rio e sistemas de upload
    setupForm();
    setupUploadSystem();
    setupPdfUploadSystem();
    
    // DEBUG: Verificar se os elementos de upload foram configurados
    console.log('üîç Verificando configura√ß√£o do upload de PDFs:', {
        uploadArea: document.getElementById('uploadArea'),
        pdfUploadArea: document.getElementById('pdfUploadArea'),
        fileInput: document.getElementById('fileInput'),
        pdfFileInput: document.getElementById('pdfFileInput')
    });
    
    // Configurar filtros
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            const text = this.textContent.trim();
            renderProperties(text === 'Todos' ? 'todos' : text);
        });
    });
    
    // Testar acesso √†s imagens
    testImageAccess();
    
    console.log('‚úÖ Sistema Weber Lessa carregado!');
});

  </script>
</body>
</html>
